import{j as p}from"./jsx-runtime-PJfywvQB.js";import{r as f,g as on}from"./index-tnPESBdE.js";import{c as cn,u as ae,a as mt,s as an,r as Me,b as ln,F as un,d as dn,e as Ue}from"./createSmartContext-lZxL_nvM.js";import{p as pn}from"./navigateObject-ZMXbUPar.js";import{i as hn}from"./index-C4WGByT4.js";import"./parchmentTheme-CF6Ki9yW.js";import{A as Et,N as yt,I as se,u as bt,h as It,i as Rt,g as W,j as xt,k as fn,d as we,S as mn,c as En,M as yn,B as Pe,l as H,a as bn,T as St,m as In,P as Tt,F as $t,e as vt,f as Rn}from"./useShowToast-xIu4UuDl.js";import{H as M}from"./styled-components.browser.esm-CuL3HyEV.js";import{Q as Ot,w as De}from"./index.esm-CPT3nVmo.js";import{F as xn,I as Sn,T as Tn,u as re}from"./fuse.esm-DpGxg_dX.js";import{E as z,a as F,T as k,b as $n,u as K,R as je,c as qe,d as Q,L as vn,e as On,f as An,I as At,g as Nn,w as Cn,h as Ln,i as jn,S as wn}from"./ImagePickerMenu-CvHb7-1l.js";import{i as Fe}from"./index-ChYhBiAs.js";import{c as oe,T as V}from"./index-GGm2kZn3.js";const ee=e=>p.jsx(Et,Object.assign({},e,{InputComponent:yt})),Pn=e=>p.jsx(Et,Object.assign({},e,{InputComponent:se}));function Dn({options:e,value:i,onChange:s,label:a,placeholder:o}){const t=bt(),[n,c]=f.useState(""),[r,l]=f.useState(e),u=f.useRef(e),{renderMenu:h,renderItem:m}=It(i),I=Rt(c),R=f.useMemo(()=>new xn(e,{keys:["displayValue"]}),[e]),T=f.useCallback(d=>c(d),[]),x=f.useCallback(d=>{const E=i==null?void 0:i.findIndex(S=>S.id===d.id);if(E!==void 0&&E!==-1){const S=[...i??[]];S.splice(E,1),s(S,[],[d],i??[]);return}if(!i){s([d],[d],[],[]);return}s([...i,d],[d],[],i)},[s,i]),L=f.useCallback((d,E)=>{const S=[...i??[]];S.splice(E,1),s(S,[],[d],i??[])},[s,i]);f.useEffect(()=>{u.current=r},[r]),f.useEffect(()=>{function d(){return n?R.search(n).map(S=>S.item):e}const E=d();hn(E,u.current)||l(E)},[n,R,e]);const P=f.useMemo(()=>({inputProps:{id:t,autoComplete:"off"}}),[t]),v=f.useCallback(d=>d.displayValue,[]);return p.jsx(W,{label:a,labelFor:t,children:p.jsx(xt,{tagInputProps:P,items:r,selectedItems:i,onItemSelect:x,onRemove:L,query:n,onQueryChange:T,itemRenderer:m,itemListRenderer:h,tagRenderer:v,popoverProps:I,placeholder:o})})}function qn({value:e,onChange:i,label:s,placeholder:a,initialOptions:o,fetchOptions:t,isLoading:n,disabled:c}){var r;const l=bt(),{renderMenu:u,renderItem:h}=It(e),{query:m,setQuery:I,options:R,isLoading:T}=fn(o,t),x=Rt(I),L=f.useCallback(E=>{const S=e==null?void 0:e.findIndex(N=>N.id===E.id);if(S!==void 0&&S!==-1){const N=[...e??[]];N.splice(S,1),i(N,[],[E],e??[]);return}if(!e){i([E],[E],[],[]);return}i([...e,E],[E],[],e)},[i,e]),P=f.useCallback((E,S)=>{const N=[...e??[]];N.splice(S,1),i(N,[],[E],e??[])},[i,e]),v=f.useMemo(()=>({inputProps:{id:l,autoComplete:"off",disabled:c},rightElement:n||T?p.jsx(we,{size:"textInline"}):p.jsx(Sn,{icon:"search"})}),[l,n,T,c]),d=f.useCallback(E=>E.displayValue,[]);return p.jsx(W,{label:s,labelFor:l,children:p.jsx(xt,{tagInputProps:v,items:(r=R??o)!==null&&r!==void 0?r:[],selectedItems:e,onItemSelect:L,onRemove:P,query:m,onQueryChange:I,itemRenderer:h,itemListRenderer:u,tagRenderer:d,popoverProps:x,placeholder:a,noResults:p.jsx("i",{children:"No results"}),resetOnQuery:!1})})}const Fn=({text:e,children:i})=>p.jsx(Tn,{content:e,children:i}),ie=cn({data:void 0,fieldSettings:void 0,aggregatedData:void 0}),gn=ie.Provider;function Be(){return new Error("Must provide PartialDataSubscriptionContextProvider")}const Nt=f.createContext({updateDataAtPath:()=>{throw Be()},updateFieldSettingsAtPath:()=>{throw Be()}}),kn=Nt.Provider;function Gn(e){const i=f.useMemo(()=>{const l=pn(e);return{dataLocation:["data",...l],fieldSettingsLocation:["fieldSettings",...l],aggregatedDataLocation:["aggregatedData",...l]}},[e]),s=ae(ie,i.dataLocation),a=ae(ie,i.fieldSettingsLocation),o=ae(ie,i.aggregatedDataLocation),{updateDataAtPath:t,updateFieldSettingsAtPath:n}=f.useContext(Nt),c=f.useCallback(l=>{t(e,l)},[e,t]),r=f.useCallback(l=>{n(e,l)},[e,n]);return{data:s,updateData:c,aggregatedData:o,fieldSettingsData:a,updateFieldSettings:r}}function We(e,i,s,a=300){const o=f.useRef([]),t=f.useRef(),n=f.useRef(s),c=f.useRef(i),r=f.useRef(e);f.useEffect(()=>{n.current=s},[s]),f.useEffect(()=>{c.current=i},[i]),f.useEffect(()=>{r.current=e},[e]),f.useEffect(()=>()=>t.current&&clearTimeout(t.current),[]);const l=f.useCallback(()=>Object.values(o.current.reduce((m,I)=>(m[I.path]=I,m),{})),[]),u=f.useCallback(()=>{const m=l(),I=mt(c.current);for(const R of m)an({root:I,location:R.path,value:R.update,schema:r.current});o.current=[],n.current(I)},[l]);return f.useCallback((m,I)=>{t.current&&(clearTimeout(t.current),t.current=void 0),o.current.push({path:m,update:I}),t.current=setTimeout(u,a)},[a,u])}const _n=({path:e,Widget:i,label:s,aggregation:a,schema:o,entityApi:t,currentUserRole:n,shouldShowFieldSettingControls:c,aggregationSupport:r})=>{const{data:l,aggregatedData:u,fieldSettingsData:h,updateData:m,updateFieldSettings:I}=Gn(e),R=l??(o==null?void 0:o.default),[T,x]=f.useState(R),[L,P]=f.useState(h);f.useEffect(()=>{x(R)},[R]),f.useEffect(()=>{P(h)},[h]);const v=f.useCallback(N=>{x(N),m(N)},[m]),d=f.useCallback(N=>{P(N),I==null||I(N)},[I]),E=f.useMemo(()=>Me(u,L==null?void 0:L.aggregationSettings),[L==null?void 0:L.aggregationSettings,u]),S=f.useMemo(()=>Me(a,L==null?void 0:L.aggregationSettings),[L==null?void 0:L.aggregationSettings,a]);return p.jsx(i,{value:T,onChange:v,label:s,aggregatedValue:E,aggregation:S,schema:o,entityApi:t,fieldSettings:L,updateFieldSettings:c?d:void 0,aggregationSupport:r,currentUserRole:n})},Mn={},Un={},hs=({schema:e,data:i=Mn,onChange:s,widgets:a,uiLayout:o,UiSection:t,aggregates:n,entityApi:c,updateFieldSettings:r,fieldSettings:l=Un,currentUserRole:u})=>{const{resolvedSchema:h,aggregatedData:m,uiLayout:I,fullAggregates:R}=ln({schema:e,data:i,currentUserRole:u,aggregates:n,providedUiLayout:o,fieldSettings:l,entityApi:c}),T=We(e,i,s),x=f.useCallback(v=>{r==null||r(v)},[r]),L=We(e,l,x),P=f.useMemo(()=>({updateDataAtPath:T,updateFieldSettingsAtPath:L}),[T,L]);return p.jsx(un,{children:p.jsx(kn,{value:P,children:p.jsx(gn,{value:{data:i,fieldSettings:l,aggregatedData:m},children:p.jsx(dn,{uiLayout:I,schema:h,widgetLookup:a,UiSection:t,aggregates:R,entityApi:c,shouldShowFieldSettingControls:!!r,currentUserRole:u,FormWidgetRenderer:_n})})})})},Ct=()=>p.jsx("p",{children:"Maybe later"});Ct.__docgenInfo={description:"",methods:[],displayName:"ArrayWidget",props:{onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: TValue) => void",signature:{arguments:[{type:{name:"TValue"},name:"value"}],return:{name:"void"}}},description:`The change handler for the field. It's
first parameter should include the full
updated value.`},label:{required:!0,tsType:{name:"string"},description:"The title of the field"},aggregation:{required:!0,tsType:{name:"union",raw:"TAggregates | undefined",elements:[{name:"TAggregates"},{name:"undefined"}]},description:`If the field has aggregates, this prop
will contain the raw aggregate expressions
specified in either the schema or the
aggregates object`},value:{required:!0,tsType:{name:"union",raw:"TValue | undefined",elements:[{name:"TValue"},{name:"undefined"}]},description:`The value from the form data (i.e.
what has been passed into \`updateValue\`).

Initially, it is set to undefined`},aggregatedValue:{required:!0,tsType:{name:"union",raw:"TValue | undefined",elements:[{name:"TValue"},{name:"undefined"}]},description:"The value to display if not being edited,\nmay simply be `value`, may be derived from\na combination of `value` and other data,\nor may be completely derived from other data"},schema:{required:!0,tsType:{name:"CampaignBuddySchema"},description:"The JSON scheme for this property"},aggregationSupport:{required:!0,tsType:{name:"unknown"},description:`Whether or not this field supports aggregation (regardless
of current field settings). This will be an object for
complex aggregations.`},entityApi:{required:!0,tsType:{name:"union",raw:"EntityApi | undefined",elements:[{name:"EntityApi"},{name:"undefined"}]},description:"If provided, the api to query entities"},fieldSettings:{required:!0,tsType:{name:"union",raw:"FieldSettings<TAggregates> | undefined",elements:[{name:"FieldSettings",elements:[{name:"TAggregates"}],raw:"FieldSettings<TAggregates>"},{name:"undefined"}]},description:"The field settings for the rendered field"},updateFieldSettings:{required:!0,tsType:{name:"union",raw:`| ((fieldSettings: FieldSettings<TAggregates>) => void)
| undefined`,elements:[{name:"unknown"},{name:"undefined"}]},description:"An optional callback to update field settings"},currentUserRole:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:`If provided to the FormGenerator component, the
role of the current user. This property is useful
for determining what field settings a user may change.`}}};const Lt=({value:e,aggregatedValue:i,onChange:s,label:a,aggregation:o})=>p.jsx(W,{label:a,labelFor:"",children:p.jsx(mn,{value:(o?i:e)??!1,onChange:s,disabled:!!o})});Lt.__docgenInfo={description:"",methods:[],displayName:"BooleanWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};function jt(...e){for(const i of e)if(typeof i!="string"||typeof i=="string"&&/<\s*base\s*>/i.test(i))return!0;return!1}function Y(...e){return f.useMemo(()=>jt(...e),e)}const wt=M.div`
	display: flex;
	flex-wrap: wrap;
	align-items: center;
	gap: 4px;
	min-height: 30px;
`,te=f.createContext({}),Bn=({queryClient:e,children:i,mediaApi:s,visibilitySettings:a,availableActions:o,showAggregationIndicator:t})=>{const n=f.useMemo(()=>({mediaApi:s,visibilitySettings:a,availableActions:o,showAggregationIndicator:t}),[o,s,t,a]);return p.jsx(Ot,{client:e,children:p.jsx(te.Provider,{value:n,children:i})})};function Pt(){const{mediaApi:e}=f.useContext(te);if(!e)throw new Error("mediaApi must be supplied through FormWidgetProvider");return e}function Wn(){const{visibilitySettings:e}=f.useContext(te);return e??[]}function Dt(){const{availableActions:e}=f.useContext(te);return e??{canUpdateAggregationSettings:!1,canUpdateVisibilitySettings:!1}}function Xn(){const{showAggregationIndicator:e}=f.useContext(te);return!!e}Bn.__docgenInfo={description:"",methods:[],displayName:"FormWidgetProvider",props:{queryClient:{required:!0,tsType:{name:"QueryClient"},description:""},mediaApi:{required:!0,tsType:{name:"MediaApi"},description:""},visibilitySettings:{required:!1,tsType:{name:"Array",elements:[{name:"VisibilitySetting"}],raw:"VisibilitySetting[]"},description:""},availableActions:{required:!1,tsType:{name:"AvailableFormActions"},description:""},showAggregationIndicator:{required:!1,tsType:{name:"boolean"},description:""}}};function Hn(e,i,s,a){const o=f.useMemo(()=>a&&zn(e,i??{},"Compute this field?",s,a),[s,e,i,a]),t=Dt(),n=f.useMemo(()=>Ft(s),[s]);return{items:f.useMemo(()=>!o||!n||!t.canUpdateAggregationSettings?[]:o,[t.canUpdateAggregationSettings,n,o]),hasAggregations:n}}function zn(e,i,s,a,o){const t=typeof a=="boolean"?!0:{};return!e||e.length===0?He("$",a)?[Xe({path:"$",label:s},i.aggregationSettings??t,n=>o({...i,aggregationSettings:n}))]:[]:e.filter(n=>He(n.path,a)).map(n=>Xe(n,i.aggregationSettings??t,c=>o({...i,aggregationSettings:c})))}function Xe(e,i,s){const a=qt(e.path,i),o=a?"tick":"blank";return{displayText:e.label,icon:o,onClick:()=>{const t=mt(i),n=Yn(e.path,t,!a);s(n)}}}function Yn(e,i,s){if(e.trim()==="$"||e.trim()==="")return s;const a=e.split(".");let o=i,t=a[0];for(let n=0;n<a.length-1;n++){const c=a[n];t=a[n+1],c!=="$"&&(typeof o[c]!="object"&&(o[c]={}),o=o[c])}return o[t]=s,o}function He(e,i){return i===!0?!0:i===!1?!1:qt(e,i,!1)}function qt(e,i,s=!0){const a=e.split(".");let o=i;for(let t=0;t<a.length;t++){if(o===!0)return!0;if(o===!1)return!1;const n=a[t];if(!(n==="$"&&t===0)){if(typeof o[n]=="boolean")return o[n];if(!o[n])return s;o=o[n]}}return o??s}function Ft(e){return e===!0?!0:e===!1?!1:typeof e=="object"?Object.values(e).some(i=>Ft(i)):!1}function Qn(e,i){const s=Wn(),a=Dt();return f.useMemo(()=>{if(!i||!a.canUpdateVisibilitySettings||!s.length)return[];const o=n=>{i({...e,visibleRoles:n})},t=n=>{if(!(e!=null&&e.visibleRoles))return!1;const c=new Set(n),r=new Set(e.visibleRoles);return c.size===r.size&&[...c].every(l=>r.has(l))};return[{displayText:"Visibility settings",icon:"eye-open",subItems:[{displayText:"Default visibility",icon:e!=null&&e.visibleRoles?"blank":"tick",onClick:()=>o()},...s.map(n=>({displayText:n.label,icon:t(n.roles)?"tick":"blank",onClick:()=>o(n.roles)}))]}]},[a.canUpdateVisibilitySettings,e,i,s])}const Kn=M.span`
	& .bp4-popover2-target {
		opacity: ${({isMenuOpen:e})=>e?1:0};
		transition: opacity 0.2s;
	}

	.bp4-label:hover & .bp4-popover2-target {
		opacity: 1;
	}
`,Zn=M.span`
	display: inline-flex;
	align-items: center;
	gap: 8px;
	max-width: 100%;

	& .bp4-popover2-target {
		margin: 0 !important;
	}
`,Jn=M.span`
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
`,gt=({aggregationSupport:e,fieldSettings:i,updateFieldSettings:s,configurableAggregations:a,label:o})=>{const t=Xn(),[n,c,r]=re(),{items:l,hasAggregations:u}=Hn(a,i,e,s),h=Qn(i,s),m=f.useMemo(()=>[...l,...h],[l,h]),I=f.useCallback(x=>{x.preventDefault(),x.stopPropagation()},[]),R=f.useCallback(()=>{c()},[c]),T=[p.jsx(Jn,{children:o},"label-text")];return u&&t&&T.push(p.jsx(Fn,{text:"Some or all of this field may be calculated",children:p.jsx(En,{icon:"predictive-analysis"})},"aggregation-indicator")),m.length>0&&T.push(p.jsx(Kn,{onClick:I,isMenuOpen:n,children:p.jsx(yn,{items:m,onClose:r,isOpen:n,children:p.jsx(Pe,{onClick:R,icon:"settings",variant:"minimal",size:"small"},"settings-button")})},"settings-menu")),p.jsx(Zn,{children:T})};gt.__docgenInfo={description:"",methods:[],displayName:"WidgetLabel",props:{label:{required:!0,tsType:{name:"string"},description:""},configurableAggregations:{required:!1,tsType:{name:"Array",elements:[{name:"ConfigurableAggregation"}],raw:"ConfigurableAggregation[]"},description:`For fields that need more fine grain control
over which properties can be aggregated`},aggregationSupport:{required:!0,tsType:{name:"unknown"},description:""},fieldSettings:{required:!0,tsType:{name:"union",raw:"FieldSettings<any> | undefined",elements:[{name:"FieldSettings",elements:[{name:"any"}],raw:"FieldSettings<any>"},{name:"undefined"}]},description:""},updateFieldSettings:{required:!0,tsType:{name:"union",raw:`| ((fieldSettings: FieldSettings<any>) => void)
| undefined`,elements:[{name:"unknown"},{name:"undefined"}]},description:""}}};function X(e,i){return({label:a,...o})=>{const t=p.jsx(gt,{label:a,aggregationSupport:o.aggregationSupport,configurableAggregations:i,fieldSettings:o.fieldSettings,updateFieldSettings:o.updateFieldSettings}),n=e;return p.jsx(n,{...o,label:t,rawLabel:a})}}const kt=({value:e,aggregatedValue:i,aggregation:s,onChange:a,label:o})=>{const t=Y(s);return s&&!t?p.jsx(W,{label:o,children:p.jsx(H,{children:i??0})}):s?p.jsx(ee,{value:e??0,aggregatedDisplayValue:`${i??0}`,onChange:a,label:o,baseValueLabel:"Additional modifier"}):p.jsx(yt,{value:e??0,onChange:a,label:o,disabled:!t})};kt.__docgenInfo={description:"",methods:[],displayName:"NumberWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};const Gt=({value:e,aggregatedValue:i,onChange:s,aggregation:a,label:o})=>{const t=Y(a);return a&&!t?p.jsx(W,{label:o,labelFor:"",children:p.jsx(H,{children:i??""})}):a?p.jsx(Pn,{value:e??"",aggregatedDisplayValue:i??"",onChange:s,label:o}):p.jsx(se,{label:o,value:e??"",onChange:s})};Gt.__docgenInfo={description:"",methods:[],displayName:"StringWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};const Vn=M.div`
	display: flex;
	align-items: center;
	gap: 4px;
	justify-content: center;
`,ei=M(W)`
	label.bp4-label {
		text-align: center;
	}
`,_t=({value:e,onChange:i,label:s,rawLabel:a,aggregatedValue:o,aggregation:t})=>{const n=Y(t==null?void 0:t.base),c=Y(t==null?void 0:t.bonus),r=f.useCallback(m=>{i({...e??{},base:m})},[e,i]),l=f.useCallback(m=>{i({...e??{},bonus:m})},[e,i]),u=typeof t=="object"&&t.base,h=typeof t=="object"&&t.bonus;return p.jsx(ei,{label:s,children:p.jsxs(Vn,{children:[n?p.jsx(ee,{value:(e==null?void 0:e.base)??0,onChange:r,aggregatedDisplayValue:`${u?o==null?void 0:o.base:(e==null?void 0:e.base)??0}`,baseValueLabel:u?"Additional base modifier":`${a} (base value)`,fontSize:20,hideButton:!0}):p.jsx(H,{fontSize:20,children:(o==null?void 0:o.base)??0}),c?p.jsx(ee,{value:(e==null?void 0:e.bonus)??0,onChange:l,aggregatedDisplayValue:ti((h?o==null?void 0:o.bonus:e==null?void 0:e.bonus)??0),baseValueLabel:h?"Additional bonus modifier":`${a} (bonus)`,hideButton:!0}):p.jsxs(H,{children:["(",(o==null?void 0:o.bonus)??0,")"]})]})})};function ti(e){return`(${e>=0?"+":"-"}${Math.abs(e)})`}_t.__docgenInfo={description:"",methods:[],displayName:"StatWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};const Mt=({value:e,onChange:i,aggregatedValue:s,schema:a,label:o,aggregation:t})=>{const n=f.useMemo(()=>jt(t==null?void 0:t.selectedOption),[t]),c=f.useMemo(()=>{var u;return[...(e==null?void 0:e.options)??[],...(s==null?void 0:s.options)??[],...((u=a==null?void 0:a.$options)==null?void 0:u.map(h=>({displayValue:h,id:`#defaultOption-${h}`})))??[]].filter(h=>!!(h.id&&h.displayValue))},[e==null?void 0:e.options,s==null?void 0:s.options,a==null?void 0:a.$options]),r=f.useCallback(u=>{i({...e,selectedOption:u})},[i,e]),l=f.useMemo(()=>{var m,I,R,T,x,L,P,v;if(!((m=s==null?void 0:s.selectedOption)!=null&&m.id)&&!((I=e==null?void 0:e.selectedOption)!=null&&I.id))return;const u=((R=s==null?void 0:s.selectedOption)==null?void 0:R.displayValue)??((T=e==null?void 0:e.selectedOption)==null?void 0:T.displayValue);return{id:(t&&n?((x=e==null?void 0:e.selectedOption)==null?void 0:x.id)??((L=s==null?void 0:s.selectedOption)==null?void 0:L.id):((P=s==null?void 0:s.selectedOption)==null?void 0:P.id)??((v=e==null?void 0:e.selectedOption)==null?void 0:v.id))??"",displayValue:u??""}},[s==null?void 0:s.selectedOption,e==null?void 0:e.selectedOption,t,n]);return t&&!n?p.jsx(W,{label:o,children:p.jsx(H,{children:l==null?void 0:l.displayValue})}):p.jsx(bn,{options:c,value:l,onChange:r,label:o,isDisabled:!n})};Mt.__docgenInfo={description:"",methods:[],displayName:"ChoiceWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};const Ut=({value:e,onChange:i,aggregatedValue:s,schema:a,label:o,aggregation:t})=>{var u;const n=Y(t==null?void 0:t.selectedOptions),c=f.useMemo(()=>{var h;return[...(e==null?void 0:e.options)??[],...(s==null?void 0:s.options)??[],...((h=a==null?void 0:a.$options)==null?void 0:h.map(m=>({displayValue:m,id:`#defaultOption-${m}`})))??[]].filter(m=>!!(m.id&&m.displayValue))},[e==null?void 0:e.options,s==null?void 0:s.options,a==null?void 0:a.$options]),r=f.useCallback((h,m,I)=>{const R=[...(e==null?void 0:e.selectedOptions)??[]],T=I.map(({id:x})=>R.findIndex(L=>x===L.id)).filter(x=>x!==-1);for(const x of T)R.splice(x,1);i({...e,selectedOptions:[...R,...m]})},[i,e]),l=f.useMemo(()=>{var h;return(h=(s==null?void 0:s.selectedOptions)??(e==null?void 0:e.selectedOptions))==null?void 0:h.map(m=>({id:(m==null?void 0:m.id)??"",displayValue:(m==null?void 0:m.displayValue)??""}))},[s==null?void 0:s.selectedOptions,e==null?void 0:e.selectedOptions]);return!n&&t?p.jsx(W,{label:o,children:p.jsx(wt,{children:(u=s==null?void 0:s.selectedOptions)==null?void 0:u.filter(h=>(h==null?void 0:h.displayValue)&&h.id).map(h=>p.jsx(St,{children:h.displayValue},h.id))})}):p.jsx(Dn,{options:c,value:l,onChange:r,label:o})};Ut.__docgenInfo={description:"",methods:[],displayName:"MultiChoiceWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};function Bt(e,i,s,a,o){const t=Ue(s),n=Ue(a),c=f.useRef(),[r,l]=f.useState(!1),[u,h]=f.useState(),[m,I]=f.useState(o),[R,T]=f.useState([]),x=f.useCallback(E=>{c.current=E,h(E)},[]),{searchEntities:L,getEntitiesByIds:P,getDefaultEntities:v}=e;f.useEffect(()=>{if(!i)return;let E=!1;async function S(){if(!i||!o)return;I(!0);const N=await v({entityDefinitionName:i,availableEntityIds:n});E||(I(!1),T(N.entities.map(le)))}return S(),()=>{E=!0}},[i,v,n,o]),f.useEffect(()=>{if(l(!1),!t)return;let E=!1;async function S(){var q;if(ni(t,c.current))return;if(ii(t,c.current)){const _=((q=c.current)==null?void 0:q.reduce((U,b)=>(U[b.id]=b,U),{}))??{};x(t.map(U=>_[U]));return}if(!t){x([]);return}l(!0);const N=(await P({ids:t,entityDefinitionName:i})).entities.map(le);E||(x(N),l(!1))}return S(),()=>{E=!0}},[i,t,P,x]);const d=f.useCallback(async E=>i?E?(await L({query:E,entityDefinitionName:i,availableEntityIds:n})).entities.map(le):R:[],[L,R,i,n]);return{selectedEntities:u,setSelectedEntities:x,initialOptions:R,isLoading:m||r,fetchOptions:d}}function le(e){return{id:e.id,kind:e.definitionName,displayValue:e.name}}function ni(e,i){return e.length===(i==null?void 0:i.length)&&e.every((s,a)=>i[a].id===s)}function ii(e,i){if(!i)return e.length===0;const s=new Set(i.map(o=>o.id));return e.every(o=>s.has(o))}const Wt=({value:e,aggregatedValue:i,schema:s,onChange:a,label:o,entityApi:t,aggregation:n})=>{var P,v,d;const c=Y(n==null?void 0:n.entity),r=((P=i==null?void 0:i.entity)==null?void 0:P.id)??((v=e==null?void 0:e.entity)==null?void 0:v.id),l=(i==null?void 0:i.availableEntityIds)??(e==null?void 0:e.availableEntityIds),u=s.$entity,h=f.useMemo(()=>r?[r]:[],[r]);if(!t)throw new Error("Entity api is required for entity picker");if(!u)throw new Error("Entity picker widget requires $entity to be an entity definition name");const{selectedEntities:m,setSelectedEntities:I,initialOptions:R,isLoading:T,fetchOptions:x}=Bt(t,u,h,l,c),L=f.useCallback(E=>{I([E]),a({entity:{id:E.id},availableEntityIds:e==null?void 0:e.availableEntityIds})},[a,I,e==null?void 0:e.availableEntityIds]);return n&&!c?p.jsx(W,{label:o,children:p.jsx(H,{children:T?p.jsx(we,{size:"textInline"}):((d=m==null?void 0:m[0])==null?void 0:d.displayValue)??""})}):p.jsx(In,{value:m==null?void 0:m[0],onChange:L,fetchOptions:x,initialOptions:R,label:o,isLoading:T,disabled:T})};Wt.__docgenInfo={description:"",methods:[],displayName:"EntityPickerWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};const Xt=({value:e,aggregatedValue:i,schema:s,onChange:a,label:o,entityApi:t,aggregation:n})=>{const c=Y(n==null?void 0:n.entities),r=(i==null?void 0:i.availableEntityIds)??(e==null?void 0:e.availableEntityIds),l=f.useMemo(()=>{const L=[...(i==null?void 0:i.entities)??[],...(e==null?void 0:e.entities)??[]].map(P=>P.id).filter(P=>!!P);return[...new Set(L)]},[i==null?void 0:i.entities,e==null?void 0:e.entities]),u=s.$entity;if(!t)throw new Error("Entity api must be supplied for EntityPickerWidget to work");if(!u)throw new Error("Multi entity picker widget requires $entity to be an entity definition name");const{selectedEntities:h,setSelectedEntities:m,initialOptions:I,isLoading:R,fetchOptions:T}=Bt(t,u,l,r,!0),x=f.useCallback((L,P,v,d)=>{const E=d.filter(q=>{var _;return(_=e==null?void 0:e.entities)==null?void 0:_.find(U=>U.id===q.id)}),S=d.filter(q=>{var _;return((_=i==null?void 0:i.entities)==null?void 0:_.find(U=>U.id===q.id))&&!E.find(U=>U.id===q.id)}),N=v.map(({id:q})=>E.findIndex(_=>_.id===q)).filter(q=>q!==-1);for(const q of N)E.splice(q,1);E.push(...P),m([...S,...E]),a({entities:E.map(({id:q})=>({id:q})),availableEntityIds:e==null?void 0:e.availableEntityIds})},[i==null?void 0:i.entities,a,m,e==null?void 0:e.availableEntityIds,e==null?void 0:e.entities]);return n&&!c?p.jsx(W,{label:o,children:p.jsx(H,{children:R?p.jsx(we,{size:"textInline"}):p.jsx(wt,{children:h==null?void 0:h.map(L=>p.jsx(St,{children:L.displayValue},L.id))})})}):p.jsx(qn,{value:h,onChange:x,fetchOptions:T,initialOptions:I,label:o,isLoading:R,disabled:R})};Xt.__docgenInfo={description:"",methods:[],displayName:"MultiEntityPickerWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};const si=M.div`
	display: flex;
	gap: 4px;
	align-items: center;
	font-size: 20px;
`,Ht=({value:e,aggregatedValue:i,aggregation:s,onChange:a,label:o,rawLabel:t})=>{const n=Y(s==null?void 0:s.max),c=Y(s==null?void 0:s.current),r=(i==null?void 0:i.max)??(e==null?void 0:e.max)??0,l=(i==null?void 0:i.current)??(e==null?void 0:e.current)??0,u=f.useCallback(R=>{a({...e,max:R})},[a,e]),h=f.useCallback(R=>{a({...e,current:R})},[a,e]),m=typeof s=="object"&&s.max,I=typeof s=="object"&&s.current;return p.jsx(W,{label:o,children:p.jsxs(si,{children:[c?p.jsx(ee,{value:(e==null?void 0:e.current)??0,aggregatedDisplayValue:`${l}`,onChange:h,hideButton:!0,baseValueLabel:I?`${t} modifier`:`${t} (current)`,fontSize:20}):p.jsx(H,{fontSize:20,children:(i==null?void 0:i.current)??0}),"/",n?p.jsx(ee,{value:(e==null?void 0:e.max)??0,aggregatedDisplayValue:`${r}`,onChange:u,hideButton:!0,baseValueLabel:m?`${t} maximum modifier`:`${t} (maximum value)`,fontSize:20}):p.jsx(H,{fontSize:20,children:(i==null?void 0:i.max)??0})]})})};Ht.__docgenInfo={description:"",methods:[],displayName:"NumericResourceWidget",props:{label:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},rawLabel:{required:!0,tsType:{name:"string"},description:""}},composes:["Omit"]};const ri=["image"],oi=["link"];function ci(e){const{normalizeNode:i}=e;return e.isVoid=s=>ri.includes(s.kind),e.isInline=s=>oi.includes(s.kind),e.normalizeNode=s=>{const[a,o]=s;if(z.isElement(a)&&e.isVoid(a)&&!F.next(e,{at:o,voids:!0})){k.insertNodes(e,{id:oe(),kind:"paragraph",children:[{text:"",kind:"text"}]},{at:F.end(e,[])});return}if(z.isElement(a)&&a.kind==="link"&&zt(a)){k.removeNodes(e,{at:o});return}i(s)},e}function zt(e){return!e.children.some(i=>$n.isText(i)?!!i.text:z.isElement(i)?zt(i):!0)}function ue(e,i){return s=>s[e]===void 0?"":typeof i=="string"?i:i(s[e])}const ai=M.span`
	${ue("isBold","font-weight: bold;")}
	${ue("isItalic","font-style: italic;")}
	${ue("isUnderline","text-decoration: underline;")}
`,li=({leaf:e,attributes:i,children:s})=>p.jsx(ai,Object.assign({},e??{},i,{children:s})),ui=M.span`
	font-size: 0;
`,ze=()=>p.jsxs(ui,{contentEditable:!1,children:["$",String.fromCodePoint(160)]});function di(e){const i=K();return Yt(i,e)}function Yt(e,i){const[s]=F.nodes(e,{match:a=>!F.isEditor(a)&&z.isElement(a)&&a.kind===i});return!!s}function Qt(e,i){pi(e);const{selection:s}=e;Yt(e,i.kind)&&Kt(e,i.kind);const a=s&&je.isCollapsed(s),o=Object.assign(Object.assign({},i),{id:oe()}),t=F.isVoid(e,o);return a||t?(t&&k.collapse(e,{edge:"end"}),k.insertNodes(e,o)):(k.wrapNodes(e,o,{split:!0}),k.collapse(e,{edge:"end"})),o}function Kt(e,i){k.unwrapNodes(e,{match:s=>!F.isEditor(s)&&z.isElement(s)&&s.kind===i})}function pi(e){var i;const s=e.selection&&F.void(e,{at:e.selection});if(s){const a=(i=F.after(e,s[1]))!==null&&i!==void 0?i:F.end(e,[]);k.select(e,a)}}function hi(e,i){const a=F.nodes(e,{match:n=>!F.isEditor(n)&&z.isElement(n)&&n.id===i}).next().value;if(!a)return null;const[o,t]=a;return z.isElement(o)?[o,t]:null}function Zt(e,i){var s;const[,a]=(s=hi(e,i))!==null&&s!==void 0?s:[null,null];if(!a)return;const o=F.end(e,a);k.select(e,o)}function ge(){const e=qe(),i=f.useRef([]),s=f.useCallback(()=>{const o=e.selection;o&&i.current.push(F.rangeRef(e,o))},[e]),a=f.useCallback(()=>{const o=i.current.pop();if(!o)return null;const t=o==null?void 0:o.unref();return t?(Q.isFocused(e)||Q.focus(e),k.select(e,t),t):null},[e]);return f.useEffect(()=>()=>{for(const o of i.current)o.unref()},[]),{pushSelectionSnapshot:s,popSelectionSnapshot:a,snapshotStack:i}}function fi(){const e=K();if(!e.selection)return;const[[i]]=F.nodes(e,{match:s=>!F.isEditor(s)&&z.isElement(s)});if(z.isElement(i))return i}const mi=({attributes:e,children:i,element:s})=>{const a=K(),[o,t,n]=re(),{pushSelectionSnapshot:c,popSelectionSnapshot:r}=ge(),[l,u]=f.useState(s.url),h=f.useCallback(()=>{c(),t()},[c,t]),m=f.useCallback(()=>{if(l!==s.url){const T=Q.findPath(a,s);k.setNodes(a,Object.assign(Object.assign({},s),{url:l}),{at:T})}n(),r()},[n,a,s,l,r]),I=f.useCallback(T=>{T.target.select()},[]),R=f.useCallback(T=>{Fe("enter",T)&&(T.preventDefault(),m())},[m]);return p.jsx("span",Object.assign({},e,{children:p.jsx(Tt,{isOpen:o,onClose:m,autoFocus:!1,content:p.jsxs(p.Fragment,{children:[p.jsx(se,{label:"URL",value:l,onChange:u,onKeyDown:R,onFocus:I}),p.jsx($t,{justifyContent:"flex-end",children:p.jsx(Pe,{onClick:m,children:"Close"})})]}),placement:"bottom",children:p.jsxs(vn,{onClick:h,children:[p.jsx(ze,{}),i,p.jsx(ze,{})]})})}))},Ei=({attributes:e,children:i})=>p.jsx(yi,Object.assign({},e,{children:i})),yi=M.p`
	margin: 8px 0;
`,bi=({element:e,attributes:i,children:s})=>{const a=On(),o=An();return p.jsxs("div",Object.assign({},i,{children:[s,p.jsx("div",{contentEditable:!1,children:p.jsx(Ii,{src:e.src,alt:e.alt,shouldHighlight:a&&o})})]}))},Ii=M.img`
	display: block;
	max-width: 100%;
	max-height: 20em;
	box-shadow: ${({shouldHighlight:e})=>e?"0 0 0 3px #B4D5FF":"none"};
`,Ri={text:li},xi={link:mi,paragraph:Ei,image:bi},Si={left:e=>{if(e.selection){if(!je.isCollapsed(e.selection)){k.collapse(e,{edge:"start"});return}k.move(e,{unit:"offset",reverse:!0})}},right:e=>{if(e.selection){if(!je.isCollapsed(e.selection)){k.collapse(e,{edge:"end"});return}k.move(e,{unit:"offset"})}},backspace:e=>{if(F.void(e)){k.delete(e,{unit:"block"}),k.move(e,{unit:"offset",reverse:!0});return}return{allowDefault:!0}}},Jt=f.createContext(null),Ti=Jt.Provider;function $i(){const e=f.useContext(Jt);if(!e)throw new Error("Must provide media api context");return e}const vi=()=>{const e=qe(),i=f.useRef(null),{pushSelectionSnapshot:s,popSelectionSnapshot:a,snapshotStack:o}=ge(),t=$i(),n=De(),[c,r]=f.useState(!1),l=f.useCallback(()=>{r(!1),a()},[a,r]),u=f.useCallback(()=>{var I;((I=o.current)===null||I===void 0?void 0:I.length)===0&&s(),r(!0)},[s,o]),h=f.useCallback((I,R)=>{var T;i.current&&k.select(e,i.current);const{id:x}=Qt(e,{kind:"image",children:[{text:"",kind:"text"}],src:I,alt:(T=R==null?void 0:R.alt)!==null&&T!==void 0?T:I});Zt(e,x),k.move(e,{unit:"offset"}),i.current=null,l()},[l,e]),m=f.useCallback((I,R)=>{I==="main-menu"&&R!=="none"&&(i.current=a())},[a]);return p.jsx(At,{isOpen:c,onClose:close,onConfirm:h,onStateTransition:m,mediaApi:t,queryClient:n,children:p.jsx(V,{icon:"media",onChange:u,size:"small",value:!1})})},Oi=()=>{const e=K(),[i,s]=f.useState(""),{pushSelectionSnapshot:a,popSelectionSnapshot:o}=ge(),t=di("link"),[n,c,r]=re(),l=f.useCallback(()=>{r(),o();const{id:m}=Qt(e,{kind:"link",url:i,children:[{kind:"text",text:i}]});Zt(e,m),k.move(e,{unit:"offset"})},[r,o,e,i]),u=f.useCallback(()=>{if(t){Kt(e,"link");return}a(),c()},[e,t,c,a]),h=f.useCallback(m=>{Fe("enter",m)&&(m.preventDefault(),l())},[l]);return p.jsx(Tt,{isOpen:n,onClose:r,content:p.jsxs(p.Fragment,{children:[p.jsx(se,{label:"URL",value:i,onChange:s,autoFocus:!0,onKeyDown:h}),p.jsx($t,{justifyContent:"flex-end",children:p.jsx(Pe,{onClick:l,children:"Add link"})})]}),placement:"bottom-start",children:p.jsx(V,{value:t,icon:"link",onChange:u,size:"small"})})},Ai=()=>{const e=qe(),i=fi(),s=f.useCallback(t=>{var n,c;if(!e.selection)return;k.collapse(e);let r;t==="above"?r=(n=F.before(e,e.selection))!==null&&n!==void 0?n:F.start(e,[]):r=(c=F.after(e,e.selection))!==null&&c!==void 0?c:F.end(e,[]),k.insertNodes(e,{id:oe(),kind:"paragraph",children:[{kind:"text",text:""}]},{at:r})},[e]),a=f.useCallback(()=>s("above"),[s]),o=f.useCallback(()=>s("below"),[s]);return!i||!e.isVoid(i)?null:p.jsxs("div",{children:[p.jsx(V,{size:"small",icon:"double-chevron-up",onChange:a,value:!1}),p.jsx(V,{size:"small",icon:"double-chevron-down",onChange:o,value:!1})]})},de=({icon:e,format:i})=>{var s;const a=K(),o=!!(!((s=F.marks(a))===null||s===void 0)&&s[i]),t=f.useCallback(()=>{Q.isFocused(a)||Q.focus(a),o?F.removeMark(a,i):F.addMark(a,i,!0)},[o,i,a]);return p.jsx(V,{value:o,onChange:t,icon:e,size:"small",preventFocus:!0})},Vt=M.div`
	display: flex;
	gap: 16px;
	padding: 4px;
	border-bottom: 1px ${({theme:e})=>e.legacyCoreUi.colors.textDisabled}
		solid;
	cursor: default;
`;Vt.defaultProps={theme:vt};const Ni=()=>{const e=K(),i=f.useRef(null),s=f.useCallback(a=>{var o;!((o=i.current)===null||o===void 0)&&o.contains(a.target)&&a.preventDefault(),Q.isFocused(e)||Q.focus(e)},[e]);return p.jsxs(Vt,{onMouseDown:s,ref:i,children:[p.jsxs("div",{children:[p.jsx(de,{icon:"bold",format:"isBold"}),p.jsx(de,{icon:"italic",format:"isItalic"}),p.jsx(de,{icon:"underline",format:"isUnderline"})]}),p.jsxs("div",{children:[p.jsx(Oi,{}),p.jsx(vi,{})]}),p.jsx(Ai,{})]})},en=M.div`
	${({variant:e})=>e==="minimal"?"":Rn}
	padding: 0;
`;en.defaultProps={theme:vt};const Ci=M(Nn)`
	padding: 8px 12px;
	min-height: ${({minHeight:e})=>e??"100px"};
	${({maxHeight:e})=>e&&`max-height: ${e};`}
	overflow-y: auto;
`;function Li(e){const i=xi[e.element.kind];return p.jsx(i,Object.assign({},e))}function ji(e){const i=Ri.text;return p.jsx(i,Object.assign({},e))}const wi=[{kind:"paragraph",children:[{kind:"text",text:""}],id:oe()}],Pi=({htmlId:e,style:i,maxHeight:s,minHeight:a,value:o,onChange:t,mediaApi:n,queryClient:c})=>{const r=f.useMemo(()=>Cn(ci(Ln(jn()))),[]),l=f.useCallback(()=>{k.select(r,F.end(r,[]))},[r]),u=f.useCallback(m=>{const I=Object.entries(Si).find(([x])=>Fe(x,m));if(!I)return;const R=I[1],T=R(r,m);T!=null&&T.allowDefault||m.preventDefault()},[r]),h=o!=null&&o.length?o:wi;return p.jsx(Ti,{value:n,children:p.jsx(Ot,{client:c,children:p.jsx(wn,{editor:r,value:h,onChange:t,children:p.jsxs(en,{variant:i,children:[p.jsx(Ni,{}),p.jsx(Ci,{onBlur:l,id:e,renderLeaf:ji,renderElement:Li,maxHeight:s,minHeight:a,onKeyDown:u})]})})})})},Ye="0.1.0";var pe,Qe;function Di(){return Qe||(Qe=1,pe=function(e){e.prototype[Symbol.iterator]=function*(){for(let i=this.head;i;i=i.next)yield i.value}}),pe}var he,Ke;function qi(){if(Ke)return he;Ke=1,he=e,e.Node=o,e.create=e;function e(t){var n=this;if(n instanceof e||(n=new e),n.tail=null,n.head=null,n.length=0,t&&typeof t.forEach=="function")t.forEach(function(l){n.push(l)});else if(arguments.length>0)for(var c=0,r=arguments.length;c<r;c++)n.push(arguments[c]);return n}e.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var n=t.next,c=t.prev;return n&&(n.prev=c),c&&(c.next=n),t===this.head&&(this.head=n),t===this.tail&&(this.tail=c),t.list.length--,t.next=null,t.prev=null,t.list=null,n},e.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var n=this.head;t.list=this,t.next=n,n&&(n.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},e.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var n=this.tail;t.list=this,t.prev=n,n&&(n.next=t),this.tail=t,this.head||(this.head=t),this.length++}},e.prototype.push=function(){for(var t=0,n=arguments.length;t<n;t++)s(this,arguments[t]);return this.length},e.prototype.unshift=function(){for(var t=0,n=arguments.length;t<n;t++)a(this,arguments[t]);return this.length},e.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},e.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},e.prototype.forEach=function(t,n){n=n||this;for(var c=this.head,r=0;c!==null;r++)t.call(n,c.value,r,this),c=c.next},e.prototype.forEachReverse=function(t,n){n=n||this;for(var c=this.tail,r=this.length-1;c!==null;r--)t.call(n,c.value,r,this),c=c.prev},e.prototype.get=function(t){for(var n=0,c=this.head;c!==null&&n<t;n++)c=c.next;if(n===t&&c!==null)return c.value},e.prototype.getReverse=function(t){for(var n=0,c=this.tail;c!==null&&n<t;n++)c=c.prev;if(n===t&&c!==null)return c.value},e.prototype.map=function(t,n){n=n||this;for(var c=new e,r=this.head;r!==null;)c.push(t.call(n,r.value,this)),r=r.next;return c},e.prototype.mapReverse=function(t,n){n=n||this;for(var c=new e,r=this.tail;r!==null;)c.push(t.call(n,r.value,this)),r=r.prev;return c},e.prototype.reduce=function(t,n){var c,r=this.head;if(arguments.length>1)c=n;else if(this.head)r=this.head.next,c=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var l=0;r!==null;l++)c=t(c,r.value,l),r=r.next;return c},e.prototype.reduceReverse=function(t,n){var c,r=this.tail;if(arguments.length>1)c=n;else if(this.tail)r=this.tail.prev,c=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var l=this.length-1;r!==null;l--)c=t(c,r.value,l),r=r.prev;return c},e.prototype.toArray=function(){for(var t=new Array(this.length),n=0,c=this.head;c!==null;n++)t[n]=c.value,c=c.next;return t},e.prototype.toArrayReverse=function(){for(var t=new Array(this.length),n=0,c=this.tail;c!==null;n++)t[n]=c.value,c=c.prev;return t},e.prototype.slice=function(t,n){n=n||this.length,n<0&&(n+=this.length),t=t||0,t<0&&(t+=this.length);var c=new e;if(n<t||n<0)return c;t<0&&(t=0),n>this.length&&(n=this.length);for(var r=0,l=this.head;l!==null&&r<t;r++)l=l.next;for(;l!==null&&r<n;r++,l=l.next)c.push(l.value);return c},e.prototype.sliceReverse=function(t,n){n=n||this.length,n<0&&(n+=this.length),t=t||0,t<0&&(t+=this.length);var c=new e;if(n<t||n<0)return c;t<0&&(t=0),n>this.length&&(n=this.length);for(var r=this.length,l=this.tail;l!==null&&r>n;r--)l=l.prev;for(;l!==null&&r>t;r--,l=l.prev)c.push(l.value);return c},e.prototype.splice=function(t,n,...c){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var r=0,l=this.head;l!==null&&r<t;r++)l=l.next;for(var u=[],r=0;l&&r<n;r++)u.push(l.value),l=this.removeNode(l);l===null&&(l=this.tail),l!==this.head&&l!==this.tail&&(l=l.prev);for(var r=0;r<c.length;r++)l=i(this,l,c[r]);return u},e.prototype.reverse=function(){for(var t=this.head,n=this.tail,c=t;c!==null;c=c.prev){var r=c.prev;c.prev=c.next,c.next=r}return this.head=n,this.tail=t,this};function i(t,n,c){var r=n===t.head?new o(c,null,n,t):new o(c,n,n.next,t);return r.next===null&&(t.tail=r),r.prev===null&&(t.head=r),t.length++,r}function s(t,n){t.tail=new o(n,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function a(t,n){t.head=new o(n,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function o(t,n,c,r){if(!(this instanceof o))return new o(t,n,c,r);this.list=r,this.value=t,n?(n.next=this,this.prev=n):this.prev=null,c?(c.prev=this,this.next=c):this.next=null}try{Di()(e)}catch{}return he}var fe,Ze;function Fi(){if(Ze)return fe;Ze=1;const e=qi(),i=Symbol("max"),s=Symbol("length"),a=Symbol("lengthCalculator"),o=Symbol("allowStale"),t=Symbol("maxAge"),n=Symbol("dispose"),c=Symbol("noDisposeOnSet"),r=Symbol("lruList"),l=Symbol("cache"),u=Symbol("updateAgeOnGet"),h=()=>1;class m{constructor(d){if(typeof d=="number"&&(d={max:d}),d||(d={}),d.max&&(typeof d.max!="number"||d.max<0))throw new TypeError("max must be a non-negative number");this[i]=d.max||1/0;const E=d.length||h;if(this[a]=typeof E!="function"?h:E,this[o]=d.stale||!1,d.maxAge&&typeof d.maxAge!="number")throw new TypeError("maxAge must be a number");this[t]=d.maxAge||0,this[n]=d.dispose,this[c]=d.noDisposeOnSet||!1,this[u]=d.updateAgeOnGet||!1,this.reset()}set max(d){if(typeof d!="number"||d<0)throw new TypeError("max must be a non-negative number");this[i]=d||1/0,T(this)}get max(){return this[i]}set allowStale(d){this[o]=!!d}get allowStale(){return this[o]}set maxAge(d){if(typeof d!="number")throw new TypeError("maxAge must be a non-negative number");this[t]=d,T(this)}get maxAge(){return this[t]}set lengthCalculator(d){typeof d!="function"&&(d=h),d!==this[a]&&(this[a]=d,this[s]=0,this[r].forEach(E=>{E.length=this[a](E.value,E.key),this[s]+=E.length})),T(this)}get lengthCalculator(){return this[a]}get length(){return this[s]}get itemCount(){return this[r].length}rforEach(d,E){E=E||this;for(let S=this[r].tail;S!==null;){const N=S.prev;P(this,d,S,E),S=N}}forEach(d,E){E=E||this;for(let S=this[r].head;S!==null;){const N=S.next;P(this,d,S,E),S=N}}keys(){return this[r].toArray().map(d=>d.key)}values(){return this[r].toArray().map(d=>d.value)}reset(){this[n]&&this[r]&&this[r].length&&this[r].forEach(d=>this[n](d.key,d.value)),this[l]=new Map,this[r]=new e,this[s]=0}dump(){return this[r].map(d=>R(this,d)?!1:{k:d.key,v:d.value,e:d.now+(d.maxAge||0)}).toArray().filter(d=>d)}dumpLru(){return this[r]}set(d,E,S){if(S=S||this[t],S&&typeof S!="number")throw new TypeError("maxAge must be a number");const N=S?Date.now():0,q=this[a](E,d);if(this[l].has(d)){if(q>this[i])return x(this,this[l].get(d)),!1;const b=this[l].get(d).value;return this[n]&&(this[c]||this[n](d,b.value)),b.now=N,b.maxAge=S,b.value=E,this[s]+=q-b.length,b.length=q,this.get(d),T(this),!0}const _=new L(d,E,q,N,S);return _.length>this[i]?(this[n]&&this[n](d,E),!1):(this[s]+=_.length,this[r].unshift(_),this[l].set(d,this[r].head),T(this),!0)}has(d){if(!this[l].has(d))return!1;const E=this[l].get(d).value;return!R(this,E)}get(d){return I(this,d,!0)}peek(d){return I(this,d,!1)}pop(){const d=this[r].tail;return d?(x(this,d),d.value):null}del(d){x(this,this[l].get(d))}load(d){this.reset();const E=Date.now();for(let S=d.length-1;S>=0;S--){const N=d[S],q=N.e||0;if(q===0)this.set(N.k,N.v);else{const _=q-E;_>0&&this.set(N.k,N.v,_)}}}prune(){this[l].forEach((d,E)=>I(this,E,!1))}}const I=(v,d,E)=>{const S=v[l].get(d);if(S){const N=S.value;if(R(v,N)){if(x(v,S),!v[o])return}else E&&(v[u]&&(S.value.now=Date.now()),v[r].unshiftNode(S));return N.value}},R=(v,d)=>{if(!d||!d.maxAge&&!v[t])return!1;const E=Date.now()-d.now;return d.maxAge?E>d.maxAge:v[t]&&E>v[t]},T=v=>{if(v[s]>v[i])for(let d=v[r].tail;v[s]>v[i]&&d!==null;){const E=d.prev;x(v,d),d=E}},x=(v,d)=>{if(d){const E=d.value;v[n]&&v[n](E.key,E.value),v[s]-=E.length,v[l].delete(E.key),v[r].removeNode(d)}};class L{constructor(d,E,S,N,q){this.key=d,this.value=E,this.length=S,this.now=N,this.maxAge=q||0}}const P=(v,d,E,S)=>{let N=E.value;R(v,N)&&(x(v,E),v[o]||(N=void 0)),N&&d.call(S,N.value,N.key,v)};return fe=m,fe}var me,Je;function ke(){if(Je)return me;Je=1;const e=["includePrerelease","loose","rtl"];return me=s=>s?typeof s!="object"?{loose:!0}:e.filter(a=>s[a]).reduce((a,o)=>(a[o]=!0,a),{}):{},me}var ne={exports:{}},Ee,Ve;function tn(){if(Ve)return Ee;Ve=1;const e="2.0.0",i=256,s=Number.MAX_SAFE_INTEGER||9007199254740991;return Ee={SEMVER_SPEC_VERSION:e,MAX_LENGTH:i,MAX_SAFE_INTEGER:s,MAX_SAFE_COMPONENT_LENGTH:16},Ee}var ye,et;function ce(){if(et)return ye;et=1;var e={};return ye=typeof process=="object"&&e&&e.NODE_DEBUG&&/\bsemver\b/i.test(e.NODE_DEBUG)?(...s)=>console.error("SEMVER",...s):()=>{},ye}var tt;function Ge(){return tt||(tt=1,function(e,i){const{MAX_SAFE_COMPONENT_LENGTH:s}=tn(),a=ce();i=e.exports={};const o=i.re=[],t=i.src=[],n=i.t={};let c=0;const r=(l,u,h)=>{const m=c++;a(l,m,u),n[l]=m,t[m]=u,o[m]=new RegExp(u,h?"g":void 0)};r("NUMERICIDENTIFIER","0|[1-9]\\d*"),r("NUMERICIDENTIFIERLOOSE","[0-9]+"),r("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),r("MAINVERSION",`(${t[n.NUMERICIDENTIFIER]})\\.(${t[n.NUMERICIDENTIFIER]})\\.(${t[n.NUMERICIDENTIFIER]})`),r("MAINVERSIONLOOSE",`(${t[n.NUMERICIDENTIFIERLOOSE]})\\.(${t[n.NUMERICIDENTIFIERLOOSE]})\\.(${t[n.NUMERICIDENTIFIERLOOSE]})`),r("PRERELEASEIDENTIFIER",`(?:${t[n.NUMERICIDENTIFIER]}|${t[n.NONNUMERICIDENTIFIER]})`),r("PRERELEASEIDENTIFIERLOOSE",`(?:${t[n.NUMERICIDENTIFIERLOOSE]}|${t[n.NONNUMERICIDENTIFIER]})`),r("PRERELEASE",`(?:-(${t[n.PRERELEASEIDENTIFIER]}(?:\\.${t[n.PRERELEASEIDENTIFIER]})*))`),r("PRERELEASELOOSE",`(?:-?(${t[n.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${t[n.PRERELEASEIDENTIFIERLOOSE]})*))`),r("BUILDIDENTIFIER","[0-9A-Za-z-]+"),r("BUILD",`(?:\\+(${t[n.BUILDIDENTIFIER]}(?:\\.${t[n.BUILDIDENTIFIER]})*))`),r("FULLPLAIN",`v?${t[n.MAINVERSION]}${t[n.PRERELEASE]}?${t[n.BUILD]}?`),r("FULL",`^${t[n.FULLPLAIN]}$`),r("LOOSEPLAIN",`[v=\\s]*${t[n.MAINVERSIONLOOSE]}${t[n.PRERELEASELOOSE]}?${t[n.BUILD]}?`),r("LOOSE",`^${t[n.LOOSEPLAIN]}$`),r("GTLT","((?:<|>)?=?)"),r("XRANGEIDENTIFIERLOOSE",`${t[n.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),r("XRANGEIDENTIFIER",`${t[n.NUMERICIDENTIFIER]}|x|X|\\*`),r("XRANGEPLAIN",`[v=\\s]*(${t[n.XRANGEIDENTIFIER]})(?:\\.(${t[n.XRANGEIDENTIFIER]})(?:\\.(${t[n.XRANGEIDENTIFIER]})(?:${t[n.PRERELEASE]})?${t[n.BUILD]}?)?)?`),r("XRANGEPLAINLOOSE",`[v=\\s]*(${t[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${t[n.XRANGEIDENTIFIERLOOSE]})(?:\\.(${t[n.XRANGEIDENTIFIERLOOSE]})(?:${t[n.PRERELEASELOOSE]})?${t[n.BUILD]}?)?)?`),r("XRANGE",`^${t[n.GTLT]}\\s*${t[n.XRANGEPLAIN]}$`),r("XRANGELOOSE",`^${t[n.GTLT]}\\s*${t[n.XRANGEPLAINLOOSE]}$`),r("COERCE",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?(?:$|[^\\d])`),r("COERCERTL",t[n.COERCE],!0),r("LONETILDE","(?:~>?)"),r("TILDETRIM",`(\\s*)${t[n.LONETILDE]}\\s+`,!0),i.tildeTrimReplace="$1~",r("TILDE",`^${t[n.LONETILDE]}${t[n.XRANGEPLAIN]}$`),r("TILDELOOSE",`^${t[n.LONETILDE]}${t[n.XRANGEPLAINLOOSE]}$`),r("LONECARET","(?:\\^)"),r("CARETTRIM",`(\\s*)${t[n.LONECARET]}\\s+`,!0),i.caretTrimReplace="$1^",r("CARET",`^${t[n.LONECARET]}${t[n.XRANGEPLAIN]}$`),r("CARETLOOSE",`^${t[n.LONECARET]}${t[n.XRANGEPLAINLOOSE]}$`),r("COMPARATORLOOSE",`^${t[n.GTLT]}\\s*(${t[n.LOOSEPLAIN]})$|^$`),r("COMPARATOR",`^${t[n.GTLT]}\\s*(${t[n.FULLPLAIN]})$|^$`),r("COMPARATORTRIM",`(\\s*)${t[n.GTLT]}\\s*(${t[n.LOOSEPLAIN]}|${t[n.XRANGEPLAIN]})`,!0),i.comparatorTrimReplace="$1$2$3",r("HYPHENRANGE",`^\\s*(${t[n.XRANGEPLAIN]})\\s+-\\s+(${t[n.XRANGEPLAIN]})\\s*$`),r("HYPHENRANGELOOSE",`^\\s*(${t[n.XRANGEPLAINLOOSE]})\\s+-\\s+(${t[n.XRANGEPLAINLOOSE]})\\s*$`),r("STAR","(<|>)?=?\\s*\\*"),r("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),r("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(ne,ne.exports)),ne.exports}var be,nt;function gi(){if(nt)return be;nt=1;const e=/^[0-9]+$/,i=(a,o)=>{const t=e.test(a),n=e.test(o);return t&&n&&(a=+a,o=+o),a===o?0:t&&!n?-1:n&&!t?1:a<o?-1:1};return be={compareIdentifiers:i,rcompareIdentifiers:(a,o)=>i(o,a)},be}var Ie,it;function _e(){if(it)return Ie;it=1;const e=ce(),{MAX_LENGTH:i,MAX_SAFE_INTEGER:s}=tn(),{re:a,t:o}=Ge(),t=ke(),{compareIdentifiers:n}=gi();class c{constructor(l,u){if(u=t(u),l instanceof c){if(l.loose===!!u.loose&&l.includePrerelease===!!u.includePrerelease)return l;l=l.version}else if(typeof l!="string")throw new TypeError(`Invalid Version: ${l}`);if(l.length>i)throw new TypeError(`version is longer than ${i} characters`);e("SemVer",l,u),this.options=u,this.loose=!!u.loose,this.includePrerelease=!!u.includePrerelease;const h=l.trim().match(u.loose?a[o.LOOSE]:a[o.FULL]);if(!h)throw new TypeError(`Invalid Version: ${l}`);if(this.raw=l,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(m=>{if(/^[0-9]+$/.test(m)){const I=+m;if(I>=0&&I<s)return I}return m}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(l){if(e("SemVer.compare",this.version,this.options,l),!(l instanceof c)){if(typeof l=="string"&&l===this.version)return 0;l=new c(l,this.options)}return l.version===this.version?0:this.compareMain(l)||this.comparePre(l)}compareMain(l){return l instanceof c||(l=new c(l,this.options)),n(this.major,l.major)||n(this.minor,l.minor)||n(this.patch,l.patch)}comparePre(l){if(l instanceof c||(l=new c(l,this.options)),this.prerelease.length&&!l.prerelease.length)return-1;if(!this.prerelease.length&&l.prerelease.length)return 1;if(!this.prerelease.length&&!l.prerelease.length)return 0;let u=0;do{const h=this.prerelease[u],m=l.prerelease[u];if(e("prerelease compare",u,h,m),h===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(h===void 0)return-1;if(h===m)continue;return n(h,m)}while(++u)}compareBuild(l){l instanceof c||(l=new c(l,this.options));let u=0;do{const h=this.build[u],m=l.build[u];if(e("prerelease compare",u,h,m),h===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(h===void 0)return-1;if(h===m)continue;return n(h,m)}while(++u)}inc(l,u){switch(l){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",u);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",u);break;case"prepatch":this.prerelease.length=0,this.inc("patch",u),this.inc("pre",u);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",u),this.inc("pre",u);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let h=this.prerelease.length;for(;--h>=0;)typeof this.prerelease[h]=="number"&&(this.prerelease[h]++,h=-2);h===-1&&this.prerelease.push(0)}u&&(n(this.prerelease[0],u)===0?isNaN(this.prerelease[1])&&(this.prerelease=[u,0]):this.prerelease=[u,0]);break;default:throw new Error(`invalid increment argument: ${l}`)}return this.format(),this.raw=this.version,this}}return Ie=c,Ie}var Re,st;function Z(){if(st)return Re;st=1;const e=_e();return Re=(s,a,o)=>new e(s,o).compare(new e(a,o)),Re}var xe,rt;function ki(){if(rt)return xe;rt=1;const e=Z();return xe=(s,a,o)=>e(s,a,o)===0,xe}var Se,ot;function Gi(){if(ot)return Se;ot=1;const e=Z();return Se=(s,a,o)=>e(s,a,o)!==0,Se}var Te,ct;function _i(){if(ct)return Te;ct=1;const e=Z();return Te=(s,a,o)=>e(s,a,o)>0,Te}var $e,at;function Mi(){if(at)return $e;at=1;const e=Z();return $e=(s,a,o)=>e(s,a,o)>=0,$e}var ve,lt;function Ui(){if(lt)return ve;lt=1;const e=Z();return ve=(s,a,o)=>e(s,a,o)<0,ve}var Oe,ut;function Bi(){if(ut)return Oe;ut=1;const e=Z();return Oe=(s,a,o)=>e(s,a,o)<=0,Oe}var Ae,dt;function Wi(){if(dt)return Ae;dt=1;const e=ki(),i=Gi(),s=_i(),a=Mi(),o=Ui(),t=Bi();return Ae=(c,r,l,u)=>{switch(r){case"===":return typeof c=="object"&&(c=c.version),typeof l=="object"&&(l=l.version),c===l;case"!==":return typeof c=="object"&&(c=c.version),typeof l=="object"&&(l=l.version),c!==l;case"":case"=":case"==":return e(c,l,u);case"!=":return i(c,l,u);case">":return s(c,l,u);case">=":return a(c,l,u);case"<":return o(c,l,u);case"<=":return t(c,l,u);default:throw new TypeError(`Invalid operator: ${r}`)}},Ae}var Ne,pt;function Xi(){if(pt)return Ne;pt=1;const e=Symbol("SemVer ANY");class i{static get ANY(){return e}constructor(u,h){if(h=s(h),u instanceof i){if(u.loose===!!h.loose)return u;u=u.value}n("comparator",u,h),this.options=h,this.loose=!!h.loose,this.parse(u),this.semver===e?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}parse(u){const h=this.options.loose?a[o.COMPARATORLOOSE]:a[o.COMPARATOR],m=u.match(h);if(!m)throw new TypeError(`Invalid comparator: ${u}`);this.operator=m[1]!==void 0?m[1]:"",this.operator==="="&&(this.operator=""),m[2]?this.semver=new c(m[2],this.options.loose):this.semver=e}toString(){return this.value}test(u){if(n("Comparator.test",u,this.options.loose),this.semver===e||u===e)return!0;if(typeof u=="string")try{u=new c(u,this.options)}catch{return!1}return t(u,this.operator,this.semver,this.options)}intersects(u,h){if(!(u instanceof i))throw new TypeError("a Comparator is required");if((!h||typeof h!="object")&&(h={loose:!!h,includePrerelease:!1}),this.operator==="")return this.value===""?!0:new r(u.value,h).test(this.value);if(u.operator==="")return u.value===""?!0:new r(this.value,h).test(u.semver);const m=(this.operator===">="||this.operator===">")&&(u.operator===">="||u.operator===">"),I=(this.operator==="<="||this.operator==="<")&&(u.operator==="<="||u.operator==="<"),R=this.semver.version===u.semver.version,T=(this.operator===">="||this.operator==="<=")&&(u.operator===">="||u.operator==="<="),x=t(this.semver,"<",u.semver,h)&&(this.operator===">="||this.operator===">")&&(u.operator==="<="||u.operator==="<"),L=t(this.semver,">",u.semver,h)&&(this.operator==="<="||this.operator==="<")&&(u.operator===">="||u.operator===">");return m||I||R&&T||x||L}}Ne=i;const s=ke(),{re:a,t:o}=Ge(),t=Wi(),n=ce(),c=_e(),r=nn();return Ne}var Ce,ht;function nn(){if(ht)return Ce;ht=1;class e{constructor(y,C){if(C=a(C),y instanceof e)return y.loose===!!C.loose&&y.includePrerelease===!!C.includePrerelease?y:new e(y.raw,C);if(y instanceof o)return this.raw=y.value,this.set=[[y]],this.format(),this;if(this.options=C,this.loose=!!C.loose,this.includePrerelease=!!C.includePrerelease,this.raw=y,this.set=y.split("||").map(O=>this.parseRange(O.trim())).filter(O=>O.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${y}`);if(this.set.length>1){const O=this.set[0];if(this.set=this.set.filter(A=>!m(A[0])),this.set.length===0)this.set=[O];else if(this.set.length>1){for(const A of this.set)if(A.length===1&&I(A[0])){this.set=[A];break}}}this.format()}format(){return this.range=this.set.map(y=>y.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(y){y=y.trim();const O=`parseRange:${Object.keys(this.options).join(",")}:${y}`,A=s.get(O);if(A)return A;const $=this.options.loose,j=$?c[r.HYPHENRANGELOOSE]:c[r.HYPHENRANGE];y=y.replace(j,_(this.options.includePrerelease)),t("hyphen replace",y),y=y.replace(c[r.COMPARATORTRIM],l),t("comparator trim",y),y=y.replace(c[r.TILDETRIM],u),y=y.replace(c[r.CARETTRIM],h),y=y.split(/\s+/).join(" ");let D=y.split(" ").map(G=>T(G,this.options)).join(" ").split(/\s+/).map(G=>q(G,this.options));$&&(D=D.filter(G=>(t("loose invalid filter",G,this.options),!!G.match(c[r.COMPARATORLOOSE])))),t("range list",D);const w=new Map,g=D.map(G=>new o(G,this.options));for(const G of g){if(m(G))return[G];w.set(G.value,G)}w.size>1&&w.has("")&&w.delete("");const B=[...w.values()];return s.set(O,B),B}intersects(y,C){if(!(y instanceof e))throw new TypeError("a Range is required");return this.set.some(O=>R(O,C)&&y.set.some(A=>R(A,C)&&O.every($=>A.every(j=>$.intersects(j,C)))))}test(y){if(!y)return!1;if(typeof y=="string")try{y=new n(y,this.options)}catch{return!1}for(let C=0;C<this.set.length;C++)if(U(this.set[C],y,this.options))return!0;return!1}}Ce=e;const i=Fi(),s=new i({max:1e3}),a=ke(),o=Xi(),t=ce(),n=_e(),{re:c,t:r,comparatorTrimReplace:l,tildeTrimReplace:u,caretTrimReplace:h}=Ge(),m=b=>b.value==="<0.0.0-0",I=b=>b.value==="",R=(b,y)=>{let C=!0;const O=b.slice();let A=O.pop();for(;C&&O.length;)C=O.every($=>A.intersects($,y)),A=O.pop();return C},T=(b,y)=>(t("comp",b,y),b=v(b,y),t("caret",b),b=L(b,y),t("tildes",b),b=E(b,y),t("xrange",b),b=N(b,y),t("stars",b),b),x=b=>!b||b.toLowerCase()==="x"||b==="*",L=(b,y)=>b.trim().split(/\s+/).map(C=>P(C,y)).join(" "),P=(b,y)=>{const C=y.loose?c[r.TILDELOOSE]:c[r.TILDE];return b.replace(C,(O,A,$,j,D)=>{t("tilde",b,O,A,$,j,D);let w;return x(A)?w="":x($)?w=`>=${A}.0.0 <${+A+1}.0.0-0`:x(j)?w=`>=${A}.${$}.0 <${A}.${+$+1}.0-0`:D?(t("replaceTilde pr",D),w=`>=${A}.${$}.${j}-${D} <${A}.${+$+1}.0-0`):w=`>=${A}.${$}.${j} <${A}.${+$+1}.0-0`,t("tilde return",w),w})},v=(b,y)=>b.trim().split(/\s+/).map(C=>d(C,y)).join(" "),d=(b,y)=>{t("caret",b,y);const C=y.loose?c[r.CARETLOOSE]:c[r.CARET],O=y.includePrerelease?"-0":"";return b.replace(C,(A,$,j,D,w)=>{t("caret",b,A,$,j,D,w);let g;return x($)?g="":x(j)?g=`>=${$}.0.0${O} <${+$+1}.0.0-0`:x(D)?$==="0"?g=`>=${$}.${j}.0${O} <${$}.${+j+1}.0-0`:g=`>=${$}.${j}.0${O} <${+$+1}.0.0-0`:w?(t("replaceCaret pr",w),$==="0"?j==="0"?g=`>=${$}.${j}.${D}-${w} <${$}.${j}.${+D+1}-0`:g=`>=${$}.${j}.${D}-${w} <${$}.${+j+1}.0-0`:g=`>=${$}.${j}.${D}-${w} <${+$+1}.0.0-0`):(t("no pr"),$==="0"?j==="0"?g=`>=${$}.${j}.${D}${O} <${$}.${j}.${+D+1}-0`:g=`>=${$}.${j}.${D}${O} <${$}.${+j+1}.0-0`:g=`>=${$}.${j}.${D} <${+$+1}.0.0-0`),t("caret return",g),g})},E=(b,y)=>(t("replaceXRanges",b,y),b.split(/\s+/).map(C=>S(C,y)).join(" ")),S=(b,y)=>{b=b.trim();const C=y.loose?c[r.XRANGELOOSE]:c[r.XRANGE];return b.replace(C,(O,A,$,j,D,w)=>{t("xRange",b,O,A,$,j,D,w);const g=x($),B=g||x(j),G=B||x(D),J=G;return A==="="&&J&&(A=""),w=y.includePrerelease?"-0":"",g?A===">"||A==="<"?O="<0.0.0-0":O="*":A&&J?(B&&(j=0),D=0,A===">"?(A=">=",B?($=+$+1,j=0,D=0):(j=+j+1,D=0)):A==="<="&&(A="<",B?$=+$+1:j=+j+1),A==="<"&&(w="-0"),O=`${A+$}.${j}.${D}${w}`):B?O=`>=${$}.0.0${w} <${+$+1}.0.0-0`:G&&(O=`>=${$}.${j}.0${w} <${$}.${+j+1}.0-0`),t("xRange return",O),O})},N=(b,y)=>(t("replaceStars",b,y),b.trim().replace(c[r.STAR],"")),q=(b,y)=>(t("replaceGTE0",b,y),b.trim().replace(c[y.includePrerelease?r.GTE0PRE:r.GTE0],"")),_=b=>(y,C,O,A,$,j,D,w,g,B,G,J,Vi)=>(x(O)?C="":x(A)?C=`>=${O}.0.0${b?"-0":""}`:x($)?C=`>=${O}.${A}.0${b?"-0":""}`:j?C=`>=${C}`:C=`>=${C}${b?"-0":""}`,x(g)?w="":x(B)?w=`<${+g+1}.0.0-0`:x(G)?w=`<${g}.${+B+1}.0-0`:J?w=`<=${g}.${B}.${G}-${J}`:b?w=`<${g}.${B}.${+G+1}-0`:w=`<=${w}`,`${C} ${w}`.trim()),U=(b,y,C)=>{for(let O=0;O<b.length;O++)if(!b[O].test(y))return!1;if(y.prerelease.length&&!C.includePrerelease){for(let O=0;O<b.length;O++)if(t(b[O].semver),b[O].semver!==o.ANY&&b[O].semver.prerelease.length>0){const A=b[O].semver;if(A.major===y.major&&A.minor===y.minor&&A.patch===y.patch)return!0}return!1}return!0};return Ce}var Le,ft;function Hi(){if(ft)return Le;ft=1;const e=nn();return Le=(s,a,o)=>{try{a=new e(a,o)}catch{return!1}return a.test(s)},Le}var zi=Hi();const Yi=on(zi),Qi=[];let Ki=0;const sn=({value:e,onChange:i,label:s})=>{const a=De(),o=Pt(),t=f.useMemo(()=>`cb-rich-text-editor-${Ki++}`,[]),n=e==null?void 0:e.documentVersion,c=(e==null?void 0:e.document)??Qi,r=f.useCallback(l=>{i({document:l,documentVersion:Ye})},[i]);return n&&!Yi(Ye,`^${n}`)?p.jsx("p",{children:"Your document version is not compatible with form component"}):p.jsx(W,{label:s,labelFor:t,children:p.jsx(Pi,{value:c,onChange:r,queryClient:a,mediaApi:o,htmlId:t,maxHeight:"400px"})})};sn.__docgenInfo={description:"",methods:[],displayName:"RichTextWidget",props:{onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: TValue) => void",signature:{arguments:[{type:{name:"TValue"},name:"value"}],return:{name:"void"}}},description:`The change handler for the field. It's
first parameter should include the full
updated value.`},label:{required:!0,tsType:{name:"string"},description:"The title of the field"},aggregation:{required:!0,tsType:{name:"union",raw:"TAggregates | undefined",elements:[{name:"TAggregates"},{name:"undefined"}]},description:`If the field has aggregates, this prop
will contain the raw aggregate expressions
specified in either the schema or the
aggregates object`},value:{required:!0,tsType:{name:"union",raw:"TValue | undefined",elements:[{name:"TValue"},{name:"undefined"}]},description:`The value from the form data (i.e.
what has been passed into \`updateValue\`).

Initially, it is set to undefined`},aggregatedValue:{required:!0,tsType:{name:"union",raw:"TValue | undefined",elements:[{name:"TValue"},{name:"undefined"}]},description:"The value to display if not being edited,\nmay simply be `value`, may be derived from\na combination of `value` and other data,\nor may be completely derived from other data"},schema:{required:!0,tsType:{name:"CampaignBuddySchema"},description:"The JSON scheme for this property"},aggregationSupport:{required:!0,tsType:{name:"unknown"},description:`Whether or not this field supports aggregation (regardless
of current field settings). This will be an object for
complex aggregations.`},entityApi:{required:!0,tsType:{name:"union",raw:"EntityApi | undefined",elements:[{name:"EntityApi"},{name:"undefined"}]},description:"If provided, the api to query entities"},fieldSettings:{required:!0,tsType:{name:"union",raw:"FieldSettings<TAggregates> | undefined",elements:[{name:"FieldSettings",elements:[{name:"TAggregates"}],raw:"FieldSettings<TAggregates>"},{name:"undefined"}]},description:"The field settings for the rendered field"},updateFieldSettings:{required:!0,tsType:{name:"union",raw:`| ((fieldSettings: FieldSettings<TAggregates>) => void)
| undefined`,elements:[{name:"unknown"},{name:"undefined"}]},description:"An optional callback to update field settings"},currentUserRole:{required:!0,tsType:{name:"union",raw:"string | undefined",elements:[{name:"string"},{name:"undefined"}]},description:`If provided to the FormGenerator component, the
role of the current user. This property is useful
for determining what field settings a user may change.`}}};const Zi=M.div`
	position: relative;
	width: 100%;
	height: 200px;
	display: flex;
	align-items: center;
	justify-content: center;
	max-width: 100%;
	border-radius: 4px;
	overflow: hidden;

	img {
		object-fit: contain;
		width: 100%;
		height: 100%;
	}
`,Ji=M.div`
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	opacity: ${({shouldStayVisible:e})=>e?1:0};
	transition: opacity 0.2s;
	display: flex;
	align-items: center;
	justify-content: center;
	background-color: lightgrey;
	cursor: pointer;

	&:hover,
	&:focus {
		opacity: 1;
	}
`,rn=({value:e,aggregatedValue:i,aggregationSupport:s,label:a,rawLabel:o,onChange:t})=>{const n=Pt(),c=De(),[r,l,u]=re(),h=!s.url,m=s.url?i==null?void 0:i.url:e==null?void 0:e.url,I=f.useCallback(T=>{u(),t({url:T})},[t,u]);let R;return m?R=p.jsx("img",{alt:o,src:m}):R=p.jsx(p.Fragment,{children:p.jsx("p",{children:"No Image"})}),p.jsx(W,{label:a,children:p.jsxs(Zi,{children:[R,h&&p.jsx(At,{isOpen:r,onClose:u,onConfirm:I,mediaApi:n,queryClient:c,children:p.jsx(Ji,{shouldStayVisible:r,role:"button",onClick:l,tabIndex:0,children:p.jsx("p",{children:"Upload Image"})})})]})})};rn.__docgenInfo={description:"",methods:[],displayName:"ImageWidget"};const fs={number:X(kt),string:X(Gt),boolean:X(Lt),array:Ct,Stat:X(_t,[{label:"Compute base value?",path:"$.base"},{label:"Compute bonus value?",path:"$.bonus"}]),EntityPicker:X(Wt,[{label:"Compute selected value?",path:"$.entity"},{label:"Compute available options?",path:"$.availableEntityIds"}]),MultiEntityPicker:X(Xt,[{label:"Compute selected values?",path:"$.entities"},{label:"Compute available options?",path:"$.availableEntityIds"}]),RichText:sn,MultiChoice:X(Ut,[{label:"Compute selected values?",path:"$.selectedOptions"}]),Choice:X(Mt,[{label:"Compute selected value?",path:"$.selectedOption"}]),Image:X(rn,[{label:"Compute image?",path:"$.url"}]),SchemaBuilder:()=>null,NumericResource:X(Ht,[{label:"Compute current value?",path:"$.current"},{label:"Compute max value?",path:"$.max"}])};export{Bn as F,hs as a,fs as w};
