import{r as i,R as F}from"./index-tnPESBdE.js";import{n as U}from"./navigateObject-ZMXbUPar.js";import"./parchmentTheme-CF6Ki9yW.js";import{j as H}from"./jsx-runtime-PJfywvQB.js";import"./index-C4WGByT4.js";import{u as $}from"./useUpdatingRef-CQrjiaKT.js";import{u as I}from"./useCombinedRefs-G3-tKQwR.js";import{i as G}from"./index-ChYhBiAs.js";function J(e){return typeof e=="object"&&e!==null&&"toCss"in e&&typeof e.toCss=="function"&&typeof e.toCss()=="string"}function le(e,t){return e.__cbTag=t,e}function Q(e,t){return i.useMemo(()=>F.Children.toArray(e).filter(r=>W(r,t)),[e,t])}function fe(e,t){const n=Q(e,t);if(n.length>1)throw new Error("Multiple tagged children encountered");return n[0]}function W(e,t){return typeof e=="object"&&e!==null&&"type"in e&&typeof e.type!="string"&&"__cbTag"in e.type&&e.type.__cbTag===t}function S(e,t){const n=i.useRef(void 0);return i.useCallback(r=>{var o;(o=n==null?void 0:n.current)===null||o===void 0||o.call(n),r&&(n.current=e(r))},t)}function X(e,t){return S(n=>{if(n)return n.dataset[e]=t,()=>{delete n.dataset[e]}},[e,t])}function B(e,t,n=!0){const r=i.useRef(t);return r.current=t,S(o=>{if(!n)return;const a=p=>{r.current(p)};return o.addEventListener(e,a),()=>{o.removeEventListener(e,a)}},[n,e])}function K(e){return J(e)?e.toCss():typeof e=="number"?isNaN(e)?"0px":`${e}px`:e}function N(e){function t(...n){const{theme:r}=n[0],o=U({root:r,location:e});return K(o)}return new Proxy(t,{get(n,r){return r==="prototype"?Object.prototype:N(typeof r=="string"?[...e,r]:e)}})}const ve=N([]);function me(e){return t=>{var n;const r=t.variant,o=(n=e[r])!==null&&n!==void 0?n:e._;return typeof o=="function"?o(t):K(o)}}function O(){return h()[0]}function Y(){const e=h();return e[e.length-1]}function M(){return h().find(e=>e.isActive)}function P(e=1){const t=h(),n=t.findIndex(o=>o.isActive);if(n===-1)return t[0];const r=n+e;return r<0?t[t.length-Math.abs(r%t.length)]:t[r%t.length]}function h(){var e;if(!document)return[];const t=document.querySelectorAll("[data-composite-control-node]"),n=[];for(const r of Z(t)){const o=(e=r.dataset)===null||e===void 0?void 0:e.compositeControlNode;if(!o)continue;const a=document.activeElement===r||r.contains(document.activeElement);n.push({id:o,isActive:a})}return n}function Z(e){const t=[];return e.forEach(n=>t.push(n)),t}function j(e,t=!0){const n=ee(e);return B("keydown",n,t)}function ee(e){const t=i.useRef(e);t.current=e;const n=i.useMemo(()=>Object.keys(e).map(r=>({handler:()=>{var o,a;return(a=(o=t.current)[r])===null||a===void 0?void 0:a.call(o)},eventIsHotkey:G(r)})),Object.keys(e));return i.useCallback(r=>{for(const{handler:o,eventIsHotkey:a}of n)a(r)&&o()},[n])}function te(e,t="vertical"){const n=j({home:()=>e.moveToStart(),end:()=>e.moveToEnd(),enter:()=>{var m,s,d;return(d=(s=(m=e.getFocused())===null||m===void 0?void 0:m.meta)===null||s===void 0?void 0:s.onActivate)===null||d===void 0?void 0:d.call(s)},space:()=>{var m,s,d;return(d=(s=(m=e.getFocused())===null||m===void 0?void 0:m.meta)===null||s===void 0?void 0:s.onActivate)===null||d===void 0?void 0:d.call(s)}}),r=j({up:()=>e.movePrevious(),down:()=>e.moveNext()}),o=j({left:()=>e.movePrevious(),right:()=>e.moveNext()}),a=I(n,r),p=I(n,o);return t==="vertical"?a:p}var ne=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]]);return n};const z=F.createContext(void 0);function be(e){var{initiallyFocused:t,children:n,orientation:r,role:o,accessibleId:a,onBlur:p}=e,m=ne(e,["initiallyFocused","children","orientation","role","accessibleId","onBlur"]);const s=i.useRef({}),d=i.useRef(),v=i.useRef(!0),C=i.useRef(t),w=i.useRef(null),E=$(p),y=i.useCallback(u=>{var c,l;if(d.current===u||(d.current=u,!u))return;const f=h();for(const{id:b}of f)b===d.current?(c=s.current[b])===null||c===void 0||c.setTabIndex(0):(l=s.current[b])===null||l===void 0||l.setTabIndex(-1)},[]),L=i.useMemo(()=>({registerChild:(u,c,l,f)=>{var b;return s.current[u]={focus:c,setTabIndex:l,meta:f},!((b=f==null?void 0:f.current)===null||b===void 0)&&b.isSelected?(y(u),v.current=!1):!d.current&&v.current?y(u):l(-1),()=>{var x;delete s.current[u],d.current===u&&y((x=O())===null||x===void 0?void 0:x.id)}},onBlur:()=>{queueMicrotask(()=>{var u;!E.current||document.activeElement&&(!((u=w.current)===null||u===void 0)&&u.contains(document.activeElement))||E.current()})}}),[y,E]),g=i.useCallback(u=>{var c;u&&((c=s.current[u.id])===null||c===void 0||c.focus(),v.current=!1,y(u.id))},[y]),_=i.useCallback(u=>{var c;const f=h().find(({id:x})=>{var k,T,A;return((T=(k=s.current[x])===null||k===void 0?void 0:k.meta)===null||T===void 0?void 0:T.current)&&u((A=s.current[x].meta)===null||A===void 0?void 0:A.current)});if(!f)return;const b=s.current[f.id];return{focus:b.focus,setTabIndex:b.setTabIndex,meta:(c=b.meta)===null||c===void 0?void 0:c.current}},[]),R=i.useCallback(()=>{const u=_(l=>!!l.isSelected);if(u){u.focus();return}const c=M();g(c||O())},[_,g]),q=i.useMemo(()=>({moveNext:()=>g(P()),movePrevious:()=>g(P(-1)),moveToStart:()=>g(O()),moveToEnd:()=>g(Y()),getFocused:()=>{var u,c;const l=M();if(l&&s.current[l.id]){const f=s.current[l.id];return{focus:f.focus,setTabIndex:f.setTabIndex,meta:(c=(u=f.meta)===null||u===void 0?void 0:u.current)!==null&&c!==void 0?c:void 0}}},find:_,focus:R}),[_,R,g]),V=te(q,r),D=I(V,w);return i.useEffect(()=>{C.current&&R()},[R]),H.jsx(z.Provider,{value:L,children:H.jsx("div",Object.assign({},m,{ref:D,role:o,id:a,children:n}))})}function pe(e){const t=i.useContext(z),n=i.useRef(null),r=i.useRef(e),o=i.useRef(-1);if(r.current=e,!t)throw new Error("No control group context given");const a=i.useId(),{registerChild:p}=t,m=S(v=>{v.setAttribute("tabindex",o.current.toString())},[]);i.useEffect(()=>p(a,()=>{var v;(v=n.current)===null||v===void 0||v.focus()},v=>{var C;o.current=v,(C=n.current)===null||C===void 0||C.setAttribute("tabindex",v.toString())},r),[a,p]);const s=X("compositeControlNode",a),d=B("blur",()=>{t.onBlur()});return I(n,s,m,d)}export{be as C,le as a,pe as b,j as c,Q as d,ve as t,fe as u,me as v};
