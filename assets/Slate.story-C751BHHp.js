import{j as o}from"./jsx-runtime-PJfywvQB.js";import{r}from"./index-tnPESBdE.js";import"./index-D_0btrl3.js";import{P as L,I as M,F as O,B as $,d as z,c as ae,e as ce}from"./useShowToast-DNWSesNN.js";import"./index-C4WGByT4.js";import{M as le}from"./ImageGrid-BPNgWImq.js";import{w as de,Q as ue}from"./index.esm-CPT3nVmo.js";import{E as k,a as c,T as l,b as pe,u as j,R as P,c as B,d as y,L as me,e as fe,f as he,I as xe,g as E,h as ge,w as ke,i as ve,S as Ce,j as ye}from"./ImagePickerMenu-CLHp6kTt.js";import{i as F}from"./index-ChYhBiAs.js";import{c as T}from"./index-go6VP56j.js";import{H as b}from"./styled-components.browser.esm-CuL3HyEV.js";import{u as V}from"./useBooleanState-BvRGCuoP.js";import{Q as be}from"./queryClient-C86Hojab.js";import"./fuse.esm-BSXXkDLL.js";import"./index-BJt650PE.js";import"./index-aBkx2qY1.js";import"./inheritsLoose-XbxvykFZ.js";import"./useCombinedRefs-Dfiq_Z7b.js";import"./index-B9gZL0fq.js";import"./jsonSchemaTypes-BjqZX6rF.js";import"./isObjectLike-C4XLuBz8.js";const je=["image"],Ee=["link"];function Se(e){const{normalizeNode:n}=e;return e.isVoid=t=>je.includes(t.kind),e.isInline=t=>Ee.includes(t.kind),e.normalizeNode=t=>{const[s,i]=t;if(k.isElement(s)&&e.isVoid(s)&&!c.next(e,{at:i,voids:!0})){l.insertNodes(e,{id:T(),kind:"paragraph",children:[{text:"",kind:"text"}]},{at:c.end(e,[])});return}if(k.isElement(s)&&s.kind==="link"&&H(s)){l.removeNodes(e,{at:i});return}n(t)},e}function H(e){return!e.children.some(n=>pe.isText(n)?!!n.text:k.isElement(n)?H(n):!0)}function N(e,n){return t=>t[e]===void 0?"":typeof n=="string"?n:n(t[e])}const Ie=b.span`
	${N("isBold","font-weight: bold;")}
	${N("isItalic","font-style: italic;")}
	${N("isUnderline","text-decoration: underline;")}
`,Q=({leaf:e,attributes:n,children:t})=>o.jsx(Ie,{...e??{},...n,children:t});Q.__docgenInfo={description:"",methods:[],displayName:"FormattedTextNode",props:{leaf:{required:!0,tsType:{name:"T"},description:""}},composes:["RenderLeafProps"]};const Te=b.span`
	font-size: 0;
`,w=()=>o.jsxs(Te,{contentEditable:!1,children:["$",String.fromCodePoint(160)]});w.__docgenInfo={description:"",methods:[],displayName:"InlineChromiumBugfix"};function Ne(e){const n=j();return U(n,e)}function U(e,n){const[t]=c.nodes(e,{match:s=>!c.isEditor(s)&&k.isElement(s)&&s.kind===n});return!!t}function K(e,n){Pe(e);const{selection:t}=e;U(e,n.kind)&&G(e,n.kind);const s=t&&P.isCollapsed(t),i={...n,id:T()},a=c.isVoid(e,i);return s||a?(a&&l.collapse(e,{edge:"end"}),l.insertNodes(e,i)):(l.wrapNodes(e,i,{split:!0}),l.collapse(e,{edge:"end"})),i}function G(e,n){l.unwrapNodes(e,{match:t=>!c.isEditor(t)&&k.isElement(t)&&t.kind===n})}function Pe(e){const n=e.selection&&c.void(e,{at:e.selection});if(n){const t=c.after(e,n[1])??c.end(e,[]);l.select(e,t)}}function we(e,n){const s=c.nodes(e,{match:u=>!c.isEditor(u)&&k.isElement(u)&&u.id===n}).next().value;if(!s)return null;const[i,a]=s;return k.isElement(i)?[i,a]:null}function W(e,n){const[,t]=we(e,n)??[null,null];if(!t)return;const s=c.end(e,t);l.select(e,s)}function R(){const e=B(),n=r.useRef([]),t=r.useCallback(()=>{const i=e.selection;i&&n.current.push(c.rangeRef(e,i))},[e]),s=r.useCallback(()=>{const i=n.current.pop();if(!i)return null;const a=i==null?void 0:i.unref();return a?(y.isFocused(e)||y.focus(e),l.select(e,a),a):null},[e]);return r.useEffect(()=>()=>{for(const i of n.current)i.unref()},[]),{pushSelectionSnapshot:t,popSelectionSnapshot:s,snapshotStack:n}}function Be(){const e=j();if(!e.selection)return;const[[n]]=c.nodes(e,{match:t=>!c.isEditor(t)&&k.isElement(t)});if(k.isElement(n))return n}const J=({attributes:e,children:n,element:t})=>{const s=j(),[i,a,u]=V(),{pushSelectionSnapshot:x,popSelectionSnapshot:d}=R(),[m,v]=r.useState(t.url),C=r.useCallback(()=>{x(),a()},[x,a]),p=r.useCallback(()=>{if(m!==t.url){const h=y.findPath(s,t);l.setNodes(s,{...t,url:m},{at:h})}u(),d()},[u,s,t,m,d]),f=r.useCallback(h=>{h.target.select()},[]),g=r.useCallback(h=>{F("enter",h)&&(h.preventDefault(),p())},[p]);return o.jsx("span",{...e,children:o.jsx(L,{isOpen:i,onClose:p,autoFocus:!1,content:o.jsxs(o.Fragment,{children:[o.jsx(M,{label:"URL",value:m,onChange:v,onKeyDown:g,onFocus:f}),o.jsx(O,{justifyContent:"flex-end",children:o.jsx($,{onClick:p,children:"Close"})})]}),placement:"bottom",children:o.jsxs(me,{onClick:C,children:[o.jsx(w,{}),n,o.jsx(w,{})]})})})};J.__docgenInfo={description:"",methods:[],displayName:"LinkNode",props:{element:{required:!0,tsType:{name:"T"},description:""}},composes:["RenderElementProps"]};const X=({attributes:e,children:n})=>o.jsx(Fe,{...e,children:n}),Fe=b.p`
	margin: 8px 0;
`;X.__docgenInfo={description:"",methods:[],displayName:"ParagraphNode",props:{element:{required:!0,tsType:{name:"T"},description:""}},composes:["RenderElementProps"]};const Y=({element:e,attributes:n,children:t})=>{const s=fe(),i=he();return o.jsxs("div",{...n,children:[t,o.jsx("div",{contentEditable:!1,children:o.jsx(Re,{src:e.src,alt:e.alt,shouldHighlight:s&&i})})]})},Re=b.img`
	display: block;
	max-width: 100%;
	max-height: 20em;
	box-shadow: ${({shouldHighlight:e})=>e?"0 0 0 3px #B4D5FF":"none"};
`;Y.__docgenInfo={description:"",methods:[],displayName:"ImageNode",props:{element:{required:!0,tsType:{name:"T"},description:""}},composes:["RenderElementProps"]};const _e={text:Q},Ae={link:J,paragraph:X,image:Y},qe={left:e=>{if(e.selection){if(!P.isCollapsed(e.selection)){l.collapse(e,{edge:"start"});return}l.move(e,{unit:"offset",reverse:!0})}},right:e=>{if(e.selection){if(!P.isCollapsed(e.selection)){l.collapse(e,{edge:"end"});return}l.move(e,{unit:"offset"})}},backspace:e=>{if(c.void(e)){l.delete(e,{unit:"block"}),l.move(e,{unit:"offset",reverse:!0});return}return{allowDefault:!0}}},Z=r.createContext(null),De=Z.Provider;function Le(){const e=r.useContext(Z);if(!e)throw new Error("Must provide media api context");return e}const ee=()=>{const e=B(),n=r.useRef(null),{pushSelectionSnapshot:t,popSelectionSnapshot:s,snapshotStack:i}=R(),a=Le(),u=de(),[x,d]=r.useState(!1),m=r.useCallback(()=>{d(!1),s()},[s,d]),v=r.useCallback(()=>{var f;((f=i.current)==null?void 0:f.length)===0&&t(),d(!0)},[t,i]),C=r.useCallback((f,g)=>{n.current&&l.select(e,n.current);const{id:h}=K(e,{kind:"image",children:[{text:"",kind:"text"}],src:f,alt:(g==null?void 0:g.alt)??f});W(e,h),l.move(e,{unit:"offset"}),n.current=null,m()},[m,e]),p=r.useCallback((f,g)=>{f==="main-menu"&&g!=="none"&&(n.current=s())},[s]);return o.jsx(xe,{isOpen:x,onClose:close,onConfirm:C,onStateTransition:p,mediaApi:a,queryClient:u,children:o.jsx(E,{icon:"media",onChange:v,size:"small",value:!1})})};ee.__docgenInfo={description:"",methods:[],displayName:"AddImageButton"};const ne=()=>{const e=j(),[n,t]=r.useState(""),{pushSelectionSnapshot:s,popSelectionSnapshot:i}=R(),a=Ne("link"),[u,x,d]=V(),m=r.useCallback(()=>{d(),i();const{id:p}=K(e,{kind:"link",url:n,children:[{kind:"text",text:n}]});W(e,p),l.move(e,{unit:"offset"})},[d,i,e,n]),v=r.useCallback(()=>{if(a){G(e,"link");return}s(),x()},[e,a,x,s]),C=r.useCallback(p=>{F("enter",p)&&(p.preventDefault(),m())},[m]);return o.jsx(L,{isOpen:u,onClose:d,content:o.jsxs(o.Fragment,{children:[o.jsx(M,{label:"URL",value:n,onChange:t,autoFocus:!0,onKeyDown:C}),o.jsx(O,{justifyContent:"flex-end",children:o.jsx($,{onClick:m,children:"Add link"})})]}),placement:"bottom-start",children:o.jsx(E,{value:a,icon:"link",onChange:v,size:"small"})})};ne.__docgenInfo={description:"",methods:[],displayName:"AddLinkButton"};const te=()=>{const e=B(),n=Be(),t=r.useCallback(a=>{if(!e.selection)return;l.collapse(e);let u;a==="above"?u=c.before(e,e.selection)??c.start(e,[]):u=c.after(e,e.selection)??c.end(e,[]),l.insertNodes(e,{id:T(),kind:"paragraph",children:[{kind:"text",text:""}]},{at:u})},[e]),s=r.useCallback(()=>t("above"),[t]),i=r.useCallback(()=>t("below"),[t]);return!n||!e.isVoid(n)?null:o.jsxs("div",{children:[o.jsx(E,{size:"small",icon:"double-chevron-up",onChange:s,value:!1}),o.jsx(E,{size:"small",icon:"double-chevron-down",onChange:i,value:!1})]})};te.__docgenInfo={description:"",methods:[],displayName:"InsertLineBreakButtons"};const I=({icon:e,format:n})=>{var a;const t=j(),s=!!((a=c.marks(t))!=null&&a[n]),i=r.useCallback(()=>{y.isFocused(t)||y.focus(t),s?c.removeMark(t,n):c.addMark(t,n,!0)},[s,n,t]);return o.jsx(E,{value:s,onChange:i,icon:e,size:"small",preventFocus:!0})};I.__docgenInfo={description:"",methods:[],displayName:"MarkToggle",props:{icon:{required:!0,tsType:{name:"ReactComponentProps['icon']",raw:"React.ComponentProps<typeof ToggleButton>['icon']"},description:""},format:{required:!0,tsType:{name:"Formatting"},description:""}}};const oe=b.div`
	display: flex;
	gap: 16px;
	padding: 4px;
	border-bottom: 1px ${({theme:e})=>e.legacyCoreUi.colors.textDisabled}
		solid;
	cursor: default;
`;oe.defaultProps={theme:z};const se=()=>{const e=j(),n=r.useRef(null),t=r.useCallback(s=>{var i;(i=n.current)!=null&&i.contains(s.target)&&s.preventDefault(),y.isFocused(e)||y.focus(e)},[e]);return o.jsxs(oe,{onMouseDown:t,ref:n,children:[o.jsxs("div",{children:[o.jsx(I,{icon:"bold",format:"isBold"}),o.jsx(I,{icon:"italic",format:"isItalic"}),o.jsx(I,{icon:"underline",format:"isUnderline"})]}),o.jsxs("div",{children:[o.jsx(ne,{}),o.jsx(ee,{})]}),o.jsx(te,{})]})};se.__docgenInfo={description:"",methods:[],displayName:"Toolbar"};const ie=b.div`
	${({variant:e})=>e==="minimal"?"":ae}
	padding: 0;
`;ie.defaultProps={theme:z};const Me=b(ge)`
	padding: 8px 12px;
	min-height: ${({minHeight:e})=>e??"100px"};
	${({maxHeight:e})=>e&&`max-height: ${e};`}
	overflow-y: auto;
`;function Oe(e){const n=Ae[e.element.kind];return o.jsx(n,{...e})}function $e(e){const n=_e.text;return o.jsx(n,{...e})}const ze=[{kind:"paragraph",children:[{kind:"text",text:""}],id:T()}],_=({htmlId:e,style:n,maxHeight:t,minHeight:s,value:i,onChange:a,mediaApi:u,queryClient:x})=>{const d=r.useMemo(()=>ke(Se(ve(ye()))),[]),m=r.useCallback(()=>{l.select(d,c.end(d,[]))},[d]),v=r.useCallback(p=>{const f=Object.entries(qe).find(([re])=>F(re,p));if(!f)return;const g=f[1],h=g(d,p);h!=null&&h.allowDefault||p.preventDefault()},[d]),C=i!=null&&i.length?i:ze;return o.jsx(De,{value:u,children:o.jsx(ue,{client:x,children:o.jsx(Ce,{editor:d,value:C,onChange:a,children:o.jsxs(ie,{variant:n,children:[o.jsx(se,{}),o.jsx(Me,{onBlur:m,id:e,renderLeaf:$e,renderElement:Oe,maxHeight:t,minHeight:s,onKeyDown:v})]})})})})};_.__docgenInfo={description:"",methods:[],displayName:"RichTextEditor",props:{value:{required:!0,tsType:{name:"union",raw:"RichTextDocument | undefined",elements:[{name:"Array",elements:[{name:"Descendant"}],raw:"Descendant[]"},{name:"undefined"}]},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"(value: RichTextDocument) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"Descendant"}],raw:"Descendant[]"},name:"value"}],return:{name:"void"}}},description:""},mediaApi:{required:!0,tsType:{name:"MediaApi"},description:""},queryClient:{required:!0,tsType:{name:"QueryClient"},description:""},htmlId:{required:!1,tsType:{name:"string"},description:""},minHeight:{required:!1,tsType:{name:"string"},description:""},maxHeight:{required:!1,tsType:{name:"string"},description:""},style:{required:!1,tsType:{name:"union",raw:"'default' | 'minimal'",elements:[{name:"literal",value:"'default'"},{name:"literal",value:"'minimal'"}]},description:""}}};const fn={title:"rich-text/RichTextEditor",component:_},Ve=new le,He=new be,Qe=()=>{const[e,n]=r.useState([]);return o.jsx(ce,{label:"Edit me!",labelFor:"editor",children:o.jsx(_,{mediaApi:Ve,value:e,onChange:n,htmlId:"editor",queryClient:He})})},S=Qe.bind({});var A,q,D;S.parameters={...S.parameters,docs:{...(A=S.parameters)==null?void 0:A.docs,source:{originalSource:`() => {
  const [value, setValue] = useState<RichTextDocument>([]);
  return <FormGroup label="Edit me!" labelFor="editor">
            <RichTextEditor mediaApi={mediaApi} value={value} onChange={setValue} htmlId="editor" queryClient={queryClient} />
        </FormGroup>;
}`,...(D=(q=S.parameters)==null?void 0:q.docs)==null?void 0:D.source}}};export{S as Primary,fn as default};
