import{j as se}from"./jsx-runtime-PJfywvQB.js";import{r as oe,R as Ti,c as xe,g as ha}from"./index-tnPESBdE.js";import{c as fa,u as da,r as Is,s as xs,b as pa,e as ga,F as ya,d as ba}from"./createSmartContext-BVs5Jhf5.js";import{n as Ls}from"./navigateObject-ZMXbUPar.js";import"./index-C4WGByT4.js";import{o as Ns,g as ma,h as wa,n as lr,b as _a,s as Le}from"./jsonSchemaTypes-BjqZX6rF.js";import"./index-D_0btrl3.js";import{I as va,S as Sa,N as Ca,C as Ea}from"./useShowToast-DNWSesNN.js";import{H as Jr}from"./styled-components.browser.esm-CuL3HyEV.js";function sn(){return sn=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},sn.apply(this,arguments)}function ka(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Cr(t,e)}function Cr(t,e){return Cr=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Cr(t,e)}function Ra(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var xn=0;function Oi(){return xn>0}function Er(t){xn++;try{return t()}finally{xn--,xn===0&&Oa()}}var Kr=function(){function t(n){this.trigger=n,this.observing=new Map}var e=t.prototype;return e.registerConnection=function(r){var i=this.observing.get(r.observable);i||(i={byKey:new Set,iterate:!1},this.observing.set(r.observable,i)),r.type==="iterate"?i.iterate=!0:i.byKey.add(r.key)},e.removeObservers=function(){var r=this;this.observing.forEach(function(i,o){i.iterate&&o[ce].connections.iterate.delete(r),i.byKey.forEach(function(a){o[ce].connections.byKey.get(a).delete(r)})}),this.observing.clear()},t}(),dt=[],Gn=function(t){ka(e,t);function e(r,i,o){var a;if(a=t.call(this,function(){return a._trigger()})||this,a.func=r,a.options=i,a.effect=o,a.isInitial=!0,a.reaction=function(){dt.push(Ra(a));try{a.func()}finally{dt.pop()}a.effect&&(!a.isInitial||a.options.fireImmediately)&&a.effect(),a.isInitial=!1},!o&&!a.options.fireImmediately)throw new Error("if no effect function passed, should always fireImmediately");return a.reaction(),a}var n=e.prototype;return n._trigger=function(){if(dt.includes(this))throw new Error("already running reaction");this.removeObservers(),this.reaction()},e}(Kr);function Di(){return!!dt.length}function Ii(){return dt.length?dt[dt.length-1]:void 0}function Aa(t,e,n){var r=sn({name:"unnamed",fireImmediately:!0},n),i=new Gn(t,r,e);return i}var kr=!1;function xi(){return kr}function Li(t){kr=!0;try{t()}finally{kr=!1}}function Ta(t){return function(){return Li(t)}}var Rr=[];function Oa(){var t=[].concat(Rr);Rr=[],Ni(t)}function Ni(t){var e=new Set;t.forEach(function(n){var r;(n.type==="add"||n.type==="delete")&&n.observable[ce].connections.iterate.forEach(function(i){e.add(i)}),(r=n.observable[ce].connections.byKey.get(n.key))==null||r.forEach(function(i){e.add(i)})}),e.forEach(function(n){n.trigger()})}function kn(t){if(Oi()){Rr.push(t);return}Ni([t])}function Ms(t,e){if(t.type==="iterate")t.observable[ce].connections.iterate.add(e);else{var n=t.observable[ce].connections.byKey.get(t.key);n||(n=new Set,t.observable[ce].connections.byKey.set(t.key,n)),n.add(e)}}function Rn(t,e){if(!xi()){var n=Ii();n&&(Ms(t,n),n.registerConnection(t)),e&&(Ms(t,e),e.registerConnection(t))}}var Xr=Symbol("$skipreactive"),ce=Symbol("$reactive"),Se=Symbol("$reactiveproxy");function wn(t,e){return!!(t&&t[Se]&&t[Se].implicitObserver===e)}function Zr(t){return t[Xr]=!0,t}function Mi(t){return!!(t&&!wn(t)&&t[ce])}function Ar(t,e,n){if(n===void 0&&(n=!1),t[Xr]||wn(t,e))return t;var r=Da(t,n);if(!e)return r;var i=r[ce].proxiesWithImplicitObserver.get(e);if(!i){var o={implicitObserver:e};Object.setPrototypeOf(o,Ui),i=new Proxy(r[ce].raw,o),r[ce].proxiesWithImplicitObserver.set(e,i)}return i}var Nt=Ar;function Da(t,e){if(e===void 0&&(e=!1),wn(t))return t;if(Mi(t))return t[ce].proxy;if(t[ce]||t[Se])throw new Error("unexpected");var n={connections:{iterate:new Set,byKey:new Map},proxy:{},raw:t,proxiesWithImplicitObserver:new Map,shallow:e};Object.defineProperty(t,ce,{enumerable:!1,writable:!0,configurable:!0,value:n});var r=new Proxy(t,Ui);return n.proxy=r,r}var Ui={has:function(e,n){var r=Reflect.has(e,n);return typeof n=="symbol"||Rn({observable:e,key:n,type:"has"},this.implicitObserver),r},get:function(e,n,r){if(n===Se)return{implicitObserver:this.implicitObserver};var i=Reflect.get(e,n,r);if(typeof n=="symbol")return i;if(n==="length"&&Array.isArray(e)?Rn({observable:e,type:"iterate"},this.implicitObserver):Rn({observable:e,key:n,type:"get"},this.implicitObserver),Mi(i))return Ar(i,this.implicitObserver);if(e[ce].shallow)return i;if(typeof i=="object"&&i!==null&&!wn(i,this.implicitObserver)&&!Object.isFrozen(i)){var o=Reflect.getOwnPropertyDescriptor(e,n);if((!o||!(o.writable===!1&&o.configurable===!1))&&(Di()||this.implicitObserver))return Ar(i,this.implicitObserver)}return i},ownKeys:function(e){return Rn({observable:e,type:"iterate"},this.implicitObserver),Reflect.ownKeys(e)},set:function(e,n,r,i){return Er(function(){if(typeof n=="symbol")return Reflect.set(e,n,r,i);var o=Object.hasOwnProperty.call(e,n),a=Reflect.get(e,n,i),c=Reflect.set(e,n,r,i);if(!o)kn({observable:e,key:n,value:r,type:"add"});else if(r!==a)if(n==="length"&&Array.isArray(e)){if(!(a<r))for(var u=r+1;u<=a;u++)kn({observable:e,key:""+(u-1),oldValue:void 0,type:"delete"})}else kn({observable:e,key:n,value:r,oldValue:a,type:"update"});return c})},deleteProperty:function(e,n){return Er(function(){if(typeof n=="symbol")return Reflect.deleteProperty(e,n);var r=Object.hasOwnProperty.call(e,n),i=Reflect.get(e,n),o=Reflect.deleteProperty(e,n);return r&&kn({observable:e,key:n,oldValue:i,type:"delete"}),o})},preventExtensions:function(e){throw new Error("Dynamic observable objects cannot be frozen")}};function Ia(t,e){var n=sn({name:"unnamed",fireImmediately:!0},e),r=new Gn(t,n);return r}function xa(t,e,n){var r=sn({name:"unnamed",fireImmediately:!0},n),i=new Gn(function(){t(e)},r);return e=Nt(e,i),e.bla=4,r.fireImmediately&&i.trigger(),i}var Fi=function(){function t(){this._observable=Nt({_key:1})}var e=t.prototype;return e.reportObserved=function(r){return Nt(this._observable,r)._key},e.reportChanged=function(){this._observable._key++},t}();function La(t,e,n){return new Fi}const Na=Object.freeze(Object.defineProperty({__proto__:null,$reactive:ce,$reactiveproxy:Se,$skipreactive:Xr,Atom:Fi,Observer:Kr,Reaction:Gn,autorun:Ia,autorunAsync:xa,createAtom:La,hasRunningReaction:Di,isActionRunning:Oi,isReactive:wn,isTrackingDisabled:xi,markRaw:Zr,reaction:Aa,reactive:Nt,runInAction:Er,runningReaction:Ii,untracked:Li,untrackedCB:Ta},Symbol.toStringTag,{value:"Module"}));function Ma(t,e){var n=oe.useReducer(function(c){return c+1},0),r=n[1],i=oe.useRef(),o=oe.useRef(!1);i.current||(i.current=new Kr(function(){o.current&&r()}));var a=oe.useMemo(function(){return i.current.removeObservers(),Nt(t,i.current)},[]);return oe.useEffect(function(){return o.current=!0,i.current||r(),function(){o.current=!1,i.current.removeObservers(),i.current=null}},[]),a}const Oe=()=>new Map,Tr=t=>{const e=Oe();return t.forEach((n,r)=>{e.set(r,n)}),e},lt=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Ua=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Fa=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},Mt=()=>new Set,ur=t=>t[t.length-1],Pa=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},it=Array.from;let ja=class{constructor(){this._observers=Oe()}on(e,n){lt(this._observers,e,Mt).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return it((this._observers.get(e)||Oe()).values()).forEach(r=>r(...n))}destroy(){this._observers=Oe()}};const ot=Math.floor,Ln=Math.abs,Pi=(t,e)=>t<e?t:e,Ct=(t,e)=>t>e?t:e,ji=t=>t!==0?t<0:1/t<0,Ba=t=>t.toLowerCase(),$a=/^\s*/g,Va=t=>t.replace($a,""),Wa=/([A-Z])/g,Us=(t,e)=>Va(t.replace(Wa,n=>`${e}${Ba(n)}`)),qa=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},on=typeof TextEncoder<"u"?new TextEncoder:null,Ha=t=>on.encode(t),za=on?Ha:qa;let en=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});en&&en.decode(new Uint8Array).length===1&&(en=null);const Fs=t=>t===void 0?null:t;let Ya=class{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}},Bi=new Ya,Ga=!0;try{typeof localStorage<"u"&&(Bi=localStorage,Ga=!1)}catch{}const Ja=Bi,Ka=Object.keys,Ps=t=>Ka(t).length,Xa=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Za=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Qa=(t,e)=>t===e||Ps(t)===Ps(e)&&Xa(t,(n,r)=>(n!==void 0||Za(e,r))&&e[r]===n),Qr=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Qr(t,e,n+1)}},ec=(t,e)=>e.includes(t);var $i={};const an=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name);let Ne;const tc=()=>{if(Ne===void 0)if(an){Ne=Oe();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Ne.set(e,""),e=r):e!==null&&(Ne.set(e,r),e=null)}e!==null&&Ne.set(e,"")}else typeof location=="object"?(Ne=Oe(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Ne.set(`--${Us(e,"-")}`,n),Ne.set(`-${Us(e,"-")}`,n)}})):Ne=Oe();return Ne},Or=t=>tc().has(t),Dr=t=>Fs(an?$i[t.toUpperCase()]:Ja.getItem(t)),nc=t=>Or("--"+t)||Dr(t)!==null;nc("production");const js=an&&ec($i.FORCE_COLOR,["true","1","2"]),rc=!Or("no-colors")&&(!an||process.stdout.isTTY||js)&&(!an||Or("color")||js||Dr("COLORTERM")!==null||(Dr("TERM")||"").includes("color")),Bs=1,$s=2,hr=4,fr=8,cn=32,He=64,_e=128,Jn=31,Ir=63,pt=127,sc=2147483647,Vi=Number.MAX_SAFE_INTEGER,ic=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&ot(t)===t),Ht=t=>new Error(t),Fe=()=>{throw Ht("Method unimplemented")},je=()=>{throw Ht("Unexpected case")},Wi=Ht("Unexpected end of array"),qi=Ht("Integer out of Range");let Kn=class{constructor(e){this.arr=e,this.pos=0}};const zt=t=>new Kn(t),oc=t=>t.pos!==t.arr.length,ac=(t,e)=>{const n=ns(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},ye=t=>ac(t,H(t)),Ut=t=>t.arr[t.pos++],H=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&pt)*n,n*=128,i<_e)return e;if(e>Vi)throw qi}throw Wi},es=t=>{let e=t.arr[t.pos++],n=e&Ir,r=64;const i=(e&He)>0?-1:1;if((e&_e)===0)return i*n;const o=t.arr.length;for(;t.pos<o;){if(e=t.arr[t.pos++],n=n+(e&pt)*r,r*=128,e<_e)return i*n;if(n>Vi)throw qi}throw Wi},cc=t=>{let e=H(t);if(e===0)return"";{let n=String.fromCodePoint(Ut(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Ut(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},lc=t=>en.decode(ye(t)),Dt=en?lc:cc,ts=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},uc=t=>ts(t,4).getFloat32(0,!1),hc=t=>ts(t,8).getFloat64(0,!1),fc=t=>ts(t,8).getBigInt64(0,!1),dc=[t=>{},t=>null,es,uc,hc,fc,t=>!1,t=>!0,Dt,t=>{const e=H(t),n={};for(let r=0;r<e;r++){const i=Dt(t);n[i]=ln(t)}return n},t=>{const e=H(t),n=[];for(let r=0;r<e;r++)n.push(ln(t));return n},ye],ln=t=>dc[127-Ut(t)](t);class Vs extends Kn{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),oc(this)?this.count=H(this)+1:this.count=-1),this.count--,this.s}}class Nn extends Kn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=es(this);const e=ji(this.s);this.count=1,e&&(this.s=-this.s,this.count=H(this)+2)}return this.count--,this.s}}class dr extends Kn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=es(this),n=e&1;this.diff=ot(e/2),this.count=1,n&&(this.count=H(this)+2)}return this.s+=this.diff,this.count--,this.s}}class pc{constructor(e){this.decoder=new Nn(e),this.str=Dt(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const gc=t=>new Uint8Array(t),ns=(t,e,n)=>new Uint8Array(t,e,n),yc=t=>{const e=gc(t.byteLength);return e.set(t),e};let _n=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}};const Xn=()=>new _n,bc=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},Ue=t=>{const e=new Uint8Array(bc(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(ns(t.cbuf.buffer,0,t.cpos),n),e},mc=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(ns(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Ct(n,e)*2),t.cpos=0)},ue=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},xr=ue,J=(t,e)=>{for(;e>pt;)ue(t,_e|pt&e),e=ot(e/128);ue(t,pt&e)},rs=(t,e)=>{const n=ji(e);for(n&&(e=-e),ue(t,(e>Ir?_e:0)|(n?He:0)|Ir&e),e=ot(e/64);e>0;)ue(t,(e>pt?_e:0)|pt&e),e=ot(e/128)},Lr=new Uint8Array(3e4),wc=Lr.length/3,_c=(t,e)=>{if(e.length<wc){const n=on.encodeInto(e,Lr).written||0;J(t,n);for(let r=0;r<n;r++)ue(t,Lr[r])}else be(t,za(e))},vc=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;J(t,r);for(let i=0;i<r;i++)ue(t,n.codePointAt(i))},It=on&&on.encodeInto?_c:vc,Zn=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Pi(n-r,e.length),o=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,o>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Ct(n*2,o)),t.cbuf.set(e.subarray(i)),t.cpos=o)},be=(t,e)=>{J(t,e.byteLength),Zn(t,e)},ss=(t,e)=>{mc(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Sc=(t,e)=>ss(t,4).setFloat32(0,e,!1),Cc=(t,e)=>ss(t,8).setFloat64(0,e,!1),Ec=(t,e)=>ss(t,8).setBigInt64(0,e,!1),Ws=new DataView(new ArrayBuffer(4)),kc=t=>(Ws.setFloat32(0,t),Ws.getFloat32(0)===t),un=(t,e)=>{switch(typeof e){case"string":ue(t,119),It(t,e);break;case"number":ic(e)&&Ln(e)<=sc?(ue(t,125),rs(t,e)):kc(e)?(ue(t,124),Sc(t,e)):(ue(t,123),Cc(t,e));break;case"bigint":ue(t,122),Ec(t,e);break;case"object":if(e===null)ue(t,126);else if(e instanceof Array){ue(t,117),J(t,e.length);for(let n=0;n<e.length;n++)un(t,e[n])}else if(e instanceof Uint8Array)ue(t,116),be(t,e);else{ue(t,118);const n=Object.keys(e);J(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];It(t,i),un(t,e[i])}}break;case"boolean":ue(t,e?120:121);break;default:ue(t,127)}};class qs extends _n{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&J(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Hs=t=>{t.count>0&&(rs(t.encoder,t.count===1?t.s:-t.s),t.count>1&&J(t.encoder,t.count-2))};class Mn{constructor(){this.encoder=new _n,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Hs(this),this.count=1,this.s=e)}toUint8Array(){return Hs(this),Ue(this.encoder)}}const zs=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);rs(t.encoder,e),t.count>1&&J(t.encoder,t.count-2)}};class pr{constructor(){this.encoder=new _n,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(zs(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return zs(this),Ue(this.encoder)}}class Rc{constructor(){this.sarr=[],this.s="",this.lensE=new Mn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new _n;return this.sarr.push(this.s),this.s="",It(e,this.sarr.join("")),Zn(e,this.lensE.toUint8Array()),Ue(e)}}const Ac=crypto.getRandomValues.bind(crypto),Hi=()=>Ac(new Uint32Array(1))[0],Tc="10000000-1000-4000-8000"+-1e11,Oc=()=>Tc.replace(/[018]/g,t=>(t^Hi()&15>>t/4).toString(16)),Ys=t=>new Promise(t);let Dc=class{constructor(e,n){this.left=e,this.right=n}};const We=(t,e)=>new Dc(t,e);typeof DOMParser<"u"&&new DOMParser;const Ic=t=>Ua(t,(e,n)=>`${n}:${e};`).join(""),Je=Symbol,zi=Je(),Yi=Je(),xc=Je(),Lc=Je(),Nc=Je(),Gi=Je(),Mc=Je(),Ji=Je(),Uc=Je(),Fc=t=>{const e=[];let n=0;for(;n<t.length;n++){const r=t[n];r.constructor===String||r.constructor===Number||r.constructor===Object&&e.push(JSON.stringify(r))}return e},Pc={[zi]:We("font-weight","bold"),[Yi]:We("font-weight","normal"),[xc]:We("color","blue"),[Nc]:We("color","green"),[Lc]:We("color","grey"),[Gi]:We("color","red"),[Mc]:We("color","purple"),[Ji]:We("color","orange"),[Uc]:We("color","black")},jc=t=>{const e=[],n=[],r=Oe();let i=[],o=0;for(;o<t.length;o++){const a=t[o],c=Pc[a];if(c!==void 0)r.set(c.left,c.right);else if(a.constructor===String||a.constructor===Number){const u=Ic(r);o>0||u.length>0?(e.push("%c"+a),n.push(u)):e.push(a)}else break}for(o>0&&(i=n,i.unshift(e.join("")));o<t.length;o++){const a=t[o];a instanceof Symbol||i.push(a)}return i},Bc=rc?jc:Fc,$c=(...t)=>{console.log(...Bc(t)),Vc.forEach(e=>e.print(t))},Vc=Mt(),Ki=t=>({[Symbol.iterator](){return this},next:t}),Wc=(t,e)=>Ki(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),gr=(t,e)=>Ki(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class is{constructor(e,n){this.clock=e,this.len=n}}class vn{constructor(){this.clients=new Map}}const Nr=(t,e,n)=>e.clients.forEach((r,i)=>{const o=t.doc.store.clients.get(i);for(let a=0;a<r.length;a++){const c=r[a];lo(t,o,c.clock,c.len,n)}}),qc=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=ot((n+r)/2),o=t[i],a=o.clock;if(a<=e){if(e<a+o.len)return i;n=i+1}else r=i-1}return null},Xi=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&qc(n,e.clock)!==null},os=t=>{t.clients.forEach(e=>{e.sort((i,o)=>i.clock-o.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],o=e[n];i.clock+i.len>=o.clock?i.len=Ct(i.len,o.clock+o.len-i.clock):(r<n&&(e[r]=o),r++)}e.length=r})},Hc=t=>{const e=new vn;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const o=r.slice();for(let a=n+1;a<t.length;a++)Pa(o,t[a].clients.get(i)||[]);e.clients.set(i,o)}});return os(e),e},Fn=(t,e,n,r)=>{lt(t.clients,e,()=>[]).push(new is(n,r))},zc=()=>new vn,Yc=t=>{const e=zc();return t.clients.forEach((n,r)=>{const i=[];for(let o=0;o<n.length;o++){const a=n[o];if(a.deleted){const c=a.id.clock;let u=a.length;if(o+1<n.length)for(let p=n[o+1];o+1<n.length&&p.deleted;p=n[++o+1])u+=p.length;i.push(new is(c,u))}}i.length>0&&e.clients.set(r,i)}),e},Yt=(t,e)=>{J(t.restEncoder,e.clients.size),it(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),J(t.restEncoder,n);const i=r.length;J(t.restEncoder,i);for(let o=0;o<i;o++){const a=r[o];t.writeDsClock(a.clock),t.writeDsLen(a.len)}})},as=t=>{const e=new vn,n=H(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=H(t.restDecoder),o=H(t.restDecoder);if(o>0){const a=lt(e.clients,i,()=>[]);for(let c=0;c<o;c++)a.push(new is(t.readDsClock(),t.readDsLen()))}}return e},Gs=(t,e,n)=>{const r=new vn,i=H(t.restDecoder);for(let o=0;o<i;o++){t.resetDsCurVal();const a=H(t.restDecoder),c=H(t.restDecoder),u=n.clients.get(a)||[],p=fe(n,a);for(let b=0;b<c;b++){const h=t.readDsClock(),d=h+t.readDsLen();if(h<p){p<d&&Fn(r,a,p,d-p);let g=De(u,h),y=u[g];for(!y.deleted&&y.id.clock<h&&(u.splice(g+1,0,Vn(e,y,h-y.id.clock)),g++);g<u.length&&(y=u[g++],y.id.clock<d);)y.deleted||(d<y.id.clock+y.length&&u.splice(g,0,Vn(e,y,d-y.id.clock)),y.delete(e))}else Fn(r,a,h,d-h)}}if(r.clients.size>0){const o=new mt;return J(o.restEncoder,0),Yt(o,r),o.toUint8Array()}return null},Zi=Hi;class Et extends ja{constructor({guid:e=Oc(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:a=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Zi(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new ao,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=a,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Ys(p=>{this.on("load",()=>{this.isLoaded=!0,p(this)})});const u=()=>Ys(p=>{const b=h=>{(h===void 0||h===!0)&&(this.off("sync",b),p())};this.on("sync",b)});this.on("sync",p=>{p===!1&&this.isSynced&&(this.whenSynced=u()),this.isSynced=p===void 0||p===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=u()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Q(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(it(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Q(this,e,n)}get(e,n=re){const r=lt(this.share,e,()=>{const o=new n;return o._integrate(this,null),o}),i=r.constructor;if(n!==re&&i!==n)if(i===re){const o=new n;o._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=o}),o._start=r._start;for(let a=o._start;a!==null;a=a.right)a.parent=o;return o._length=r._length,this.share.set(e,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Pe)}getText(e=""){return this.get(e,Ye)}getMap(e=""){return this.get(e,Be)}getXmlFragment(e=""){return this.get(e,$e)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){it(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new Et({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Q(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,n){super.on(e,n)}off(e,n){super.off(e,n)}}class Qi{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return H(this.restDecoder)}readDsLen(){return H(this.restDecoder)}}class eo extends Qi{readLeftID(){return K(H(this.restDecoder),H(this.restDecoder))}readRightID(){return K(H(this.restDecoder),H(this.restDecoder))}readClient(){return H(this.restDecoder)}readInfo(){return Ut(this.restDecoder)}readString(){return Dt(this.restDecoder)}readParentInfo(){return H(this.restDecoder)===1}readTypeRef(){return H(this.restDecoder)}readLen(){return H(this.restDecoder)}readAny(){return ln(this.restDecoder)}readBuf(){return yc(ye(this.restDecoder))}readJSON(){return JSON.parse(Dt(this.restDecoder))}readKey(){return Dt(this.restDecoder)}}class Gc{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=H(this.restDecoder),this.dsCurrVal}readDsLen(){const e=H(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Ft extends Gc{constructor(e){super(e),this.keys=[],H(e),this.keyClockDecoder=new dr(ye(e)),this.clientDecoder=new Nn(ye(e)),this.leftClockDecoder=new dr(ye(e)),this.rightClockDecoder=new dr(ye(e)),this.infoDecoder=new Vs(ye(e),Ut),this.stringDecoder=new pc(ye(e)),this.parentInfoDecoder=new Vs(ye(e),Ut),this.typeRefDecoder=new Nn(ye(e)),this.lenDecoder=new Nn(ye(e))}readLeftID(){return new xt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new xt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ln(this.restDecoder)}readBuf(){return ye(this.restDecoder)}readJSON(){return ln(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class to{constructor(){this.restEncoder=Xn()}toUint8Array(){return Ue(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){J(this.restEncoder,e)}writeDsLen(e){J(this.restEncoder,e)}}class Sn extends to{writeLeftID(e){J(this.restEncoder,e.client),J(this.restEncoder,e.clock)}writeRightID(e){J(this.restEncoder,e.client),J(this.restEncoder,e.clock)}writeClient(e){J(this.restEncoder,e)}writeInfo(e){xr(this.restEncoder,e)}writeString(e){It(this.restEncoder,e)}writeParentInfo(e){J(this.restEncoder,e?1:0)}writeTypeRef(e){J(this.restEncoder,e)}writeLen(e){J(this.restEncoder,e)}writeAny(e){un(this.restEncoder,e)}writeBuf(e){be(this.restEncoder,e)}writeJSON(e){It(this.restEncoder,JSON.stringify(e))}writeKey(e){It(this.restEncoder,e)}}class no{constructor(){this.restEncoder=Xn(),this.dsCurrVal=0}toUint8Array(){return Ue(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,J(this.restEncoder,n)}writeDsLen(e){e===0&&je(),J(this.restEncoder,e-1),this.dsCurrVal+=e}}class mt extends no{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new pr,this.clientEncoder=new Mn,this.leftClockEncoder=new pr,this.rightClockEncoder=new pr,this.infoEncoder=new qs(xr),this.stringEncoder=new Rc,this.parentInfoEncoder=new qs(xr),this.typeRefEncoder=new Mn,this.lenEncoder=new Mn}toUint8Array(){const e=Xn();return J(e,0),be(e,this.keyClockEncoder.toUint8Array()),be(e,this.clientEncoder.toUint8Array()),be(e,this.leftClockEncoder.toUint8Array()),be(e,this.rightClockEncoder.toUint8Array()),be(e,Ue(this.infoEncoder)),be(e,this.stringEncoder.toUint8Array()),be(e,Ue(this.parentInfoEncoder)),be(e,this.typeRefEncoder.toUint8Array()),be(e,this.lenEncoder.toUint8Array()),Zn(e,Ue(this.restEncoder)),Ue(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){un(this.restEncoder,e)}writeBuf(e){be(this.restEncoder,e)}writeJSON(e){un(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Jc=(t,e,n,r)=>{r=Ct(r,e[0].id.clock);const i=De(e,r);J(t.restEncoder,e.length-i),t.writeClient(n),J(t.restEncoder,r);const o=e[i];o.write(t,r-o.id.clock);for(let a=i+1;a<e.length;a++)e[a].write(t,0)},cs=(t,e,n)=>{const r=new Map;n.forEach((i,o)=>{fe(e,o)>i&&r.set(o,i)}),Qn(e).forEach((i,o)=>{n.has(o)||r.set(o,0)}),J(t.restEncoder,r.size),it(r.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{Jc(t,e.clients.get(i),i,o)})},Kc=(t,e)=>{const n=Oe(),r=H(t.restDecoder);for(let i=0;i<r;i++){const o=H(t.restDecoder),a=new Array(o),c=t.readClient();let u=H(t.restDecoder);n.set(c,{i:0,refs:a});for(let p=0;p<o;p++){const b=t.readInfo();switch(Jn&b){case 0:{const h=t.readLen();a[p]=new we(K(c,u),h),u+=h;break}case 10:{const h=H(t.restDecoder);a[p]=new ve(K(c,u),h),u+=h;break}default:{const h=(b&(He|_e))===0,d=new ae(K(c,u),null,(b&_e)===_e?t.readLeftID():null,null,(b&He)===He?t.readRightID():null,h?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,h&&(b&cn)===cn?t.readString():null,Oo(t,b));a[p]=d,u+=d.length}}}}return n},Xc=(t,e,n)=>{const r=[];let i=it(n.keys()).sort((g,y)=>g-y);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let g=n.get(i[i.length-1]);for(;g.refs.length===g.i;)if(i.pop(),i.length>0)g=n.get(i[i.length-1]);else return null;return g};let a=o();if(a===null&&r.length===0)return null;const c=new ao,u=new Map,p=(g,y)=>{const S=u.get(g);(S==null||S>y)&&u.set(g,y)};let b=a.refs[a.i++];const h=new Map,d=()=>{for(const g of r){const y=g.id.client,S=n.get(y);S?(S.i--,c.clients.set(y,S.refs.slice(S.i)),n.delete(y),S.i=0,S.refs=[]):c.clients.set(y,[g]),i=i.filter(N=>N!==y)}r.length=0};for(;;){if(b.constructor!==ve){const y=lt(h,b.id.client,()=>fe(e,b.id.client))-b.id.clock;if(y<0)r.push(b),p(b.id.client,b.id.clock-1),d();else{const S=b.getMissing(t,e);if(S!==null){r.push(b);const N=n.get(S)||{refs:[],i:0};if(N.refs.length===N.i)p(S,fe(e,S)),d();else{b=N.refs[N.i++];continue}}else(y===0||y<b.length)&&(b.integrate(t,y),h.set(b.id.client,b.id.clock+b.length))}}if(r.length>0)b=r.pop();else if(a!==null&&a.i<a.refs.length)b=a.refs[a.i++];else{if(a=o(),a===null)break;b=a.refs[a.i++]}}if(c.clients.size>0){const g=new mt;return cs(g,c,new Map),J(g.restEncoder,0),{missing:u,update:g.toUint8Array()}}return null},Zc=(t,e)=>cs(t,e.doc.store,e.beforeState),Qc=(t,e,n,r=new Ft(t))=>Q(e,i=>{i.local=!1;let o=!1;const a=i.doc,c=a.store,u=Kc(r,a),p=Xc(i,c,u),b=c.pendingStructs;if(b){for(const[d,g]of b.missing)if(g<fe(c,d)){o=!0;break}if(p){for(const[d,g]of p.missing){const y=b.missing.get(d);(y==null||y>g)&&b.missing.set(d,g)}b.update=Pn([b.update,p.update])}}else c.pendingStructs=p;const h=Gs(r,i,c);if(c.pendingDs){const d=new Ft(zt(c.pendingDs));H(d.restDecoder);const g=Gs(d,i,c);h&&g?c.pendingDs=Pn([h,g]):c.pendingDs=h||g}else c.pendingDs=h;if(o){const d=c.pendingStructs.update;c.pendingStructs=null,ro(i.doc,d)}},n,!1),ro=(t,e,n,r=Ft)=>{const i=zt(e);Qc(i,t,n,new r(i))},el=(t,e,n)=>ro(t,e,n,eo),tl=(t,e,n=new Map)=>{cs(t,e.store,n),Yt(t,Yc(e.store))},nl=(t,e=new Uint8Array([0]),n=new mt)=>{const r=so(e);tl(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(ml(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Sn)return yl(i.map((o,a)=>a===0?o:_l(o)));if(n.constructor===mt)return Pn(i)}return i[0]},rl=(t,e)=>nl(t,e,new Sn),sl=t=>{const e=new Map,n=H(t.restDecoder);for(let r=0;r<n;r++){const i=H(t.restDecoder),o=H(t.restDecoder);e.set(i,o)}return e},so=t=>sl(new Qi(zt(t))),io=(t,e)=>(J(t.restEncoder,e.size),it(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{J(t.restEncoder,n),J(t.restEncoder,r)}),t),il=(t,e)=>io(t,Qn(e.store)),ol=(t,e=new no)=>(t instanceof Map?io(e,t):il(e,t),e.toUint8Array()),al=t=>ol(t,new to);class cl{constructor(){this.l=[]}}const Js=()=>new cl,Ks=(t,e)=>t.l.push(e),Xs=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},oo=(t,e,n)=>Qr(t.l,[e,n]);class xt{constructor(e,n){this.client=e,this.clock=n}}const An=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,K=(t,e)=>new xt(t,e),ll=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw je()},Zt=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Xi(e.ds,t.id),Mr=(t,e)=>{const n=lt(t.meta,Mr,Mt),r=t.doc.store;n.has(e)||(e.sv.forEach((i,o)=>{i<fe(r,o)&&at(t,K(o,i))}),Nr(t,e.ds,i=>{}),n.add(e))};class ao{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Qn=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},fe=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},co=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw je()}n.push(e)},De=(t,e)=>{let n=0,r=t.length-1,i=t[r],o=i.id.clock;if(o===e)return r;let a=ot(e/(o+i.length-1)*r);for(;n<=r;){if(i=t[a],o=i.id.clock,o<=e){if(e<o+i.length)return a;n=a+1}else r=a-1;a=ot((n+r)/2)}throw je()},ul=(t,e)=>{const n=t.clients.get(e.client);return n[De(n,e.clock)]},yr=ul,Ur=(t,e,n)=>{const r=De(e,n),i=e[r];return i.id.clock<n&&i instanceof ae?(e.splice(r+1,0,Vn(t,i,n-i.id.clock)),r+1):r},at=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[Ur(t,n,e.clock)]},Zs=(t,e,n)=>{const r=e.clients.get(n.client),i=De(r,n.clock),o=r[i];return n.clock!==o.id.clock+o.length-1&&o.constructor!==we&&r.splice(i+1,0,Vn(t,o,n.clock-o.id.clock+1)),o},hl=(t,e,n)=>{const r=t.clients.get(e.id.client);r[De(r,e.id.clock)]=n},lo=(t,e,n,r,i)=>{if(r===0)return;const o=n+r;let a=Ur(t,e,n),c;do c=e[a++],o<c.id.clock+c.length&&Ur(t,e,o),i(c);while(a<e.length&&e[a].id.clock<o)};class fl{constructor(e,n,r){this.doc=e,this.deleteSet=new vn,this.beforeState=Qn(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const Qs=(t,e)=>e.deleteSet.clients.size===0&&!Fa(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(os(e.deleteSet),Zc(t,e),Yt(t,e.deleteSet),!0),ei=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&lt(t.changed,e,Mt).add(n)},Un=(t,e)=>{const n=t[e-1],r=t[e];n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)&&(t.splice(e,1),r instanceof ae&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n))},dl=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const o=e.clients.get(r);for(let a=i.length-1;a>=0;a--){const c=i[a],u=c.clock+c.len;for(let p=De(o,c.clock),b=o[p];p<o.length&&b.id.clock<u;b=o[++p]){const h=o[p];if(c.clock+c.len<=h.id.clock)break;h instanceof ae&&h.deleted&&!h.keep&&n(h)&&h.gc(e,!1)}}}},pl=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let o=n.length-1;o>=0;o--){const a=n[o],c=Pi(i.length-1,1+De(i,a.clock+a.len-1));for(let u=c,p=i[u];u>0&&p.id.clock>=a.clock;p=i[--u])Un(i,u)}})},uo=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,o=n.deleteSet,a=n._mergeStructs;try{os(o),n.afterState=Qn(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const c=[];n.changed.forEach((u,p)=>c.push(()=>{(p._item===null||!p._item.deleted)&&p._callObserver(n,u)})),c.push(()=>{n.changedParentTypes.forEach((u,p)=>c.push(()=>{(p._item===null||!p._item.deleted)&&(u=u.filter(b=>b.target._item===null||!b.target._item.deleted),u.forEach(b=>{b.currentTarget=p}),u.sort((b,h)=>b.path.length-h.path.length),oo(p._dEH,u,n))})),c.push(()=>r.emit("afterTransaction",[n,r]))}),Qr(c,[])}finally{r.gc&&dl(o,i,r.gcFilter),pl(o,i),n.afterState.forEach((b,h)=>{const d=n.beforeState.get(h)||0;if(d!==b){const g=i.clients.get(h),y=Ct(De(g,d),1);for(let S=g.length-1;S>=y;S--)Un(g,S)}});for(let b=0;b<a.length;b++){const{client:h,clock:d}=a[b].id,g=i.clients.get(h),y=De(g,d);y+1<g.length&&Un(g,y+1),y>0&&Un(g,y)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&($c(Ji,zi,"[yjs] ",Yi,Gi,"Changed the client-id because another client seems to be using it."),r.clientID=Zi()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const b=new Sn;Qs(b,n)&&r.emit("update",[b.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const b=new mt;Qs(b,n)&&r.emit("updateV2",[b.toUint8Array(),n.origin,r,n])}const{subdocsAdded:c,subdocsLoaded:u,subdocsRemoved:p}=n;(c.size>0||p.size>0||u.size>0)&&(c.forEach(b=>{b.clientID=r.clientID,b.collectionid==null&&(b.collectionid=r.collectionid),r.subdocs.add(b)}),p.forEach(b=>r.subdocs.delete(b)),r.emit("subdocs",[{loaded:u,added:c,removed:p},r,n]),p.forEach(b=>b.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):uo(t,e+1)}}},Q=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let o=!1,a=null;t._transaction===null&&(o=!0,t._transaction=new fl(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{a=e(t._transaction)}finally{if(o){const c=t._transaction===i[0];t._transaction=null,c&&uo(i,0)}}return a};function*gl(t){const e=H(t.restDecoder);for(let n=0;n<e;n++){const r=H(t.restDecoder),i=t.readClient();let o=H(t.restDecoder);for(let a=0;a<r;a++){const c=t.readInfo();if(c===10){const u=H(t.restDecoder);yield new ve(K(i,o),u),o+=u}else if((Jn&c)!==0){const u=(c&(He|_e))===0,p=new ae(K(i,o),null,(c&_e)===_e?t.readLeftID():null,null,(c&He)===He?t.readRightID():null,u?t.readParentInfo()?t.readString():t.readLeftID():null,u&&(c&cn)===cn?t.readString():null,Oo(t,c));yield p,o+=p.length}else{const u=t.readLen();yield new we(K(i,o),u),o+=u}}}}class ls{constructor(e,n){this.gen=gl(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ve);return this.curr}}class us{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const yl=t=>Pn(t,eo,Sn),bl=(t,e)=>{if(t.constructor===we){const{client:n,clock:r}=t.id;return new we(K(n,r+e),t.length-e)}else if(t.constructor===ve){const{client:n,clock:r}=t.id;return new ve(K(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new ae(K(r,i+e),null,K(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Pn=(t,e=Ft,n=mt)=>{if(t.length===1)return t[0];const r=t.map(b=>new e(zt(b)));let i=r.map(b=>new ls(b,!0)),o=null;const a=new n,c=new us(a);for(;i=i.filter(d=>d.curr!==null),i.sort((d,g)=>{if(d.curr.id.client===g.curr.id.client){const y=d.curr.id.clock-g.curr.id.clock;return y===0?d.curr.constructor===g.curr.constructor?0:d.curr.constructor===ve?1:-1:y}else return g.curr.id.client-d.curr.id.client}),i.length!==0;){const b=i[0],h=b.curr.id.client;if(o!==null){let d=b.curr,g=!1;for(;d!==null&&d.id.clock+d.length<=o.struct.id.clock+o.struct.length&&d.id.client>=o.struct.id.client;)d=b.next(),g=!0;if(d===null||d.id.client!==h||g&&d.id.clock>o.struct.id.clock+o.struct.length)continue;if(h!==o.struct.id.client)rt(c,o.struct,o.offset),o={struct:d,offset:0},b.next();else if(o.struct.id.clock+o.struct.length<d.id.clock)if(o.struct.constructor===ve)o.struct.length=d.id.clock+d.length-o.struct.id.clock;else{rt(c,o.struct,o.offset);const y=d.id.clock-o.struct.id.clock-o.struct.length;o={struct:new ve(K(h,o.struct.id.clock+o.struct.length),y),offset:0}}else{const y=o.struct.id.clock+o.struct.length-d.id.clock;y>0&&(o.struct.constructor===ve?o.struct.length-=y:d=bl(d,y)),o.struct.mergeWith(d)||(rt(c,o.struct,o.offset),o={struct:d,offset:0},b.next())}}else o={struct:b.curr,offset:0},b.next();for(let d=b.curr;d!==null&&d.id.client===h&&d.id.clock===o.struct.id.clock+o.struct.length&&d.constructor!==ve;d=b.next())rt(c,o.struct,o.offset),o={struct:d,offset:0}}o!==null&&(rt(c,o.struct,o.offset),o=null),hs(c);const u=r.map(b=>as(b)),p=Hc(u);return Yt(a,p),a.toUint8Array()},ml=(t,e,n=Ft,r=mt)=>{const i=so(e),o=new r,a=new us(o),c=new n(zt(t)),u=new ls(c,!1);for(;u.curr;){const b=u.curr,h=b.id.client,d=i.get(h)||0;if(u.curr.constructor===ve){u.next();continue}if(b.id.clock+b.length>d)for(rt(a,b,Ct(d-b.id.clock,0)),u.next();u.curr&&u.curr.id.client===h;)rt(a,u.curr,0),u.next();else for(;u.curr&&u.curr.id.client===h&&u.curr.id.clock+u.curr.length<=d;)u.next()}hs(a);const p=as(c);return Yt(o,p),o.toUint8Array()},ho=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:Ue(t.encoder.restEncoder)}),t.encoder.restEncoder=Xn(),t.written=0)},rt=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&ho(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),J(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},hs=t=>{ho(t);const e=t.encoder.restEncoder;J(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];J(e,r.written),Zn(e,r.restEncoder)}},wl=(t,e,n)=>{const r=new e(zt(t)),i=new ls(r,!1),o=new n,a=new us(o);for(let u=i.curr;u!==null;u=i.next())rt(a,u,0);hs(a);const c=as(r);return Yt(o,c),o.toUint8Array()},_l=t=>wl(t,Ft,Sn);class er{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null}get path(){return vl(this.currentTarget,this.target)}deletes(e){return Xi(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const o=n._map.get(i);let a,c;if(this.adds(o)){let u=o.left;for(;u!==null&&this.adds(u);)u=u.left;if(this.deletes(o))if(u!==null&&this.deletes(u))a="delete",c=ur(u.content.getContent());else return;else u!==null&&this.deletes(u)?(a="update",c=ur(u.content.getContent())):(a="add",c=void 0)}else if(this.deletes(o))a="delete",c=ur(o.content.getContent());else return;e.set(i,{action:a,oldValue:c})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){const n=this.target,r=Mt(),i=Mt(),o=[];if(e={added:r,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null;const u=()=>{c&&o.push(c)};for(let p=n._start;p!==null;p=p.right)p.deleted?this.deletes(p)&&!this.adds(p)&&((c===null||c.delete===void 0)&&(u(),c={delete:0}),c.delete+=p.length,i.add(p)):this.adds(p)?((c===null||c.insert===void 0)&&(u(),c={insert:[]}),c.insert=c.insert.concat(p.content.getContent()),r.add(p)):((c===null||c.retain===void 0)&&(u(),c={retain:0}),c.retain+=p.length);c!==null&&c.retain===void 0&&u()}this._changes=e}return e}}const vl=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)i.deleted||r++,i=i.right;n.unshift(r)}e=e._item.parent}return n},fo=80;let fs=0;class Sl{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=fs++}}const Cl=t=>{t.timestamp=fs++},po=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=fs++},El=(t,e,n)=>{if(t.length>=fo){const r=t.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return po(r,e,n),r}else{const r=new Sl(e,n);return t.push(r),r}},tr=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((o,a)=>Ln(e-o.index)<Ln(e-a.index)?o:a);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,Cl(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Ln(n.index-i)<r.parent.length/fo?(po(n,r,i),n):El(t._searchMarker,r,i)},hn=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){t.splice(r,1);continue}i.p=o,o.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=Ct(e,i.index+n))}},nr=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;lt(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;oo(r._eH,n,e)};class re{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Js(),this._dEH=Js(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Fe()}clone(){throw Fe()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Ks(this._eH,e)}observeDeep(e){Ks(this._dEH,e)}unobserve(e){Xs(this._eH,e)}unobserveDeep(e){Xs(this._dEH,e)}toJSON(){}}const go=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let o=t._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const a=o.content.getContent();if(a.length<=e)e-=a.length;else{for(let c=e;c<a.length&&r>0;c++)i.push(a[c]),r--;e=0}}o=o.right}return i},yo=t=>{const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},fn=(t,e)=>{let n=0,r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let o=0;o<i.length;o++)e(i[o],n++,t)}r=r.right}},bo=(t,e)=>{const n=[];return fn(t,(r,i)=>{n.push(e(r,i,t))}),n},kl=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},mo=(t,e)=>{const n=tr(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},jn=(t,e,n,r)=>{let i=n;const o=t.doc,a=o.clientID,c=o.store,u=n===null?e._start:n.right;let p=[];const b=()=>{p.length>0&&(i=new ae(K(a,fe(c,a)),i,i&&i.lastId,u,u&&u.id,e,null,new _t(p)),i.integrate(t,0),p=[])};r.forEach(h=>{if(h===null)p.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:p.push(h);break;default:switch(b(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ae(K(a,fe(c,a)),i,i&&i.lastId,u,u&&u.id,e,null,new Cn(new Uint8Array(h))),i.integrate(t,0);break;case Et:i=new ae(K(a,fe(c,a)),i,i&&i.lastId,u,u&&u.id,e,null,new En(h)),i.integrate(t,0);break;default:if(h instanceof re)i=new ae(K(a,fe(c,a)),i,i&&i.lastId,u,u&&u.id,e,null,new Ke(h)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),b()},wo=Ht("Length exceeded!"),_o=(t,e,n,r)=>{if(n>e._length)throw wo;if(n===0)return e._searchMarker&&hn(e._searchMarker,n,r.length),jn(t,e,null,r);const i=n,o=tr(e,n);let a=e._start;for(o!==null&&(a=o.p,n-=o.index,n===0&&(a=a.prev,n+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(n<=a.length){n<a.length&&at(t,K(a.id.client,a.id.clock+n));break}n-=a.length}return e._searchMarker&&hn(e._searchMarker,i,r.length),jn(t,e,a,r)},Rl=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((o,a)=>a.index>o.index?a:o,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return jn(t,e,i,n)},vo=(t,e,n,r)=>{if(r===0)return;const i=n,o=r,a=tr(e,n);let c=e._start;for(a!==null&&(c=a.p,n-=a.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&at(t,K(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&at(t,K(c.id.client,c.id.clock+r)),c.delete(t),r-=c.length),c=c.right;if(r>0)throw wo;e._searchMarker&&hn(e._searchMarker,i,-o+r)},Bn=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},ds=(t,e,n,r)=>{const i=e._map.get(n)||null,o=t.doc,a=o.clientID;let c;if(r==null)c=new _t([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:c=new _t([r]);break;case Uint8Array:c=new Cn(r);break;case Et:c=new En(r);break;default:if(r instanceof re)c=new Ke(r);else throw new Error("Unexpected content type")}new ae(K(a,fe(o.store,a)),i,i&&i.lastId,null,null,e,n,c).integrate(t,0)},ps=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},So=t=>{const e={};return t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},Co=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted},Tn=t=>Wc(t.entries(),e=>!e[1].deleted);class Al extends er{constructor(e,n){super(e,n),this._transaction=n}}class Pe extends re{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Pe;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Pe}clone(){const e=new Pe;return e.insert(0,this.toArray().map(n=>n instanceof re?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,n){super._callObserver(e,n),nr(this,e,new Al(this,e))}insert(e,n){this.doc!==null?Q(this.doc,r=>{_o(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Q(this.doc,n=>{Rl(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Q(this.doc,r=>{vo(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return mo(this,e)}toArray(){return yo(this)}slice(e=0,n=this.length){return go(this,e,n)}toJSON(){return this.map(e=>e instanceof re?e.toJSON():e)}map(e){return bo(this,e)}forEach(e){fn(this,e)}[Symbol.iterator](){return kl(this)}_write(e){e.writeTypeRef(Kl)}}const Tl=t=>new Pe;class Ol extends er{constructor(e,n,r){super(e,n),this.keysChanged=r}}class Be extends re{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Be}clone(){const e=new Be;return this.forEach((n,r)=>{e.set(r,n instanceof re?n.clone():n)}),e}_callObserver(e,n){nr(this,e,new Ol(this,e,n))}toJSON(){const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof re?i.toJSON():i}}),e}get size(){return[...Tn(this._map)].length}keys(){return gr(Tn(this._map),e=>e[0])}values(){return gr(Tn(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return gr(Tn(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Q(this.doc,n=>{Bn(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Q(this.doc,r=>{ds(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return ps(this,e)}has(e){return Co(this,e)}clear(){this.doc!==null?Q(this.doc,e=>{this.forEach(function(n,r,i){Bn(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Xl)}}const Dl=t=>new Be,st=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Qa(t,e);class Fr{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&je(),this.right.content.constructor){case le:this.right.deleted||Gt(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ti=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case le:e.right.deleted||Gt(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&at(t,K(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},On=(t,e,n)=>{const r=new Map,i=tr(e,n);if(i){const o=new Fr(i.p.left,i.p,i.index,r);return ti(t,o,n-i.index)}else{const o=new Fr(null,e._start,0,r);return ti(t,o,n)}},Eo=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===le&&st(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,o=i.clientID;r.forEach((a,c)=>{const u=n.left,p=n.right,b=new ae(K(o,fe(i.store,o)),u,u&&u.lastId,p,p&&p.id,e,null,new le(c,a));b.integrate(t,0),n.right=b,n.forward()})},Gt=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},ko=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===le&&st(e[t.right.content.key]||null,t.right.content.value)))break;t.forward()}},Ro=(t,e,n,r)=>{const i=t.doc,o=i.clientID,a=new Map;for(const c in r){const u=r[c],p=n.currentAttributes.get(c)||null;if(!st(p,u)){a.set(c,p);const{left:b,right:h}=n;n.right=new ae(K(o,fe(i.store,o)),b,b&&b.lastId,h,h&&h.id,e,null,new le(c,u)),n.right.integrate(t,0),n.forward()}}return a},br=(t,e,n,r,i)=>{n.currentAttributes.forEach((d,g)=>{i[g]===void 0&&(i[g]=null)});const o=t.doc,a=o.clientID;ko(n,i);const c=Ro(t,e,n,i),u=r.constructor===String?new Ve(r):r instanceof re?new Ke(r):new kt(r);let{left:p,right:b,index:h}=n;e._searchMarker&&hn(e._searchMarker,n.index,u.getLength()),b=new ae(K(a,fe(o.store,a)),p,p&&p.lastId,b,b&&b.id,e,null,u),b.integrate(t,0),n.right=b,n.index=h,n.forward(),Eo(t,e,n,c)},ni=(t,e,n,r,i)=>{const o=t.doc,a=o.clientID;ko(n,i);const c=Ro(t,e,n,i);e:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===le));){if(!n.right.deleted)switch(n.right.content.constructor){case le:{const{key:u,value:p}=n.right.content,b=i[u];if(b!==void 0){if(st(b,p))c.delete(u);else{if(r===0)break e;c.set(u,p)}n.right.delete(t)}else n.currentAttributes.set(u,p);break}default:r<n.right.length&&at(t,K(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let u="";for(;r>0;r--)u+=`
`;n.right=new ae(K(a,fe(o.store,a)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Ve(u)),n.right.integrate(t,0),n.forward()}Eo(t,e,n,c)},Ao=(t,e,n,r,i)=>{let o=e;const a=Oe();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===le){const p=o.content;a.set(p.key,p)}o=o.right}let c=0,u=!1;for(;e!==o;){if(n===e&&(u=!0),!e.deleted){const p=e.content;switch(p.constructor){case le:{const{key:b,value:h}=p,d=r.get(b)||null;(a.get(b)!==p||d===h)&&(e.delete(t),c++,!u&&(i.get(b)||null)===h&&d!==h&&(d===null?i.delete(b):i.set(b,d))),!u&&!e.deleted&&Gt(i,p);break}}}e=e.right}return c},Il=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===le){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},xl=t=>{let e=0;return Q(t.doc,n=>{let r=t._start,i=t._start,o=Oe();const a=Tr(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case le:Gt(a,i.content);break;default:e+=Ao(n,r,i,o,a),o=Tr(a),r=i;break}i=i.right}}),e},ri=(t,e,n)=>{const r=n,i=Tr(e.currentAttributes),o=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ke:case kt:case Ve:n<e.right.length&&at(t,K(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}o&&Ao(t,o,e.right,i,e.currentAttributes);const a=(e.left||e.right).parent;return a._searchMarker&&hn(a._searchMarker,e.index,-r+n),e};class Ll extends er{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Q(e,r=>{const i=new Map,o=new Map;let a=this.target._start,c=null;const u={};let p="",b=0,h=0;const d=()=>{if(c!==null){let g;switch(c){case"delete":g={delete:h},h=0;break;case"insert":g={insert:p},i.size>0&&(g.attributes={},i.forEach((y,S)=>{y!==null&&(g.attributes[S]=y)})),p="";break;case"retain":if(g={retain:b},Object.keys(u).length>0){g.attributes={};for(const y in u)g.attributes[y]=u[y]}b=0;break}n.push(g),c=null}};for(;a!==null;){switch(a.content.constructor){case Ke:case kt:this.adds(a)?this.deletes(a)||(d(),c="insert",p=a.content.getContent()[0],d()):this.deletes(a)?(c!=="delete"&&(d(),c="delete"),h+=1):a.deleted||(c!=="retain"&&(d(),c="retain"),b+=1);break;case Ve:this.adds(a)?this.deletes(a)||(c!=="insert"&&(d(),c="insert"),p+=a.content.str):this.deletes(a)?(c!=="delete"&&(d(),c="delete"),h+=a.length):a.deleted||(c!=="retain"&&(d(),c="retain"),b+=a.length);break;case le:{const{key:g,value:y}=a.content;if(this.adds(a)){if(!this.deletes(a)){const S=i.get(g)||null;st(S,y)?y!==null&&a.delete(r):(c==="retain"&&d(),st(y,o.get(g)||null)?delete u[g]:u[g]=y)}}else if(this.deletes(a)){o.set(g,y);const S=i.get(g)||null;st(S,y)||(c==="retain"&&d(),u[g]=S)}else if(!a.deleted){o.set(g,y);const S=u[g];S!==void 0&&(st(S,y)?S!==null&&a.delete(r):(c==="retain"&&d(),y===null?delete u[g]:u[g]=y))}a.deleted||(c==="insert"&&d(),Gt(i,a.content));break}}a=a.right}for(d();n.length>0;){const g=n[n.length-1];if(g.retain!==void 0&&g.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Ye extends re{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Ye}clone(){const e=new Ye;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Ll(this,e,n),i=e.doc;if(nr(this,e,r),!e.local){let o=!1;for(const[a,c]of e.afterState.entries()){const u=e.beforeState.get(a)||0;if(c!==u&&(lo(e,i.store.clients.get(a),u,c,p=>{!p.deleted&&p.content.constructor===le&&(o=!0)}),o))break}o||Nr(e,e.deleteSet,a=>{a instanceof we||o||a.parent===this&&a.content.constructor===le&&(o=!0)}),Q(i,a=>{o?xl(this):Nr(a,a.deleteSet,c=>{c instanceof we||c.parent===this&&Il(a,c)})})}}toString(){let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ve&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Q(this.doc,r=>{const i=new Fr(null,this._start,0,new Map);for(let o=0;o<e.length;o++){const a=e[o];if(a.insert!==void 0){const c=!n&&typeof a.insert=="string"&&o===e.length-1&&i.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof c!="string"||c.length>0)&&br(r,this,i,c,a.attributes||{})}else a.retain!==void 0?ni(r,this,i,a.retain,a.attributes||{}):a.delete!==void 0&&ri(r,i,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){const i=[],o=new Map,a=this.doc;let c="",u=this._start;function p(){if(c.length>0){const h={};let d=!1;o.forEach((y,S)=>{d=!0,h[S]=y});const g={insert:c};d&&(g.attributes=h),i.push(g),c=""}}const b=()=>{for(;u!==null;){if(Zt(u,e)||n!==void 0&&Zt(u,n))switch(u.content.constructor){case Ve:{const h=o.get("ychange");e!==void 0&&!Zt(u,e)?(h===void 0||h.user!==u.id.client||h.type!=="removed")&&(p(),o.set("ychange",r?r("removed",u.id):{type:"removed"})):n!==void 0&&!Zt(u,n)?(h===void 0||h.user!==u.id.client||h.type!=="added")&&(p(),o.set("ychange",r?r("added",u.id):{type:"added"})):h!==void 0&&(p(),o.delete("ychange")),c+=u.content.str;break}case Ke:case kt:{p();const h={insert:u.content.getContent()[0]};if(o.size>0){const d={};h.attributes=d,o.forEach((g,y)=>{d[y]=g})}i.push(h);break}case le:Zt(u,e)&&(p(),Gt(o,u.content));break}u=u.right}p()};return e||n?Q(a,h=>{e&&Mr(h,e),n&&Mr(h,n),b()},"cleanup"):b(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Q(i,o=>{const a=On(o,this,e);r||(r={},a.currentAttributes.forEach((c,u)=>{r[u]=c})),br(o,this,a,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r={}){const i=this.doc;i!==null?Q(i,o=>{const a=On(o,this,e);br(o,this,a,n,r)}):this._pending.push(()=>this.insertEmbed(e,n,r))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Q(r,i=>{ri(i,On(i,this,e),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Q(i,o=>{const a=On(o,this,e);a.right!==null&&ni(o,this,a,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Q(this.doc,n=>{Bn(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Q(this.doc,r=>{ds(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return ps(this,e)}getAttributes(){return So(this)}_write(e){e.writeTypeRef(Zl)}}const Nl=t=>new Ye;class mr{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===ct||n.constructor===$e)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class $e extends re{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $e}clone(){const e=new $e;return e.insert(0,this.toArray().map(n=>n instanceof re?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new mr(this,e)}querySelector(e){e=e.toUpperCase();const r=new mr(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),it(new mr(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){nr(this,e,new Fl(this,n,e))}toString(){return bo(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),fn(this,o=>{i.insertBefore(o.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Q(this.doc,r=>{_o(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Q(this.doc,r=>{const i=e&&e instanceof re?e._item:e;jn(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(o=>o===e)+1;if(i===0&&e!==null)throw Ht("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Q(this.doc,r=>{vo(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return yo(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return mo(this,e)}slice(e=0,n=this.length){return go(this,e,n)}forEach(e){fn(this,e)}_write(e){e.writeTypeRef(eu)}}const Ml=t=>new $e;class ct extends $e{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new ct(this.nodeName)}clone(){const e=new ct(this.nodeName),n=this.getAttributes();for(const r in n)e.setAttribute(r,n[r]);return e.insert(0,this.toArray().map(r=>r instanceof re?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const c in e)r.push(c);r.sort();const i=r.length;for(let c=0;c<i;c++){const u=r[c];n.push(u+'="'+e[u]+'"')}const o=this.nodeName.toLocaleLowerCase(),a=n.length>0?" "+n.join(" "):"";return`<${o}${a}>${super.toString()}</${o}>`}removeAttribute(e){this.doc!==null?Q(this.doc,n=>{Bn(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Q(this.doc,r=>{ds(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return ps(this,e)}hasAttribute(e){return Co(this,e)}getAttributes(){return So(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),o=this.getAttributes();for(const a in o)i.setAttribute(a,o[a]);return fn(this,a=>{i.appendChild(a.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(Ql),e.writeKey(this.nodeName)}}const Ul=t=>new ct(t.readKey());class Fl extends er{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class Pt extends Be{constructor(e){super(),this.hookName=e}_copy(){return new Pt(this.hookName)}clone(){const e=new Pt(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(e){e.writeTypeRef(tu),e.writeKey(this.hookName)}}const Pl=t=>new Pt(t.readKey());class wt extends Ye{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new wt}clone(){const e=new wt;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const o=[];for(const a in e.attributes[i])o.push({key:a,value:e.attributes[i][a]});o.sort((a,c)=>a.key<c.key?-1:1),n.push({nodeName:i,attrs:o})}n.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const o=n[i];r+=`<${o.nodeName}`;for(let a=0;a<o.attrs.length;a++){const c=o.attrs[a];r+=` ${c.key}="${c.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(nu)}}const jl=t=>new wt;class gs{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Fe()}mergeWith(e){return!1}write(e,n,r){throw Fe()}integrate(e,n){throw Fe()}}const Bl=0;class we extends gs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),co(e.doc.store,this)}write(e,n){e.writeInfo(Bl),e.writeLen(this.length-n)}getMissing(e,n){return null}}class Cn{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Cn(this.content)}splice(e){throw Fe()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const $l=t=>new Cn(t.readBuf());class dn{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new dn(this.len)}splice(e){const n=new dn(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Fn(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Vl=t=>new dn(t.readLen()),To=(t,e)=>new Et({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class En{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new En(To(this.doc.guid,this.opts))}splice(e){throw Fe()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Wl=t=>new En(To(t.readString(),t.readAny()));class kt{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new kt(this.embed)}splice(e){throw Fe()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const ql=t=>new kt(t.readJSON());class le{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new le(this.key,this.value)}splice(e){throw Fe()}mergeWith(e){return!1}integrate(e,n){n.parent._searchMarker=null}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Hl=t=>new le(t.readKey(),t.readJSON());class $n{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $n(this.arr)}splice(e){const n=new $n(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];e.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const zl=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new $n(n)};class _t{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _t(this.arr)}splice(e){const n=new _t(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];e.writeAny(o)}}getRef(){return 8}}const Yl=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new _t(n)};class Ve{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ve(this.str)}splice(e){const n=new Ve(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Gl=t=>new Ve(t.readString()),Jl=[Tl,Dl,Nl,Ul,Ml,Pl,jl],Kl=0,Xl=1,Zl=2,Ql=3,eu=4,tu=5,nu=6;class Ke{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ke(this.type._copy())}splice(e){throw Fe()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const ru=t=>new Ke(Jl[t.readTypeRef()](t)),Vn=(t,e,n)=>{const{client:r,clock:i}=e.id,o=new ae(K(r,i+n),e,K(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&o.markDeleted(),e.keep&&(o.keep=!0),e.redone!==null&&(o.redone=K(e.redone.client,e.redone.clock+n)),e.right=o,o.right!==null&&(o.right.left=o),t._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),e.length=n,o};class ae extends gs{constructor(e,n,r,i,o,a,c,u){super(e,u.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=o,this.parent=a,this.parentSub=c,this.redone=null,this.content=u,this.info=this.content.isCountable()?$s:0}set marker(e){(this.info&fr)>0!==e&&(this.info^=fr)}get marker(){return(this.info&fr)>0}get keep(){return(this.info&Bs)>0}set keep(e){this.keep!==e&&(this.info^=Bs)}get countable(){return(this.info&$s)>0}get deleted(){return(this.info&hr)>0}set deleted(e){this.deleted!==e&&(this.info^=hr)}markDeleted(){this.info|=hr}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=fe(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=fe(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===xt&&this.id.client!==this.parent.client&&this.parent.clock>=fe(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Zs(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=at(e,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===we||this.right&&this.right.constructor===we)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===ae&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ae&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===xt){const r=yr(n,this.parent);r.constructor===we?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=Zs(e,e.doc.store,K(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,a=new Set;for(;i!==null&&i!==this.right;){if(a.add(i),o.add(i),An(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,o.clear();else if(An(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&a.has(yr(e.doc.store,i.origin)))o.has(yr(e.doc.store,i.origin))||(r=i,o.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),co(e.doc.store,this),this.content.integrate(e,this),ei(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new we(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:K(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&An(e.origin,this.lastId)&&this.right===e&&An(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Fn(e.deleteSet,this.id.client,this.id.clock,this.length),ei(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw je();this.content.gc(e),n?hl(e,this,new we(this.id,this.length)):this.content=new dn(this.length)}write(e,n){const r=n>0?K(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,o=this.parentSub,a=this.content.getRef()&Jn|(r===null?0:_e)|(i===null?0:He)|(o===null?0:cn);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const c=this.parent;if(c._item!==void 0){const u=c._item;if(u===null){const p=ll(c);e.writeParentInfo(!0),e.writeString(p)}else e.writeParentInfo(!1),e.writeLeftID(u.id)}else c.constructor===String?(e.writeParentInfo(!0),e.writeString(c)):c.constructor===xt?(e.writeParentInfo(!1),e.writeLeftID(c)):je();o!==null&&e.writeString(o)}this.content.write(e,n)}}const Oo=(t,e)=>su[e&Jn](t),su=[()=>{je()},Vl,zl,$l,Gl,ql,Hl,ru,Yl,Wl,()=>{je()}],iu=10;class ve extends gs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){je()}write(e,n){e.writeInfo(iu),J(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Do=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Io="__ $YJS$ __";Do[Io]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Do[Io]=!0;var Pr,jr,ou=function(e){return e()};function au(t,e){if(jr)return jr(t,e);ou(t)}function vt(t,e,n){if(Pr)return Pr.apply(null,arguments);throw new Error("observable implementation not provided. Call enableReactiveBindings, enableVueBindings or enableMobxBindings.")}function cu(t){Pr=function(n,r,i){var o=t.createAtom(n);return r&&r(),o},jr=function(n,r){return t.reaction(n,r,{fireImmediately:!1})}}var si=new WeakSet;function lu(t){if(si.has(t))return t;si.add(t);var e,n=new Map;function r(){if(!e){var h=function(g){(g.changes.added.size||g.changes.deleted.size||g.changes.keys.size||g.changes.delta.length)&&e.reportChanged()};e=vt("map",function(){t.observe(h)},function(){t.unobserve(h)})}e.reportObserved(t._implicitObserver)}function i(h){var d=n.get(h);if(!d){var g=function(S){d.reportChanged()};d=vt(h+"",function(){t.observe(g)},function(){t.unobserve(g)}),n.set(h,d)}d.reportObserved(t._implicitObserver)}var o=t.get;t.get=function(h){if(typeof h!="number")throw new Error("unexpected");i(h);var d=Reflect.apply(o,this,arguments);return d};function a(h){var d=t[h];t[h]=function(){r();var g=Reflect.apply(d,this,arguments);return g}}function c(h){var d=t,g=Object.getOwnPropertyDescriptor(d,h);if(g||(d=Object.getPrototypeOf(d),g=Object.getOwnPropertyDescriptor(d,h)),g||(d=Object.getPrototypeOf(d),g=Object.getOwnPropertyDescriptor(d,h)),!g)throw new Error("property not found");var y=g.get;g.get=function(){this._disableTracking||r();var S=Reflect.apply(y,this,arguments);return S},Object.defineProperty(t,h,g)}function u(h,d){var g=t,y=Object.getOwnPropertyDescriptor(g,h);if(y||(g=Object.getPrototypeOf(g),y=Object.getOwnPropertyDescriptor(g,h)),y||(g=Object.getPrototypeOf(g),y=Object.getOwnPropertyDescriptor(g,h)),!y)throw new Error("property not found");Object.defineProperty(t,d,y)}a("forEach"),a("toJSON"),a("toArray"),a("slice"),a("map"),u("length","lengthUntracked"),c("length");var p=t.push;t.push=function(h){this._disableTracking=!0;var d=p.call(this,h);return this._disableTracking=!1,d};var b=t.slice;return t.slice=function(h,d){this._disableTracking=!0;var g=b.call(this,h,d);return this._disableTracking=!1,g},t}var ii=new WeakSet;function uu(t){if(ii.has(t))return t;ii.add(t);var e;function n(){if(!e){var o=Array.from(t.share.keys()),a=function(u){var p=Array.from(t.share.keys());JSON.stringify(o)!==JSON.stringify(p)&&(o=p,e.reportChanged())};e=vt("map",function(){t.on("beforeObserverCalls",a)},function(){t.off("beforeObserverCalls",a)})}e.reportObserved(t._implicitObserver)}var r=t.get;t.get=function(o){if(typeof o!="string")throw new Error("unexpected");var a=Reflect.apply(r,this,arguments);return rr(a),a};function i(o){var a=t[o],c;t[o]=function(){var u,p=arguments;return n(),c&&c.removeObservers(),c=au(function(){return u=Reflect.apply(a,t,p),u},function(){return e.reportChanged()}),u}}return i("toJSON"),Object.defineProperty(t,"keys",{get:function(){return n(),Object.keys(t.share)}}),t}var oi=new WeakSet;function hu(t){if(oi.has(t))return t;oi.add(t);var e,n=new Map;function r(){if(!e){var c=function(p){(p.changes.added.size||p.changes.deleted.size||p.changes.keys.size||p.changes.delta.length)&&e.reportChanged()};e=vt("map",function(){t.observe(c)},function(){t.unobserve(c)})}e.reportObserved(t._implicitObserver)}function i(c){var u=n.get(c);if(!u){var p=function(h){h.keysChanged.has(c)&&(h.changes.added.size||h.changes.deleted.size||h.changes.keys.size||h.changes.delta.length)&&u.reportChanged()};u=vt(c,function(){t.observe(p)},function(){t.unobserve(p)}),n.set(c,u)}u.reportObserved(t._implicitObserver)}var o=t.get;t.get=function(c){if(typeof c!="string")throw new Error("unexpected");i(c);var u=Reflect.apply(o,this,arguments);return u};function a(c){var u=t[c];t[c]=function(){r();var p=Reflect.apply(u,this,arguments);return p}}return a("values"),a("entries"),a("keys"),a("forEach"),a("toJSON"),t}var ai=new WeakSet;function ci(t){if(ai.has(t))return t;ai.add(t);var e,n=function(o){e.reportChanged()};e=vt("text",function(){t.observe(n)},function(){t.unobserve(n)});function r(i){var o=t[i];t[i]=function(){e.reportObserved(this._implicitObserver);var a=Reflect.apply(o,this,arguments);return a}}return r("toString"),r("toJSON"),t}var li=new WeakSet;function ui(t){if(li.has(t))return t;li.add(t);var e,n=function(a){(a.changes.added.size||a.changes.deleted.size||a.changes.keys.size||a.changes.delta.length)&&e.reportChanged()};e=vt("xml",function(){t.observe(n)},function(){t.unobserve(n)});function r(o){var a=t[o];t[o]=function(){e.reportObserved(this._implicitObserver);var c=Reflect.apply(a,this,arguments);return c}}function i(o){var a=t,c=Object.getOwnPropertyDescriptor(a,o);if(c||(a=Object.getPrototypeOf(a),c=Object.getOwnPropertyDescriptor(a,o)),c||(a=Object.getPrototypeOf(a),c=Object.getOwnPropertyDescriptor(a,o)),!c)throw new Error("property not found");var u=c.get;c.get=function(){e.reportObserved(this._implicitObserver);var p=Reflect.apply(u,this,arguments);return p},Object.defineProperty(t,o,c)}return r("toString"),r("toDOM"),r("toArray"),r("getAttribute"),i("firstChild"),t}function rr(t){return t instanceof wt||t instanceof Ye?ci(t):t instanceof Pe?lu(t):t instanceof Be?hu(t):t instanceof Et||Object.prototype.hasOwnProperty.call(t,"autoLoad")?uu(t):t instanceof $e||t instanceof ct?ui(t):t}function hi(t){t.share.forEach(function(e){e.constructor!==re&&rr(e)})}function fi(t,e){for(var n=t.length-1;n>=e;n--){var r=t[n];if(!r.deleted){var i;if(r instanceof we)continue;(i=r.content)==null||i.getContent().forEach(function(o){o instanceof re&&rr(o)})}}}var di=new WeakSet;function fu(t){di.has(t)||(di.add(t),rr(t),t.store.clients.forEach(function(e){e&&fi(e,0)}),hi(t),t.on("beforeObserverCalls",function(e){hi(t),e.afterState.forEach(function(n,r){var i=e.beforeState.get(r)||0;if(i!==n){var o=e.doc.store.clients.get(r);if(!o)return;var a=De(o,i);fi(o,a)}})}))}var pn=function(e){this.value=void 0,this.value=e};function du(t){return ArrayBuffer.isView(t)?new pn(t):new pn(Object.freeze(t))}function pu(t){var e=function(){var u,p=(u=this[Se])==null?void 0:u.implicitObserver;t._implicitObserver=p;var b=t.slice.bind(t).apply(t,arguments);return b.map(function(h){var d=sr(h,p);return p&&typeof d=="object"?Nt(d,p):d})},n=function(u){return u.map(function(p){var b=ys(p),h=jt(b)||b;if(h instanceof pn&&(h=h.value),h instanceof re&&h.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return h})},r=function(){return[].findIndex.apply(e.apply(this),arguments)},i={slice:e,unshift:function(){return t.unshift(n([].slice.call(arguments))),t.lengthUntracked},push:function(){return t.push(n([].slice.call(arguments))),t.lengthUntracked},insert:t.insert.bind(t),toJSON:t.toJSON.bind(t),forEach:function(){return[].forEach.apply(e.apply(this),arguments)},every:function(){return[].every.apply(e.apply(this),arguments)},filter:function(){return[].filter.apply(e.apply(this),arguments)},find:function(){return[].find.apply(e.apply(this),arguments)},findIndex:r,some:function(){return[].some.apply(e.apply(this),arguments)},includes:function(){return[].includes.apply(e.apply(this),arguments)},map:function(){return[].map.apply(e.apply(this),arguments)},indexOf:function(){var u=arguments[0];return r.call(this,function(p){return mu(p,u)})},splice:function(){var u=arguments[0]<0?t.length-Math.abs(arguments[0]):arguments[0],p=arguments[1],b=Array.from(Array.from(arguments).slice(2)),h=e.apply(this,[u,Number.isInteger(p)?u+p:void 0]);return t.doc?t.doc.transact(function(){t.delete(u,p),t.insert(u,n(b))}):(t.delete(u,p),t.insert(u,n(b))),h}},o=[];for(var a in i)o[a]=i[a];return o}function Qt(t){if(typeof t=="string"&&t.trim().length){var e=Number(t);if(Number.isInteger(e))return e}return t}function pi(t,e){if(e===void 0&&(e=new Pe),e[ce])throw new Error("unexpected");var n=pu(e),r=new Proxy(n,{set:function(o,a,c){var u=Qt(a);throw typeof u!="number"?new Error:new Error("array assignment is not implemented / supported")},get:function(o,a,c){var u=Qt(a);if(u===ir)return e;if(typeof u=="number"){var p;if(c&&c[Se]){var b;p=(b=c[Se])==null?void 0:b.implicitObserver,e._implicitObserver=p}var h=e.get(u);return h=sr(h,p),h}if(u===Symbol.toStringTag)return"Array";if(u===Symbol.iterator){var d=e.slice();return Reflect.get(d,u)}if(u==="length")return e.length;var g=Reflect.get(o,u,c);return g},deleteProperty:function(o,a){var c=Qt(a);if(typeof c!="number")throw new Error;return c<e.lengthUntracked&&c>=0?(e.delete(c),!0):!1},has:function(o,a){var c=Qt(a);return typeof c!="number"?Reflect.has(o,c):c<e.lengthUntracked&&c>=0},getOwnPropertyDescriptor:function(o,a){var c=Qt(a);if(c==="length")return{enumerable:!1,configurable:!1,writable:!0};if(typeof c=="number"&&c>=0&&c<e.lengthUntracked)return{enumerable:!0,configurable:!0,writable:!0}},ownKeys:function(o){for(var a=[],c=0;c<e.length;c++)a.push(c+"");return a.push("length"),a}});return n.push.apply(r,t),r}function gi(t,e){if(e===void 0&&(e=new Be),e[ce])throw new Error("unexpected");var n=new Proxy({},{set:function(o,a,c){if(typeof a!="string")throw new Error;var u=ys(c),p=jt(u)||u;if(p instanceof pn&&(p=p.value),p instanceof re&&p.parent)throw new Error("Not supported: reassigning object that already occurs in the tree.");return e.set(a,p),!0},get:function(o,a,c){if(a===ir)return e;if(typeof a!="string")return Reflect.get(o,a);var u;if(c&&c[Se]){var p;u=(p=c[Se])==null?void 0:p.implicitObserver,e._implicitObserver=u}var b=e.get(a);return b=sr(b,u),b},deleteProperty:function(o,a){if(typeof a!="string")throw new Error;return e.has(a)?(e.delete(a),!0):!1},has:function(o,a){return!!(typeof a=="string"&&e.has(a))},getOwnPropertyDescriptor:function(o,a){if(typeof a=="string"&&e.has(a))return{enumerable:!0,configurable:!0}},ownKeys:function(o){return Array.from(e.keys())}});tn.set(e,n);for(var r in t)n[r]=t[r];return n}function gu(t){return t instanceof re}var tn=new WeakMap;function sr(t,e){if(gu(t)){if(t._implicitObserver=e,t instanceof Pe||t instanceof Be){if(!tn.has(t)){var n=ys(t);tn.set(t,n)}t=tn.get(t)}else if(t instanceof ct||t instanceof $e||t instanceof wt||t instanceof Pt||t instanceof Ye)Zr(t),t.__v_skip=!0;else throw new Error("unknown YType");return t}else{if(t===null)return null;if(typeof t=="object")return du(t)}return t}function ys(t){if(t==null)return t;if(t=jt(t)||t,t instanceof Pe)return pi([],t);if(t instanceof Be)return gi({},t);if(typeof t=="string")return t;if(Array.isArray(t))return pi(t);if(t instanceof ct||t instanceof $e||t instanceof wt||t instanceof Pt)return t;if(t instanceof Ye)return t;if(typeof t=="object")return t instanceof pn?t:gi(t);if(typeof t=="number"||typeof t=="boolean")return t;throw new Error("invalid")}function yu(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e],i=r[1];if(Array.isArray(i)){if(i.length!==0)throw new Error("Root Array initializer must always be empty array")}else if(i&&typeof i=="object"){if(Object.keys(i).length!==0||Object.getPrototypeOf(i)!==Object.prototype)throw new Error("Root Object initializer must always be {}")}else if(i!=="xml"&&i!=="text")throw new Error("unknown Root initializer")}}function yi(t,e,n){var r=e[n];if(!r){n!=="__v_raw"&&n!=="__v_isRef"&&n!=="__v_isReadonly"&&console.warn("property not found on root doc",n);return}return r==="xml"?t.getXmlFragment(n):r==="text"?t.getText(n):Array.isArray(r)?t.getArray(n):t.getMap(n)}function bu(t,e){if(t[ce])throw new Error("unexpected");yu(e);var n=new Proxy({},{set:function(i,o,a){throw typeof o!="string"?new Error:new Error("cannot set new elements on root doc")},get:function(i,o,a){if(o===ir)return t;if(typeof o!="string")return Reflect.get(i,o);var c;if(a&&a[Se]){var u;c=(u=a[Se])==null?void 0:u.implicitObserver,t._implicitObserver=c}if(o==="toJSON"){for(var p=0,b=Object.keys(e);p<b.length;p++){var h=b[p];yi(t,e,h)}var d=Reflect.get(t,o);return d}var g=yi(t,e,o);return g=sr(g,c),g},deleteProperty:function(i,o){throw new Error("deleteProperty not available for doc")},has:function(i,o){return!!(typeof o=="string"&&t.share.has(o))},getOwnPropertyDescriptor:function(i,o){if(typeof o=="string"&&t.share.has(o)||o==="toJSON")return{enumerable:!0,configurable:!0}},ownKeys:function(i){return Array.from(t.share.keys())}});return tn.set(t,n),n}cu(Na);var ir=Symbol("INTERNAL_SYMBOL");function jt(t){if(!(typeof t!="object"||t===null)){var e=t[ir];return e&&(Zr(e),e.__v_skip=!0),e}}function mu(t,e){if(t===e)return!0;if(typeof t=="object"&&typeof e=="object"){var n=jt(t),r=jt(e);return!n||!r?!1:n===r}return!1}function wu(t,e){return e===void 0&&(e=new Et),fu(e),bu(e,t)}function xo(t,e){if(!jt(t))throw new Error("syncedObject passed to useSyncedStore is not a SyncedStore Store or internal data type.");return Ma(t)}const Lo=fa(void 0),No=Ti.createContext(void 0);function Mo({store:t,aggregatedData:e,children:n}){const r=oe.useMemo(()=>({store:t}),[t]);return se.jsx(No.Provider,{value:r,children:se.jsx(Lo.Provider,{value:e,children:n})})}function _u(){const t=oe.useContext(No);if(!t)throw new Error("SyncedStoreContextProvider is missing");return t}function vu(t){return da(Lo,t)}Mo.__docgenInfo={description:"",methods:[],displayName:"SyncedStoreProvider",props:{store:{required:!0,tsType:{name:"MappedTypeDescription",elements:[{name:"signature",type:"object",raw:`{
	data: any;
	fieldSettings: { settings?: any };
}`,signature:{properties:[{key:"data",value:{name:"any",required:!0}},{key:"fieldSettings",value:{name:"signature",type:"object",raw:"{ settings?: any }",signature:{properties:[{key:"settings",value:{name:"any",required:!1}}]},required:!0}}]}}],raw:`MappedTypeDescription<{
	data: any;
	fieldSettings: { settings?: any };
}>`},description:""},aggregatedData:{required:!0,tsType:{name:"any"},description:""}}};function Su(t){const[e]=oe.useState(()=>wu({data:{},fieldSettings:{}},t));return e}function Uo({path:t,Widget:e,label:n,aggregation:r,schema:i,entityApi:o,currentUserRole:a,shouldShowFieldSettingControls:c,aggregationSupport:u}){const{store:p}=_u(),b=xo(p),h=vu(t),d=Ls({location:t,root:b.fieldSettings.settings}),g=Is(h,d==null?void 0:d.aggregationSettings),y=Is(r,d==null?void 0:d.aggregationSettings),S=Ls({location:t,root:b.data}),N=oe.useCallback(M=>{xs({root:b.data,location:t,value:M,schema:i})},[b.data,t,i]),I=oe.useCallback(M=>{xs({root:b.fieldSettings.settings,location:t,value:M})},[b.fieldSettings.settings,t]);return se.jsx(e,{value:S,onChange:N,label:n,aggregatedValue:g,aggregation:y,schema:i,entityApi:o,fieldSettings:d,updateFieldSettings:c?I:void 0,aggregationSupport:u,currentUserRole:a})}Uo.__docgenInfo={description:"",methods:[],displayName:"SyncedWidgetRenderer",props:{path:{required:!0,tsType:{name:"string"},description:""},aggregation:{required:!0,tsType:{name:"union",raw:"Aggregates | string | undefined",elements:[{name:"Aggregates"},{name:"string"},{name:"undefined"}]},description:""},Widget:{required:!0,tsType:{name:"ReactFC",raw:"React.FC<React.PropsWithChildren<WidgetProps<T>>>",elements:[{name:"ReactPropsWithChildren",raw:"React.PropsWithChildren<WidgetProps<T>>",elements:[{name:"WidgetProps",elements:[{name:"T"}],raw:"WidgetProps<T>"}]}]},description:""},schema:{required:!0,tsType:{name:"CampaignBuddySchema"},description:""},entityApi:{required:!0,tsType:{name:"union",raw:"EntityApi | undefined",elements:[{name:"EntityApi"},{name:"undefined"}]},description:""},shouldShowFieldSettingControls:{required:!0,tsType:{name:"boolean"},description:""},aggregationSupport:{required:!0,tsType:{name:"unknown"},description:""}},composes:["Omit"]};const Cu=({doc:t,schema:e,widgets:n,uiLayout:r,UiSection:i,aggregates:o,entityApi:a,currentUserRole:c,shouldShowFieldSettingsControls:u})=>{var N;const p=Su(t),b=xo(p),{resolvedSchema:h,aggregatedData:d,fullAggregates:g,uiLayout:y}=pa({schema:e,data:b==null?void 0:b.data,currentUserRole:c,fieldSettings:(N=b==null?void 0:b.fieldSettings)==null?void 0:N.settings,providedUiLayout:r,entityApi:a,aggregates:o}),S=ga(y);return se.jsx(ya,{children:se.jsx(Mo,{store:p,aggregatedData:d,children:se.jsx(ba,{uiLayout:S,schema:h,widgetLookup:n,UiSection:i,aggregates:g,entityApi:a,shouldShowFieldSettingControls:u??!1,currentUserRole:c,FormWidgetRenderer:Uo})})})};Cu.__docgenInfo={description:"",methods:[],displayName:"SyncedFormGenerator",props:{schema:{required:!0,tsType:{name:"CampaignBuddySchema"},description:""},doc:{required:!0,tsType:{name:"Y.Doc"},description:""},widgets:{required:!0,tsType:{name:"WidgetLookup"},description:""},shouldShowFieldSettingsControls:{required:!1,tsType:{name:"boolean"},description:""},uiLayout:{required:!1,tsType:{name:"Array",elements:[{name:"unknown"}],raw:`(
	| string
	| UiSection
	| ColumnLayout
	| WhiteSpace
	| UiLayout
)[]`},description:""},UiSection:{required:!1,tsType:{name:"ReactFC",raw:"React.FC<React.PropsWithChildren<UiSectionProps>>",elements:[{name:"ReactPropsWithChildren",raw:"React.PropsWithChildren<UiSectionProps>",elements:[{name:"UiSectionProps"}]}]},description:""},aggregates:{required:!1,tsType:{name:"Aggregates"},description:""},entityApi:{required:!1,tsType:{name:"EntityApi"},description:`Not technically needed, but some
widgets may fail if an entity
api is not provided`},currentUserRole:{required:!1,tsType:{name:"string"},description:`The role of the current user. The semantic
values for role is left to the consumer. This
property is used to match field visibility
settings in fieldSettings. If left undefined,
it is assumed the current user has all visibility
permissions.`}}};const gt=()=>new Map,gn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Eu=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},bs=()=>new Set,ku=Array.from;class ms{constructor(){this._observers=gt()}on(e,n){gn(this._observers,e,bs).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return ku((this._observers.get(e)||gt()).values()).forEach(r=>r(...n))}destroy(){this._observers=gt()}}const Bt=Math.floor,Ru=Math.abs,Au=Math.log10,Fo=(t,e)=>t<e?t:e,Po=(t,e)=>t>e?t:e,Tu=t=>t!==0?t<0:1/t<0,Ge=Date.now,Ou=1200,Du=2500,Wn=3e4,Br=t=>{if(t.shouldConnect&&t.ws===null){const e=new WebSocket(t.url),n=t.binaryType;let r=null;n&&(e.binaryType=n),t.ws=e,t.connecting=!0,t.connected=!1,e.onmessage=a=>{t.lastMessageReceived=Ge();const c=a.data,u=typeof c=="string"?JSON.parse(c):c;u&&u.type==="pong"&&(clearTimeout(r),r=setTimeout(o,Wn/2)),t.emit("message",[u,t])};const i=a=>{t.ws!==null&&(t.ws=null,t.connecting=!1,t.connected?(t.connected=!1,t.emit("disconnect",[{type:"disconnect",error:a},t])):t.unsuccessfulReconnects++,setTimeout(Br,Fo(Au(t.unsuccessfulReconnects+1)*Ou,Du),t)),clearTimeout(r)},o=()=>{t.ws===e&&t.send({type:"ping"})};e.onclose=()=>i(null),e.onerror=a=>i(a),e.onopen=()=>{t.lastMessageReceived=Ge(),t.connecting=!1,t.connected=!0,t.unsuccessfulReconnects=0,t.emit("connect",[{type:"connect"},t]),r=setTimeout(o,Wn/2)}}};class Iu extends ms{constructor(e,{binaryType:n}={}){super(),this.url=e,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Wn<Ge()-this.lastMessageReceived&&this.ws.close()},Wn/2),Br(this)}send(e){this.ws&&this.ws.send(JSON.stringify(e))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&Br(this)}}const or=t=>new Error(t),jo=64,$t=128,$r=63,yt=127,xu=2147483647,Lu=crypto.getRandomValues.bind(crypto),Nu=Math.random,Mu=()=>Lu(new Uint32Array(1))[0],Uu="10000000-1000-4000-8000"+-1e11,Fu=()=>Uu.replace(/[018]/g,t=>(t^Mu()&15>>t/4).toString(16)),Pu=String.fromCharCode,ju=t=>t.toLowerCase(),Bu=/^\s*/g,$u=t=>t.replace(Bu,""),Vu=/([A-Z])/g,bi=(t,e)=>$u(t.replace(Vu,n=>`${e}${ju(n)}`)),Wu=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},yn=typeof TextEncoder<"u"?new TextEncoder:null,qu=t=>yn.encode(t),Vr=yn?qu:Wu;let nn=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});nn&&nn.decode(new Uint8Array).length===1&&(nn=null);const mi=t=>t===void 0?null:t;class Hu{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Bo=new Hu,ws=!0;try{typeof localStorage<"u"&&(Bo=localStorage,ws=!1)}catch{}const $o=Bo,zu=t=>ws||addEventListener("storage",t),Yu=t=>ws||removeEventListener("storage",t),Gu=Object.keys,wi=t=>Gu(t).length,Ju=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Ku=()=>{},Xu=(t,e)=>t===e,rn=(t,e)=>{if(t==null||e==null)return Xu(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!rn(t.get(n),e.get(n)))return!1;break}case Object:if(wi(t)!==wi(e))return!1;for(const n in t)if(!Ju(t,n)||!rn(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!rn(t[n],e[n]))return!1;break;default:return!1}return!0},Zu=(t,e)=>e.includes(t);var Vo={};const Vt=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name),Wo=typeof window<"u"&&typeof document<"u"&&!Vt;let Me;const Qu=()=>{if(Me===void 0)if(Vt){Me=gt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Me.set(e,""),e=r):e!==null&&(Me.set(e,r),e=null)}e!==null&&Me.set(e,"")}else typeof location=="object"?(Me=gt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Me.set(`--${bi(e,"-")}`,n),Me.set(`-${bi(e,"-")}`,n)}})):Me=gt();return Me},Wr=t=>Qu().has(t),qn=t=>mi(Vt?Vo[t.toUpperCase()]:$o.getItem(t)),eh=t=>Wr("--"+t)||qn(t)!==null;eh("production");const _i=Vt&&Zu(Vo.FORCE_COLOR,["true","1","2"]),th=!Wr("no-colors")&&(!Vt||process.stdout.isTTY||_i)&&(!Vt||Wr("color")||_i||qn("COLORTERM")!==null||(qn("TERM")||"").includes("color")),qo=Number.MAX_SAFE_INTEGER,nh=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Bt(t)===t),Ho=or("Unexpected end of array"),zo=or("Integer out of Range");class rh{constructor(e){this.arr=e,this.pos=0}}const ar=t=>new rh(t),sh=(t,e)=>{const n=vs(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},St=t=>sh(t,ze(t)),Hn=t=>t.arr[t.pos++],ze=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&yt)*n,n*=128,i<$t)return e;if(e>qo)throw zo}throw Ho},ih=t=>{let e=t.arr[t.pos++],n=e&$r,r=64;const i=(e&jo)>0?-1:1;if((e&$t)===0)return i*n;const o=t.arr.length;for(;t.pos<o;){if(e=t.arr[t.pos++],n=n+(e&yt)*r,r*=128,e<$t)return i*n;if(n>qo)throw zo}throw Ho},oh=t=>{let e=ze(t);if(e===0)return"";{let n=String.fromCodePoint(Hn(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Hn(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},ah=t=>nn.decode(St(t)),bn=nn?ah:oh,_s=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},ch=t=>_s(t,4).getFloat32(0,!1),lh=t=>_s(t,8).getFloat64(0,!1),uh=t=>_s(t,8).getBigInt64(0,!1),hh=[t=>{},t=>null,ih,ch,lh,uh,t=>!1,t=>!0,bn,t=>{const e=ze(t),n={};for(let r=0;r<e;r++){const i=bn(t);n[i]=qr(t)}return n},t=>{const e=ze(t),n=[];for(let r=0;r<e;r++)n.push(qr(t));return n},St],qr=t=>hh[127-Hn(t)](t),fh=t=>new Uint8Array(t),vs=(t,e,n)=>new Uint8Array(t,e,n),dh=t=>new Uint8Array(t),ph=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=Pu(t[n]);return btoa(e)},gh=t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),yh=t=>{const e=atob(t),n=fh(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},bh=t=>{const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},Yo=Wo?ph:gh,Go=Wo?yh:bh;class mh{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ge=()=>new mh,wh=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},me=t=>{const e=new Uint8Array(wh(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(vs(t.cbuf.buffer,0,t.cpos),n),e},_h=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(vs(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Po(n,e)*2),t.cpos=0)},he=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Jo=he,te=(t,e)=>{for(;e>yt;)he(t,$t|yt&e),e=Bt(e/128);he(t,yt&e)},vh=(t,e)=>{const n=Tu(e);for(n&&(e=-e),he(t,(e>$r?$t:0)|(n?jo:0)|$r&e),e=Bt(e/64);e>0;)he(t,(e>yt?$t:0)|yt&e),e=Bt(e/128)},Hr=new Uint8Array(3e4),Sh=Hr.length/3,Ch=(t,e)=>{if(e.length<Sh){const n=yn.encodeInto(e,Hr).written||0;te(t,n);for(let r=0;r<n;r++)he(t,Hr[r])}else Ie(t,Vr(e))},Eh=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;te(t,r);for(let i=0;i<r;i++)he(t,n.codePointAt(i))},Wt=yn&&yn.encodeInto?Ch:Eh,kh=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Fo(n-r,e.length),o=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,o>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Po(n*2,o)),t.cbuf.set(e.subarray(i)),t.cpos=o)},Ie=(t,e)=>{te(t,e.byteLength),kh(t,e)},Ss=(t,e)=>{_h(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Rh=(t,e)=>Ss(t,4).setFloat32(0,e,!1),Ah=(t,e)=>Ss(t,8).setFloat64(0,e,!1),Th=(t,e)=>Ss(t,8).setBigInt64(0,e,!1),vi=new DataView(new ArrayBuffer(4)),Oh=t=>(vi.setFloat32(0,t),vi.getFloat32(0)===t),zr=(t,e)=>{switch(typeof e){case"string":he(t,119),Wt(t,e);break;case"number":nh(e)&&Ru(e)<=xu?(he(t,125),vh(t,e)):Oh(e)?(he(t,124),Rh(t,e)):(he(t,123),Ah(t,e));break;case"bigint":he(t,122),Th(t,e);break;case"object":if(e===null)he(t,126);else if(e instanceof Array){he(t,117),te(t,e.length);for(let n=0;n<e.length;n++)zr(t,e[n])}else if(e instanceof Uint8Array)he(t,116),Ie(t,e);else{he(t,118);const n=Object.keys(e);te(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Wt(t,i),zr(t,e[i])}}break;case"boolean":he(t,e?120:121);break;default:he(t,127)}};class Dh{constructor(e,n){this.left=e,this.right=n}}const qe=(t,e)=>new Dh(t,e);typeof DOMParser<"u"&&new DOMParser;const Ih=t=>Eu(t,(e,n)=>`${n}:${e};`).join(""),Xe=Symbol,Ae=Xe(),qt=Xe(),Ko=Xe(),Cs=Xe(),Xo=Xe(),xh=Xe(),Zo=Xe(),Qo=Xe(),cr=Xe(),Lh=t=>{const e=[];let n=0;for(;n<t.length;n++){const r=t[n];r.constructor===String||r.constructor===Number||r.constructor===Object&&e.push(JSON.stringify(r))}return e},Si=[Xo,Zo,Qo,Ko];let wr=0,Ci=Ge();const Nh=(t,e)=>{const n=Si[wr],r=qn("log"),i=r!==null&&(r==="*"||r==="true"||new RegExp(r,"gi").test(e));return wr=(wr+1)%Si.length,e+=": ",i?(...o)=>{const a=Ge(),c=a-Ci;Ci=a,t(n,e,cr,...o.map(u=>typeof u=="string"||typeof u=="symbol"?u:JSON.stringify(u)),n," +"+c+"ms")}:Ku},Mh={[Ae]:qe("font-weight","bold"),[qt]:qe("font-weight","normal"),[Ko]:qe("color","blue"),[Xo]:qe("color","green"),[Cs]:qe("color","grey"),[xh]:qe("color","red"),[Zo]:qe("color","purple"),[Qo]:qe("color","orange"),[cr]:qe("color","black")},Uh=t=>{const e=[],n=[],r=gt();let i=[],o=0;for(;o<t.length;o++){const a=t[o],c=Mh[a];if(c!==void 0)r.set(c.left,c.right);else if(a.constructor===String||a.constructor===Number){const u=Ih(r);o>0||u.length>0?(e.push("%c"+a),n.push(u)):e.push(a)}else break}for(o>0&&(i=n,i.unshift(e.join("")));o<t.length;o++){const a=t[o];a instanceof Symbol||i.push(a)}return i},Fh=th?Uh:Lh,Ph=(...t)=>{console.log(...Fh(t)),jh.forEach(e=>e.print(t))},jh=bs(),Bh=t=>Nh(Ph,t),$h=t=>Promise.reject(t),Es=t=>Promise.resolve(t),ea=new Map;class Vh{constructor(e){this.room=e,this.onmessage=null,this._onChange=n=>n.key===e&&this.onmessage!==null&&this.onmessage({data:Go(n.newValue||"")}),zu(this._onChange)}postMessage(e){$o.setItem(this.room,Yo(dh(e)))}close(){Yu(this._onChange)}}const Wh=typeof BroadcastChannel>"u"?Vh:BroadcastChannel,ks=t=>gn(ea,t,()=>{const e=bs(),n=new Wh(t);return n.onmessage=r=>e.forEach(i=>i(r.data,"broadcastchannel")),{bc:n,subs:e}}),qh=(t,e)=>(ks(t).subs.add(e),e),Hh=(t,e)=>{const n=ks(t),r=n.subs.delete(e);return r&&n.subs.size===0&&(n.bc.close(),ea.delete(t)),r},zh=(t,e,n=null)=>{const r=ks(t);r.bc.postMessage(e),r.subs.forEach(i=>i(e,n))},Yh=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else n!==void 0&&n()}};function Dn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _r={exports:{}},Ei;function Gh(){return Ei||(Ei=1,function(t,e){(function(n){t.exports=n()})(function(){var n=Math.floor,r=Math.abs,i=Math.pow;return function(){function o(a,c,u){function p(d,g){if(!c[d]){if(!a[d]){var y=typeof Dn=="function"&&Dn;if(!g&&y)return y(d,!0);if(b)return b(d,!0);var S=new Error("Cannot find module '"+d+"'");throw S.code="MODULE_NOT_FOUND",S}var N=c[d]={exports:{}};a[d][0].call(N.exports,function(I){var M=a[d][1][I];return p(M||I)},N,N.exports,o,a,c,u)}return c[d].exports}for(var b=typeof Dn=="function"&&Dn,h=0;h<u.length;h++)p(u[h]);return p}return o}()({1:[function(o,a,c){function u(_){var v=_.length;if(0<v%4)throw new Error("Invalid string. Length must be a multiple of 4");var A=_.indexOf("=");A===-1&&(A=v);var E=A===v?0:4-A%4;return[A,E]}function p(_,v,A){return 3*(v+A)/4-A}function b(_){var v,A,E=u(_),D=E[0],U=E[1],k=new N(p(_,D,U)),T=0,F=0<U?D-4:D;for(A=0;A<F;A+=4)v=S[_.charCodeAt(A)]<<18|S[_.charCodeAt(A+1)]<<12|S[_.charCodeAt(A+2)]<<6|S[_.charCodeAt(A+3)],k[T++]=255&v>>16,k[T++]=255&v>>8,k[T++]=255&v;return U===2&&(v=S[_.charCodeAt(A)]<<2|S[_.charCodeAt(A+1)]>>4,k[T++]=255&v),U===1&&(v=S[_.charCodeAt(A)]<<10|S[_.charCodeAt(A+1)]<<4|S[_.charCodeAt(A+2)]>>2,k[T++]=255&v>>8,k[T++]=255&v),k}function h(_){return y[63&_>>18]+y[63&_>>12]+y[63&_>>6]+y[63&_]}function d(_,v,A){for(var E,D=[],U=v;U<A;U+=3)E=(16711680&_[U]<<16)+(65280&_[U+1]<<8)+(255&_[U+2]),D.push(h(E));return D.join("")}function g(_){for(var v,A=_.length,E=A%3,D=[],U=16383,k=0,T=A-E;k<T;k+=U)D.push(d(_,k,k+U>T?T:k+U));return E===1?(v=_[A-1],D.push(y[v>>2]+y[63&v<<4]+"==")):E===2&&(v=(_[A-2]<<8)+_[A-1],D.push(y[v>>10]+y[63&v>>4]+y[63&v<<2]+"=")),D.join("")}c.byteLength=function(_){var v=u(_),A=v[0],E=v[1];return 3*(A+E)/4-E},c.toByteArray=b,c.fromByteArray=g;for(var y=[],S=[],N=typeof Uint8Array>"u"?Array:Uint8Array,I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=0,m=I.length;M<m;++M)y[M]=I[M],S[I.charCodeAt(M)]=M;S[45]=62,S[95]=63},{}],2:[function(){},{}],3:[function(o,a,c){(function(){(function(){var u=String.fromCharCode,p=Math.min;function b(s){if(2147483647<s)throw new RangeError('The value "'+s+'" is invalid for option "size"');var l=new Uint8Array(s);return l.__proto__=h.prototype,l}function h(s,l,f){if(typeof s=="number"){if(typeof l=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return S(s)}return d(s,l,f)}function d(s,l,f){if(typeof s=="string")return N(s,l);if(ArrayBuffer.isView(s))return I(s);if(s==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(O(s,ArrayBuffer)||s&&O(s.buffer,ArrayBuffer))return M(s,l,f);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var C=s.valueOf&&s.valueOf();if(C!=null&&C!==s)return h.from(C,l,f);var R=m(s);if(R)return R;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return h.from(s[Symbol.toPrimitive]("string"),l,f);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}function g(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(0>s)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function y(s,l,f){return g(s),0>=s||l===void 0?b(s):typeof f=="string"?b(s).fill(l,f):b(s).fill(l)}function S(s){return g(s),b(0>s?0:0|_(s))}function N(s,l){if((typeof l!="string"||l==="")&&(l="utf8"),!h.isEncoding(l))throw new TypeError("Unknown encoding: "+l);var f=0|v(s,l),C=b(f),R=C.write(s,l);return R!==f&&(C=C.slice(0,R)),C}function I(s){for(var l=0>s.length?0:0|_(s.length),f=b(l),C=0;C<l;C+=1)f[C]=255&s[C];return f}function M(s,l,f){if(0>l||s.byteLength<l)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<l+(f||0))throw new RangeError('"length" is outside of buffer bounds');var C;return C=l===void 0&&f===void 0?new Uint8Array(s):f===void 0?new Uint8Array(s,l):new Uint8Array(s,l,f),C.__proto__=h.prototype,C}function m(s){if(h.isBuffer(s)){var l=0|_(s.length),f=b(l);return f.length===0||s.copy(f,0,0,l),f}return s.length===void 0?s.type==="Buffer"&&Array.isArray(s.data)?I(s.data):void 0:typeof s.length!="number"||x(s.length)?b(0):I(s)}function _(s){if(s>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|s}function v(s,l){if(h.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||O(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);var f=s.length,C=2<arguments.length&&arguments[2]===!0;if(!C&&f===0)return 0;for(var R=!1;;)switch(l){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":return ht(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*f;case"hex":return f>>>1;case"base64":return ke(s).length;default:if(R)return C?-1:ht(s).length;l=(""+l).toLowerCase(),R=!0}}function A(s,l,f){var C=!1;if((l===void 0||0>l)&&(l=0),l>this.length||((f===void 0||f>this.length)&&(f=this.length),0>=f)||(f>>>=0,l>>>=0,f<=l))return"";for(s||(s="utf8");;)switch(s){case"hex":return Ce(this,l,f);case"utf8":case"utf-8":return ie(this,l,f);case"ascii":return V(this,l,f);case"latin1":case"binary":return Rt(this,l,f);case"base64":return X(this,l,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Ze(this,l,f);default:if(C)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),C=!0}}function E(s,l,f){var C=s[l];s[l]=s[f],s[f]=C}function D(s,l,f,C,R){if(s.length===0)return-1;if(typeof f=="string"?(C=f,f=0):2147483647<f?f=2147483647:-2147483648>f&&(f=-2147483648),f=+f,x(f)&&(f=R?0:s.length-1),0>f&&(f=s.length+f),f>=s.length){if(R)return-1;f=s.length-1}else if(0>f)if(R)f=0;else return-1;if(typeof l=="string"&&(l=h.from(l,C)),h.isBuffer(l))return l.length===0?-1:U(s,l,f,C,R);if(typeof l=="number")return l&=255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(s,l,f):Uint8Array.prototype.lastIndexOf.call(s,l,f):U(s,[l],f,C,R);throw new TypeError("val must be string, number or Buffer")}function U(s,l,f,C,R){function L(At,Xt){return B===1?At[Xt]:At.readUInt16BE(Xt*B)}var B=1,Y=s.length,ee=l.length;if(C!==void 0&&(C=(C+"").toLowerCase(),C==="ucs2"||C==="ucs-2"||C==="utf16le"||C==="utf-16le")){if(2>s.length||2>l.length)return-1;B=2,Y/=2,ee/=2,f/=2}var G;if(R){var z=-1;for(G=f;G<Y;G++)if(L(s,G)!==L(l,z===-1?0:G-z))z!==-1&&(G-=G-z),z=-1;else if(z===-1&&(z=G),G-z+1===ee)return z*B}else for(f+ee>Y&&(f=Y-ee),G=f;0<=G;G--){for(var de=!0,ft=0;ft<ee;ft++)if(L(s,G+ft)!==L(l,ft)){de=!1;break}if(de)return G}return-1}function k(s,l,f,C){f=+f||0;var R=s.length-f;C?(C=+C,C>R&&(C=R)):C=R;var L=l.length;C>L/2&&(C=L/2);for(var B,Y=0;Y<C;++Y){if(B=parseInt(l.substr(2*Y,2),16),x(B))return Y;s[f+Y]=B}return Y}function T(s,l,f,C){return Re(ht(l,s.length-f),s,f,C)}function F(s,l,f,C){return Re(Kt(l),s,f,C)}function j(s,l,f,C){return F(s,l,f,C)}function W(s,l,f,C){return Re(ke(l),s,f,C)}function q(s,l,f,C){return Re(tt(l,s.length-f),s,f,C)}function X(s,l,f){return l===0&&f===s.length?P.fromByteArray(s):P.fromByteArray(s.slice(l,f))}function ie(s,l,f){f=p(s.length,f);for(var C=[],R=l;R<f;){var L=s[R],B=null,Y=239<L?4:223<L?3:191<L?2:1;if(R+Y<=f){var ee,G,z,de;Y===1?128>L&&(B=L):Y===2?(ee=s[R+1],(192&ee)==128&&(de=(31&L)<<6|63&ee,127<de&&(B=de))):Y===3?(ee=s[R+1],G=s[R+2],(192&ee)==128&&(192&G)==128&&(de=(15&L)<<12|(63&ee)<<6|63&G,2047<de&&(55296>de||57343<de)&&(B=de))):Y===4&&(ee=s[R+1],G=s[R+2],z=s[R+3],(192&ee)==128&&(192&G)==128&&(192&z)==128&&(de=(15&L)<<18|(63&ee)<<12|(63&G)<<6|63&z,65535<de&&1114112>de&&(B=de)))}B===null?(B=65533,Y=1):65535<B&&(B-=65536,C.push(55296|1023&B>>>10),B=56320|1023&B),C.push(B),R+=Y}return pe(C)}function pe(s){var l=s.length;if(l<=4096)return u.apply(String,s);for(var f="",C=0;C<l;)f+=u.apply(String,s.slice(C,C+=4096));return f}function V(s,l,f){var C="";f=p(s.length,f);for(var R=l;R<f;++R)C+=u(127&s[R]);return C}function Rt(s,l,f){var C="";f=p(s.length,f);for(var R=l;R<f;++R)C+=u(s[R]);return C}function Ce(s,l,f){var C=s.length;(!l||0>l)&&(l=0),(!f||0>f||f>C)&&(f=C);for(var R="",L=l;L<f;++L)R+=ut(s[L]);return R}function Ze(s,l,f){for(var C=s.slice(l,f),R="",L=0;L<C.length;L+=2)R+=u(C[L]+256*C[L+1]);return R}function ne(s,l,f){if(s%1!=0||0>s)throw new RangeError("offset is not uint");if(s+l>f)throw new RangeError("Trying to access beyond buffer length")}function Z(s,l,f,C,R,L){if(!h.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(l>R||l<L)throw new RangeError('"value" argument is out of bounds');if(f+C>s.length)throw new RangeError("Index out of range")}function Ee(s,l,f,C){if(f+C>s.length)throw new RangeError("Index out of range");if(0>f)throw new RangeError("Index out of range")}function Qe(s,l,f,C,R){return l=+l,f>>>=0,R||Ee(s,l,f,4),$.write(s,l,f,C,23,4),f+4}function et(s,l,f,C,R){return l=+l,f>>>=0,R||Ee(s,l,f,8),$.write(s,l,f,C,52,8),f+8}function Jt(s){if(s=s.split("=")[0],s=s.trim().replace(w,""),2>s.length)return"";for(;s.length%4!=0;)s+="=";return s}function ut(s){return 16>s?"0"+s.toString(16):s.toString(16)}function ht(s,l){l=l||1/0;for(var f,C=s.length,R=null,L=[],B=0;B<C;++B){if(f=s.charCodeAt(B),55295<f&&57344>f){if(!R){if(56319<f){-1<(l-=3)&&L.push(239,191,189);continue}else if(B+1===C){-1<(l-=3)&&L.push(239,191,189);continue}R=f;continue}if(56320>f){-1<(l-=3)&&L.push(239,191,189),R=f;continue}f=(R-55296<<10|f-56320)+65536}else R&&-1<(l-=3)&&L.push(239,191,189);if(R=null,128>f){if(0>(l-=1))break;L.push(f)}else if(2048>f){if(0>(l-=2))break;L.push(192|f>>6,128|63&f)}else if(65536>f){if(0>(l-=3))break;L.push(224|f>>12,128|63&f>>6,128|63&f)}else if(1114112>f){if(0>(l-=4))break;L.push(240|f>>18,128|63&f>>12,128|63&f>>6,128|63&f)}else throw new Error("Invalid code point")}return L}function Kt(s){for(var l=[],f=0;f<s.length;++f)l.push(255&s.charCodeAt(f));return l}function tt(s,l){for(var f,C,R,L=[],B=0;B<s.length&&!(0>(l-=2));++B)f=s.charCodeAt(B),C=f>>8,R=f%256,L.push(R),L.push(C);return L}function ke(s){return P.toByteArray(Jt(s))}function Re(s,l,f,C){for(var R=0;R<C&&!(R+f>=l.length||R>=s.length);++R)l[R+f]=s[R];return R}function O(s,l){return s instanceof l||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===l.name}function x(s){return s!==s}var P=o("base64-js"),$=o("ieee754");c.Buffer=h,c.SlowBuffer=function(s){return+s!=s&&(s=0),h.alloc(+s)},c.INSPECT_MAX_BYTES=50,c.kMaxLength=2147483647,h.TYPED_ARRAY_SUPPORT=function(){try{var s=new Uint8Array(1);return s.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},s.foo()===42}catch{return!1}}(),h.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){return h.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){return h.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(s,l,f){return d(s,l,f)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(s,l,f){return y(s,l,f)},h.allocUnsafe=function(s){return S(s)},h.allocUnsafeSlow=function(s){return S(s)},h.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==h.prototype},h.compare=function(s,l){if(O(s,Uint8Array)&&(s=h.from(s,s.offset,s.byteLength)),O(l,Uint8Array)&&(l=h.from(l,l.offset,l.byteLength)),!h.isBuffer(s)||!h.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===l)return 0;for(var f=s.length,C=l.length,R=0,L=p(f,C);R<L;++R)if(s[R]!==l[R]){f=s[R],C=l[R];break}return f<C?-1:C<f?1:0},h.isEncoding=function(s){switch((s+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(s,l){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return h.alloc(0);var f;if(l===void 0)for(l=0,f=0;f<s.length;++f)l+=s[f].length;var C=h.allocUnsafe(l),R=0;for(f=0;f<s.length;++f){var L=s[f];if(O(L,Uint8Array)&&(L=h.from(L)),!h.isBuffer(L))throw new TypeError('"list" argument must be an Array of Buffers');L.copy(C,R),R+=L.length}return C},h.byteLength=v,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var s=this.length;if(s%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var l=0;l<s;l+=2)E(this,l,l+1);return this},h.prototype.swap32=function(){var s=this.length;if(s%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var l=0;l<s;l+=4)E(this,l,l+3),E(this,l+1,l+2);return this},h.prototype.swap64=function(){var s=this.length;if(s%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var l=0;l<s;l+=8)E(this,l,l+7),E(this,l+1,l+6),E(this,l+2,l+5),E(this,l+3,l+4);return this},h.prototype.toString=function(){var s=this.length;return s===0?"":arguments.length===0?ie(this,0,s):A.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(s){if(!h.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s||h.compare(this,s)===0},h.prototype.inspect=function(){var s="",l=c.INSPECT_MAX_BYTES;return s=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(s+=" ... "),"<Buffer "+s+">"},h.prototype.compare=function(s,l,f,C,R){if(O(s,Uint8Array)&&(s=h.from(s,s.offset,s.byteLength)),!h.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(l===void 0&&(l=0),f===void 0&&(f=s?s.length:0),C===void 0&&(C=0),R===void 0&&(R=this.length),0>l||f>s.length||0>C||R>this.length)throw new RangeError("out of range index");if(C>=R&&l>=f)return 0;if(C>=R)return-1;if(l>=f)return 1;if(l>>>=0,f>>>=0,C>>>=0,R>>>=0,this===s)return 0;for(var L=R-C,B=f-l,Y=p(L,B),ee=this.slice(C,R),G=s.slice(l,f),z=0;z<Y;++z)if(ee[z]!==G[z]){L=ee[z],B=G[z];break}return L<B?-1:B<L?1:0},h.prototype.includes=function(s,l,f){return this.indexOf(s,l,f)!==-1},h.prototype.indexOf=function(s,l,f){return D(this,s,l,f,!0)},h.prototype.lastIndexOf=function(s,l,f){return D(this,s,l,f,!1)},h.prototype.write=function(s,l,f,C){if(l===void 0)C="utf8",f=this.length,l=0;else if(f===void 0&&typeof l=="string")C=l,f=this.length,l=0;else if(isFinite(l))l>>>=0,isFinite(f)?(f>>>=0,C===void 0&&(C="utf8")):(C=f,f=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var R=this.length-l;if((f===void 0||f>R)&&(f=R),0<s.length&&(0>f||0>l)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");C||(C="utf8");for(var L=!1;;)switch(C){case"hex":return k(this,s,l,f);case"utf8":case"utf-8":return T(this,s,l,f);case"ascii":return F(this,s,l,f);case"latin1":case"binary":return j(this,s,l,f);case"base64":return W(this,s,l,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return q(this,s,l,f);default:if(L)throw new TypeError("Unknown encoding: "+C);C=(""+C).toLowerCase(),L=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(s,l){var f=this.length;s=~~s,l=l===void 0?f:~~l,0>s?(s+=f,0>s&&(s=0)):s>f&&(s=f),0>l?(l+=f,0>l&&(l=0)):l>f&&(l=f),l<s&&(l=s);var C=this.subarray(s,l);return C.__proto__=h.prototype,C},h.prototype.readUIntLE=function(s,l,f){s>>>=0,l>>>=0,f||ne(s,l,this.length);for(var C=this[s],R=1,L=0;++L<l&&(R*=256);)C+=this[s+L]*R;return C},h.prototype.readUIntBE=function(s,l,f){s>>>=0,l>>>=0,f||ne(s,l,this.length);for(var C=this[s+--l],R=1;0<l&&(R*=256);)C+=this[s+--l]*R;return C},h.prototype.readUInt8=function(s,l){return s>>>=0,l||ne(s,1,this.length),this[s]},h.prototype.readUInt16LE=function(s,l){return s>>>=0,l||ne(s,2,this.length),this[s]|this[s+1]<<8},h.prototype.readUInt16BE=function(s,l){return s>>>=0,l||ne(s,2,this.length),this[s]<<8|this[s+1]},h.prototype.readUInt32LE=function(s,l){return s>>>=0,l||ne(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+16777216*this[s+3]},h.prototype.readUInt32BE=function(s,l){return s>>>=0,l||ne(s,4,this.length),16777216*this[s]+(this[s+1]<<16|this[s+2]<<8|this[s+3])},h.prototype.readIntLE=function(s,l,f){s>>>=0,l>>>=0,f||ne(s,l,this.length);for(var C=this[s],R=1,L=0;++L<l&&(R*=256);)C+=this[s+L]*R;return R*=128,C>=R&&(C-=i(2,8*l)),C},h.prototype.readIntBE=function(s,l,f){s>>>=0,l>>>=0,f||ne(s,l,this.length);for(var C=l,R=1,L=this[s+--C];0<C&&(R*=256);)L+=this[s+--C]*R;return R*=128,L>=R&&(L-=i(2,8*l)),L},h.prototype.readInt8=function(s,l){return s>>>=0,l||ne(s,1,this.length),128&this[s]?-1*(255-this[s]+1):this[s]},h.prototype.readInt16LE=function(s,l){s>>>=0,l||ne(s,2,this.length);var f=this[s]|this[s+1]<<8;return 32768&f?4294901760|f:f},h.prototype.readInt16BE=function(s,l){s>>>=0,l||ne(s,2,this.length);var f=this[s+1]|this[s]<<8;return 32768&f?4294901760|f:f},h.prototype.readInt32LE=function(s,l){return s>>>=0,l||ne(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},h.prototype.readInt32BE=function(s,l){return s>>>=0,l||ne(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},h.prototype.readFloatLE=function(s,l){return s>>>=0,l||ne(s,4,this.length),$.read(this,s,!0,23,4)},h.prototype.readFloatBE=function(s,l){return s>>>=0,l||ne(s,4,this.length),$.read(this,s,!1,23,4)},h.prototype.readDoubleLE=function(s,l){return s>>>=0,l||ne(s,8,this.length),$.read(this,s,!0,52,8)},h.prototype.readDoubleBE=function(s,l){return s>>>=0,l||ne(s,8,this.length),$.read(this,s,!1,52,8)},h.prototype.writeUIntLE=function(s,l,f,C){if(s=+s,l>>>=0,f>>>=0,!C){var R=i(2,8*f)-1;Z(this,s,l,f,R,0)}var L=1,B=0;for(this[l]=255&s;++B<f&&(L*=256);)this[l+B]=255&s/L;return l+f},h.prototype.writeUIntBE=function(s,l,f,C){if(s=+s,l>>>=0,f>>>=0,!C){var R=i(2,8*f)-1;Z(this,s,l,f,R,0)}var L=f-1,B=1;for(this[l+L]=255&s;0<=--L&&(B*=256);)this[l+L]=255&s/B;return l+f},h.prototype.writeUInt8=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,1,255,0),this[l]=255&s,l+1},h.prototype.writeUInt16LE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,2,65535,0),this[l]=255&s,this[l+1]=s>>>8,l+2},h.prototype.writeUInt16BE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,2,65535,0),this[l]=s>>>8,this[l+1]=255&s,l+2},h.prototype.writeUInt32LE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,4,4294967295,0),this[l+3]=s>>>24,this[l+2]=s>>>16,this[l+1]=s>>>8,this[l]=255&s,l+4},h.prototype.writeUInt32BE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,4,4294967295,0),this[l]=s>>>24,this[l+1]=s>>>16,this[l+2]=s>>>8,this[l+3]=255&s,l+4},h.prototype.writeIntLE=function(s,l,f,C){if(s=+s,l>>>=0,!C){var R=i(2,8*f-1);Z(this,s,l,f,R-1,-R)}var L=0,B=1,Y=0;for(this[l]=255&s;++L<f&&(B*=256);)0>s&&Y===0&&this[l+L-1]!==0&&(Y=1),this[l+L]=255&(s/B>>0)-Y;return l+f},h.prototype.writeIntBE=function(s,l,f,C){if(s=+s,l>>>=0,!C){var R=i(2,8*f-1);Z(this,s,l,f,R-1,-R)}var L=f-1,B=1,Y=0;for(this[l+L]=255&s;0<=--L&&(B*=256);)0>s&&Y===0&&this[l+L+1]!==0&&(Y=1),this[l+L]=255&(s/B>>0)-Y;return l+f},h.prototype.writeInt8=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,1,127,-128),0>s&&(s=255+s+1),this[l]=255&s,l+1},h.prototype.writeInt16LE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,2,32767,-32768),this[l]=255&s,this[l+1]=s>>>8,l+2},h.prototype.writeInt16BE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,2,32767,-32768),this[l]=s>>>8,this[l+1]=255&s,l+2},h.prototype.writeInt32LE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,4,2147483647,-2147483648),this[l]=255&s,this[l+1]=s>>>8,this[l+2]=s>>>16,this[l+3]=s>>>24,l+4},h.prototype.writeInt32BE=function(s,l,f){return s=+s,l>>>=0,f||Z(this,s,l,4,2147483647,-2147483648),0>s&&(s=4294967295+s+1),this[l]=s>>>24,this[l+1]=s>>>16,this[l+2]=s>>>8,this[l+3]=255&s,l+4},h.prototype.writeFloatLE=function(s,l,f){return Qe(this,s,l,!0,f)},h.prototype.writeFloatBE=function(s,l,f){return Qe(this,s,l,!1,f)},h.prototype.writeDoubleLE=function(s,l,f){return et(this,s,l,!0,f)},h.prototype.writeDoubleBE=function(s,l,f){return et(this,s,l,!1,f)},h.prototype.copy=function(s,l,f,C){if(!h.isBuffer(s))throw new TypeError("argument should be a Buffer");if(f||(f=0),C||C===0||(C=this.length),l>=s.length&&(l=s.length),l||(l=0),0<C&&C<f&&(C=f),C===f||s.length===0||this.length===0)return 0;if(0>l)throw new RangeError("targetStart out of bounds");if(0>f||f>=this.length)throw new RangeError("Index out of range");if(0>C)throw new RangeError("sourceEnd out of bounds");C>this.length&&(C=this.length),s.length-l<C-f&&(C=s.length-l+f);var R=C-f;if(this===s&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(l,f,C);else if(this===s&&f<l&&l<C)for(var L=R-1;0<=L;--L)s[L+l]=this[L+f];else Uint8Array.prototype.set.call(s,this.subarray(f,C),l);return R},h.prototype.fill=function(s,l,f,C){if(typeof s=="string"){if(typeof l=="string"?(C=l,l=0,f=this.length):typeof f=="string"&&(C=f,f=this.length),C!==void 0&&typeof C!="string")throw new TypeError("encoding must be a string");if(typeof C=="string"&&!h.isEncoding(C))throw new TypeError("Unknown encoding: "+C);if(s.length===1){var R=s.charCodeAt(0);(C==="utf8"&&128>R||C==="latin1")&&(s=R)}}else typeof s=="number"&&(s&=255);if(0>l||this.length<l||this.length<f)throw new RangeError("Out of range index");if(f<=l)return this;l>>>=0,f=f===void 0?this.length:f>>>0,s||(s=0);var L;if(typeof s=="number")for(L=l;L<f;++L)this[L]=s;else{var B=h.isBuffer(s)?s:h.from(s,C),Y=B.length;if(Y===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(L=0;L<f-l;++L)this[L+l]=B[L%Y]}return this};var w=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,a,c){(function(u){(function(){function p(){let h;try{h=c.storage.getItem("debug")}catch{}return!h&&typeof u<"u"&&"env"in u&&(h=u.env.DEBUG),h}c.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+a.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;h.splice(1,0,d,"color: inherit");let g=0,y=0;h[0].replace(/%[a-zA-Z%]/g,S=>{S==="%%"||(g++,S==="%c"&&(y=g))}),h.splice(y,0,d)},c.save=function(h){try{h?c.storage.setItem("debug",h):c.storage.removeItem("debug")}catch{}},c.load=p,c.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),a.exports=o("./common")(c);const{formatters:b}=a.exports;b.j=function(h){try{return JSON.stringify(h)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,a){a.exports=function(c){function u(h){function d(...S){if(!d.enabled)return;const N=d,I=+new Date,M=I-(g||I);N.diff=M,N.prev=g,N.curr=I,g=I,S[0]=u.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let m=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(v,A)=>{if(v==="%%")return"%";m++;const E=u.formatters[A];if(typeof E=="function"){const D=S[m];v=E.call(N,D),S.splice(m,1),m--}return v}),u.formatArgs.call(N,S),(N.log||u.log).apply(N,S)}let g,y=null;return d.namespace=h,d.useColors=u.useColors(),d.color=u.selectColor(h),d.extend=p,d.destroy=u.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>y===null?u.enabled(h):y,set:S=>{y=S}}),typeof u.init=="function"&&u.init(d),d}function p(h,d){const g=u(this.namespace+(typeof d>"u"?":":d)+h);return g.log=this.log,g}function b(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return u.debug=u,u.default=u,u.coerce=function(h){return h instanceof Error?h.stack||h.message:h},u.disable=function(){const h=[...u.names.map(b),...u.skips.map(b).map(d=>"-"+d)].join(",");return u.enable(""),h},u.enable=function(h){u.save(h),u.names=[],u.skips=[];let d;const g=(typeof h=="string"?h:"").split(/[\s,]+/),y=g.length;for(d=0;d<y;d++)g[d]&&(h=g[d].replace(/\*/g,".*?"),h[0]==="-"?u.skips.push(new RegExp("^"+h.substr(1)+"$")):u.names.push(new RegExp("^"+h+"$")))},u.enabled=function(h){if(h[h.length-1]==="*")return!0;let d,g;for(d=0,g=u.skips.length;d<g;d++)if(u.skips[d].test(h))return!1;for(d=0,g=u.names.length;d<g;d++)if(u.names[d].test(h))return!0;return!1},u.humanize=o("ms"),u.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(c).forEach(h=>{u[h]=c[h]}),u.names=[],u.skips=[],u.formatters={},u.selectColor=function(h){let d=0;for(let g=0;g<h.length;g++)d=(d<<5)-d+h.charCodeAt(g),d|=0;return u.colors[r(d)%u.colors.length]},u.enable(u.load()),u}},{ms:11}],6:[function(o,a){function c(u,p){for(const b in p)Object.defineProperty(u,b,{value:p[b],enumerable:!0,configurable:!0});return u}a.exports=function(u,p,b){if(!u||typeof u=="string")throw new TypeError("Please pass an Error to err-code");b||(b={}),typeof p=="object"&&(b=p,p=""),p&&(b.code=p);try{return c(u,b)}catch{b.message=u.message,b.stack=u.stack;const d=function(){};return d.prototype=Object.create(Object.getPrototypeOf(u)),c(new d,b)}}},{}],7:[function(o,a){function c(k){console&&console.warn&&console.warn(k)}function u(){u.init.call(this)}function p(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function b(k){return k._maxListeners===void 0?u.defaultMaxListeners:k._maxListeners}function h(k,T,F,j){var W,q,X;if(p(F),q=k._events,q===void 0?(q=k._events=Object.create(null),k._eventsCount=0):(q.newListener!==void 0&&(k.emit("newListener",T,F.listener?F.listener:F),q=k._events),X=q[T]),X===void 0)X=q[T]=F,++k._eventsCount;else if(typeof X=="function"?X=q[T]=j?[F,X]:[X,F]:j?X.unshift(F):X.push(F),W=b(k),0<W&&X.length>W&&!X.warned){X.warned=!0;var ie=new Error("Possible EventEmitter memory leak detected. "+X.length+" "+(T+" listeners added. Use emitter.setMaxListeners() to increase limit"));ie.name="MaxListenersExceededWarning",ie.emitter=k,ie.type=T,ie.count=X.length,c(ie)}return k}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(k,T,F){var j={fired:!1,wrapFn:void 0,target:k,type:T,listener:F},W=d.bind(j);return W.listener=F,j.wrapFn=W,W}function y(k,T,F){var j=k._events;if(j===void 0)return[];var W=j[T];return W===void 0?[]:typeof W=="function"?F?[W.listener||W]:[W]:F?M(W):N(W,W.length)}function S(k){var T=this._events;if(T!==void 0){var F=T[k];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function N(k,T){for(var F=Array(T),j=0;j<T;++j)F[j]=k[j];return F}function I(k,T){for(;T+1<k.length;T++)k[T]=k[T+1];k.pop()}function M(k){for(var T=Array(k.length),F=0;F<T.length;++F)T[F]=k[F].listener||k[F];return T}function m(k,T,F){typeof k.on=="function"&&_(k,"error",T,F)}function _(k,T,F,j){if(typeof k.on=="function")j.once?k.once(T,F):k.on(T,F);else if(typeof k.addEventListener=="function")k.addEventListener(T,function W(q){j.once&&k.removeEventListener(T,W),F(q)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}var v,A=typeof Reflect=="object"?Reflect:null,E=A&&typeof A.apply=="function"?A.apply:function(k,T,F){return Function.prototype.apply.call(k,T,F)};v=A&&typeof A.ownKeys=="function"?A.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var D=Number.isNaN||function(k){return k!==k};a.exports=u,a.exports.once=function(k,T){return new Promise(function(F,j){function W(X){k.removeListener(T,q),j(X)}function q(){typeof k.removeListener=="function"&&k.removeListener("error",W),F([].slice.call(arguments))}_(k,T,q,{once:!0}),T!=="error"&&m(k,W,{once:!0})})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var U=10;Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(k){if(typeof k!="number"||0>k||D(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");U=k}}),u.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(k){if(typeof k!="number"||0>k||D(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},u.prototype.getMaxListeners=function(){return b(this)},u.prototype.emit=function(k){for(var T=[],F=1;F<arguments.length;F++)T.push(arguments[F]);var j=k==="error",W=this._events;if(W!==void 0)j=j&&W.error===void 0;else if(!j)return!1;if(j){var q;if(0<T.length&&(q=T[0]),q instanceof Error)throw q;var X=new Error("Unhandled error."+(q?" ("+q.message+")":""));throw X.context=q,X}var ie=W[k];if(ie===void 0)return!1;if(typeof ie=="function")E(ie,this,T);else for(var pe=ie.length,V=N(ie,pe),F=0;F<pe;++F)E(V[F],this,T);return!0},u.prototype.addListener=function(k,T){return h(this,k,T,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(k,T){return h(this,k,T,!0)},u.prototype.once=function(k,T){return p(T),this.on(k,g(this,k,T)),this},u.prototype.prependOnceListener=function(k,T){return p(T),this.prependListener(k,g(this,k,T)),this},u.prototype.removeListener=function(k,T){var F,j,W,q,X;if(p(T),j=this._events,j===void 0)return this;if(F=j[k],F===void 0)return this;if(F===T||F.listener===T)--this._eventsCount==0?this._events=Object.create(null):(delete j[k],j.removeListener&&this.emit("removeListener",k,F.listener||T));else if(typeof F!="function"){for(W=-1,q=F.length-1;0<=q;q--)if(F[q]===T||F[q].listener===T){X=F[q].listener,W=q;break}if(0>W)return this;W===0?F.shift():I(F,W),F.length===1&&(j[k]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",k,X||T)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(k){var T,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[k]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[k]),this;if(arguments.length===0){var W,q=Object.keys(F);for(j=0;j<q.length;++j)W=q[j],W!=="removeListener"&&this.removeAllListeners(W);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=F[k],typeof T=="function")this.removeListener(k,T);else if(T!==void 0)for(j=T.length-1;0<=j;j--)this.removeListener(k,T[j]);return this},u.prototype.listeners=function(k){return y(this,k,!0)},u.prototype.rawListeners=function(k){return y(this,k,!1)},u.listenerCount=function(k,T){return typeof k.listenerCount=="function"?k.listenerCount(T):S.call(k,T)},u.prototype.listenerCount=S,u.prototype.eventNames=function(){return 0<this._eventsCount?v(this._events):[]}},{}],8:[function(o,a){a.exports=function(){if(typeof globalThis>"u")return null;var c={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return c.RTCPeerConnection?c:null}},{}],9:[function(o,a,c){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */c.read=function(u,p,b,h,d){var g,y,S=8*d-h-1,N=(1<<S)-1,I=N>>1,M=-7,m=b?d-1:0,_=b?-1:1,v=u[p+m];for(m+=_,g=v&(1<<-M)-1,v>>=-M,M+=S;0<M;g=256*g+u[p+m],m+=_,M-=8);for(y=g&(1<<-M)-1,g>>=-M,M+=h;0<M;y=256*y+u[p+m],m+=_,M-=8);if(g===0)g=1-I;else{if(g===N)return y?NaN:(v?-1:1)*(1/0);y+=i(2,h),g-=I}return(v?-1:1)*y*i(2,g-h)},c.write=function(u,p,b,h,d,g){var y,S,N,I=Math.LN2,M=Math.log,m=8*g-d-1,_=(1<<m)-1,v=_>>1,A=d===23?i(2,-24)-i(2,-77):0,E=h?0:g-1,D=h?1:-1,U=0>p||p===0&&0>1/p?1:0;for(p=r(p),isNaN(p)||p===1/0?(S=isNaN(p)?1:0,y=_):(y=n(M(p)/I),1>p*(N=i(2,-y))&&(y--,N*=2),p+=1<=y+v?A/N:A*i(2,1-v),2<=p*N&&(y++,N/=2),y+v>=_?(S=0,y=_):1<=y+v?(S=(p*N-1)*i(2,d),y+=v):(S=p*i(2,v-1)*i(2,d),y=0));8<=d;u[b+E]=255&S,E+=D,S/=256,d-=8);for(y=y<<d|S,m+=d;0<m;u[b+E]=255&y,E+=D,y/=256,m-=8);u[b+E-D]|=128*U}},{}],10:[function(o,a){a.exports=typeof Object.create=="function"?function(c,u){u&&(c.super_=u,c.prototype=Object.create(u.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:function(c,u){if(u){c.super_=u;var p=function(){};p.prototype=u.prototype,c.prototype=new p,c.prototype.constructor=c}}},{}],11:[function(o,a){var c=Math.round;function u(d){if(d+="",!(100<d.length)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(g){var y=parseFloat(g[1]),S=(g[2]||"ms").toLowerCase();return S==="years"||S==="year"||S==="yrs"||S==="yr"||S==="y"?315576e5*y:S==="weeks"||S==="week"||S==="w"?6048e5*y:S==="days"||S==="day"||S==="d"?864e5*y:S==="hours"||S==="hour"||S==="hrs"||S==="hr"||S==="h"?36e5*y:S==="minutes"||S==="minute"||S==="mins"||S==="min"||S==="m"?6e4*y:S==="seconds"||S==="second"||S==="secs"||S==="sec"||S==="s"?1e3*y:S==="milliseconds"||S==="millisecond"||S==="msecs"||S==="msec"||S==="ms"?y:void 0}}}function p(d){var g=r(d);return 864e5<=g?c(d/864e5)+"d":36e5<=g?c(d/36e5)+"h":6e4<=g?c(d/6e4)+"m":1e3<=g?c(d/1e3)+"s":d+"ms"}function b(d){var g=r(d);return 864e5<=g?h(d,g,864e5,"day"):36e5<=g?h(d,g,36e5,"hour"):6e4<=g?h(d,g,6e4,"minute"):1e3<=g?h(d,g,1e3,"second"):d+" ms"}function h(d,g,y,S){return c(d/y)+" "+S+(g>=1.5*y?"s":"")}a.exports=function(d,g){g=g||{};var y=typeof d;if(y=="string"&&0<d.length)return u(d);if(y==="number"&&isFinite(d))return g.long?b(d):p(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],12:[function(o,a){function c(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function p(A){if(S===setTimeout)return setTimeout(A,0);if((S===c||!S)&&setTimeout)return S=setTimeout,setTimeout(A,0);try{return S(A,0)}catch{try{return S.call(null,A,0)}catch{return S.call(this,A,0)}}}function b(A){if(N===clearTimeout)return clearTimeout(A);if((N===u||!N)&&clearTimeout)return N=clearTimeout,clearTimeout(A);try{return N(A)}catch{try{return N.call(null,A)}catch{return N.call(this,A)}}}function h(){_&&M&&(_=!1,M.length?m=M.concat(m):v=-1,m.length&&d())}function d(){if(!_){var A=p(h);_=!0;for(var E=m.length;E;){for(M=m,m=[];++v<E;)M&&M[v].run();v=-1,E=m.length}M=null,_=!1,b(A)}}function g(A,E){this.fun=A,this.array=E}function y(){}var S,N,I=a.exports={};(function(){try{S=typeof setTimeout=="function"?setTimeout:c}catch{S=c}try{N=typeof clearTimeout=="function"?clearTimeout:u}catch{N=u}})();var M,m=[],_=!1,v=-1;I.nextTick=function(A){var E=Array(arguments.length-1);if(1<arguments.length)for(var D=1;D<arguments.length;D++)E[D-1]=arguments[D];m.push(new g(A,E)),m.length!==1||_||p(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},I.title="browser",I.browser=!0,I.env={},I.argv=[],I.version="",I.versions={},I.on=y,I.addListener=y,I.once=y,I.off=y,I.removeListener=y,I.removeAllListeners=y,I.emit=y,I.prependListener=y,I.prependOnceListener=y,I.listeners=function(){return[]},I.binding=function(){throw new Error("process.binding is not supported")},I.cwd=function(){return"/"},I.chdir=function(){throw new Error("process.chdir is not supported")},I.umask=function(){return 0}},{}],13:[function(o,a){(function(c){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let u;a.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?c:window):p=>(u||(u=Promise.resolve())).then(p).catch(b=>setTimeout(()=>{throw b},0))}).call(this)}).call(this,typeof xe>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:xe)},{}],14:[function(o,a){(function(c,u){(function(){var p=o("safe-buffer").Buffer,b=u.crypto||u.msCrypto;a.exports=b&&b.getRandomValues?function(h,d){if(h>4294967295)throw new RangeError("requested too many random bytes");var g=p.allocUnsafe(h);if(0<h)if(65536<h)for(var y=0;y<h;y+=65536)b.getRandomValues(g.slice(y,y+65536));else b.getRandomValues(g);return typeof d=="function"?c.nextTick(function(){d(null,g)}):g}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof xe>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:xe)},{_process:12,"safe-buffer":30}],15:[function(o,a){function c(y,S){y.prototype=Object.create(S.prototype),y.prototype.constructor=y,y.__proto__=S}function u(y,S,N){function I(m,_,v){return typeof S=="string"?S:S(m,_,v)}N||(N=Error);var M=function(m){function _(v,A,E){return m.call(this,I(v,A,E))||this}return c(_,m),_}(N);M.prototype.name=N.name,M.prototype.code=y,g[y]=M}function p(y,S){if(Array.isArray(y)){var N=y.length;return y=y.map(function(I){return I+""}),2<N?"one of ".concat(S," ").concat(y.slice(0,N-1).join(", "),", or ")+y[N-1]:N===2?"one of ".concat(S," ").concat(y[0]," or ").concat(y[1]):"of ".concat(S," ").concat(y[0])}return"of ".concat(S," ").concat(y+"")}function b(y,S,N){return y.substr(0,S.length)===S}function h(y,S,N){return(N===void 0||N>y.length)&&(N=y.length),y.substring(N-S.length,N)===S}function d(y,S,N){return typeof N!="number"&&(N=0),!(N+S.length>y.length)&&y.indexOf(S,N)!==-1}var g={};u("ERR_INVALID_OPT_VALUE",function(y,S){return'The value "'+S+'" is invalid for option "'+y+'"'},TypeError),u("ERR_INVALID_ARG_TYPE",function(y,S,N){var I;typeof S=="string"&&b(S,"not ")?(I="must not be",S=S.replace(/^not /,"")):I="must be";var M;if(h(y," argument"))M="The ".concat(y," ").concat(I," ").concat(p(S,"type"));else{var m=d(y,".")?"property":"argument";M='The "'.concat(y,'" ').concat(m," ").concat(I," ").concat(p(S,"type"))}return M+=". Received type ".concat(typeof N),M},TypeError),u("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),u("ERR_METHOD_NOT_IMPLEMENTED",function(y){return"The "+y+" method is not implemented"}),u("ERR_STREAM_PREMATURE_CLOSE","Premature close"),u("ERR_STREAM_DESTROYED",function(y){return"Cannot call "+y+" after a stream was destroyed"}),u("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),u("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),u("ERR_STREAM_WRITE_AFTER_END","write after end"),u("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),u("ERR_UNKNOWN_ENCODING",function(y){return"Unknown encoding: "+y},TypeError),u("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),a.exports.codes=g},{}],16:[function(o,a){(function(c){(function(){function u(I){return this instanceof u?(d.call(this,I),g.call(this,I),this.allowHalfOpen=!0,void(I&&(I.readable===!1&&(this.readable=!1),I.writable===!1&&(this.writable=!1),I.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",p))))):new u(I)}function p(){this._writableState.ended||c.nextTick(b,this)}function b(I){I.end()}var h=Object.keys||function(I){var M=[];for(var m in I)M.push(m);return M};a.exports=u;var d=o("./_stream_readable"),g=o("./_stream_writable");o("inherits")(u,d);for(var y,S=h(g.prototype),N=0;N<S.length;N++)y=S[N],u.prototype[y]||(u.prototype[y]=g.prototype[y]);Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(I){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=I,this._writableState.destroyed=I)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,a){function c(p){return this instanceof c?void u.call(this,p):new c(p)}a.exports=c;var u=o("./_stream_transform");o("inherits")(c,u),c.prototype._transform=function(p,b,h){h(null,p)}},{"./_stream_transform":19,inherits:10}],18:[function(o,a){(function(c,u){(function(){function p(w){return Ze.from(w)}function b(w){return Ze.isBuffer(w)||w instanceof ne}function h(w,s,l){return typeof w.prependListener=="function"?w.prependListener(s,l):void(w._events&&w._events[s]?Array.isArray(w._events[s])?w._events[s].unshift(l):w._events[s]=[l,w._events[s]]:w.on(s,l))}function d(w,s,l){pe=pe||o("./_stream_duplex"),w=w||{},typeof l!="boolean"&&(l=s instanceof pe),this.objectMode=!!w.objectMode,l&&(this.objectMode=this.objectMode||!!w.readableObjectMode),this.highWaterMark=Kt(this,w,"readableHighWaterMark",l),this.buffer=new Jt,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=w.emitClose!==!1,this.autoDestroy=!!w.autoDestroy,this.destroyed=!1,this.defaultEncoding=w.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,w.encoding&&(!Ee&&(Ee=o("string_decoder/").StringDecoder),this.decoder=new Ee(w.encoding),this.encoding=w.encoding)}function g(w){if(pe=pe||o("./_stream_duplex"),!(this instanceof g))return new g(w);var s=this instanceof pe;this._readableState=new d(w,this,s),this.readable=!0,w&&(typeof w.read=="function"&&(this._read=w.read),typeof w.destroy=="function"&&(this._destroy=w.destroy)),Ce.call(this)}function y(w,s,l,f,C){V("readableAddChunk",s);var R=w._readableState;if(s===null)R.reading=!1,m(w,R);else{var L;if(C||(L=N(R,s)),L)P(w,L);else if(!(R.objectMode||s&&0<s.length))f||(R.reading=!1,A(w,R));else if(typeof s=="string"||R.objectMode||Object.getPrototypeOf(s)===Ze.prototype||(s=p(s)),f)R.endEmitted?P(w,new x):S(w,R,s,!0);else if(R.ended)P(w,new Re);else{if(R.destroyed)return!1;R.reading=!1,R.decoder&&!l?(s=R.decoder.write(s),R.objectMode||s.length!==0?S(w,R,s,!1):A(w,R)):S(w,R,s,!1)}}return!R.ended&&(R.length<R.highWaterMark||R.length===0)}function S(w,s,l,f){s.flowing&&s.length===0&&!s.sync?(s.awaitDrain=0,w.emit("data",l)):(s.length+=s.objectMode?1:l.length,f?s.buffer.unshift(l):s.buffer.push(l),s.needReadable&&_(w)),A(w,s)}function N(w,s){var l;return b(s)||typeof s=="string"||s===void 0||w.objectMode||(l=new ke("chunk",["string","Buffer","Uint8Array"],s)),l}function I(w){return 1073741824<=w?w=1073741824:(w--,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,w|=w>>>16,w++),w}function M(w,s){return 0>=w||s.length===0&&s.ended?0:s.objectMode?1:w===w?(w>s.highWaterMark&&(s.highWaterMark=I(w)),w<=s.length?w:s.ended?s.length:(s.needReadable=!0,0)):s.flowing&&s.length?s.buffer.head.data.length:s.length}function m(w,s){if(V("onEofChunk"),!s.ended){if(s.decoder){var l=s.decoder.end();l&&l.length&&(s.buffer.push(l),s.length+=s.objectMode?1:l.length)}s.ended=!0,s.sync?_(w):(s.needReadable=!1,!s.emittedReadable&&(s.emittedReadable=!0,v(w)))}}function _(w){var s=w._readableState;V("emitReadable",s.needReadable,s.emittedReadable),s.needReadable=!1,s.emittedReadable||(V("emitReadable",s.flowing),s.emittedReadable=!0,c.nextTick(v,w))}function v(w){var s=w._readableState;V("emitReadable_",s.destroyed,s.length,s.ended),!s.destroyed&&(s.length||s.ended)&&(w.emit("readable"),s.emittedReadable=!1),s.needReadable=!s.flowing&&!s.ended&&s.length<=s.highWaterMark,j(w)}function A(w,s){s.readingMore||(s.readingMore=!0,c.nextTick(E,w,s))}function E(w,s){for(;!s.reading&&!s.ended&&(s.length<s.highWaterMark||s.flowing&&s.length===0);){var l=s.length;if(V("maybeReadMore read 0"),w.read(0),l===s.length)break}s.readingMore=!1}function D(w){return function(){var s=w._readableState;V("pipeOnDrain",s.awaitDrain),s.awaitDrain&&s.awaitDrain--,s.awaitDrain===0&&Rt(w,"data")&&(s.flowing=!0,j(w))}}function U(w){var s=w._readableState;s.readableListening=0<w.listenerCount("readable"),s.resumeScheduled&&!s.paused?s.flowing=!0:0<w.listenerCount("data")&&w.resume()}function k(w){V("readable nexttick read 0"),w.read(0)}function T(w,s){s.resumeScheduled||(s.resumeScheduled=!0,c.nextTick(F,w,s))}function F(w,s){V("resume",s.reading),s.reading||w.read(0),s.resumeScheduled=!1,w.emit("resume"),j(w),s.flowing&&!s.reading&&w.read(0)}function j(w){var s=w._readableState;for(V("flow",s.flowing);s.flowing&&w.read()!==null;);}function W(w,s){if(s.length===0)return null;var l;return s.objectMode?l=s.buffer.shift():!w||w>=s.length?(l=s.decoder?s.buffer.join(""):s.buffer.length===1?s.buffer.first():s.buffer.concat(s.length),s.buffer.clear()):l=s.buffer.consume(w,s.decoder),l}function q(w){var s=w._readableState;V("endReadable",s.endEmitted),s.endEmitted||(s.ended=!0,c.nextTick(X,s,w))}function X(w,s){if(V("endReadableNT",w.endEmitted,w.length),!w.endEmitted&&w.length===0&&(w.endEmitted=!0,s.readable=!1,s.emit("end"),w.autoDestroy)){var l=s._writableState;(!l||l.autoDestroy&&l.finished)&&s.destroy()}}function ie(w,s){for(var l=0,f=w.length;l<f;l++)if(w[l]===s)return l;return-1}a.exports=g;var pe;g.ReadableState=d;var V;o("events").EventEmitter;var Rt=function(w,s){return w.listeners(s).length},Ce=o("./internal/streams/stream"),Ze=o("buffer").Buffer,ne=u.Uint8Array||function(){},Z=o("util");V=Z&&Z.debuglog?Z.debuglog("stream"):function(){};var Ee,Qe,et,Jt=o("./internal/streams/buffer_list"),ut=o("./internal/streams/destroy"),ht=o("./internal/streams/state"),Kt=ht.getHighWaterMark,tt=o("../errors").codes,ke=tt.ERR_INVALID_ARG_TYPE,Re=tt.ERR_STREAM_PUSH_AFTER_EOF,O=tt.ERR_METHOD_NOT_IMPLEMENTED,x=tt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(g,Ce);var P=ut.errorOrDestroy,$=["error","close","destroy","pause","resume"];Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),g.prototype.destroy=ut.destroy,g.prototype._undestroy=ut.undestroy,g.prototype._destroy=function(w,s){s(w)},g.prototype.push=function(w,s){var l,f=this._readableState;return f.objectMode?l=!0:typeof w=="string"&&(s=s||f.defaultEncoding,s!==f.encoding&&(w=Ze.from(w,s),s=""),l=!0),y(this,w,s,!1,l)},g.prototype.unshift=function(w){return y(this,w,null,!0,!1)},g.prototype.isPaused=function(){return this._readableState.flowing===!1},g.prototype.setEncoding=function(w){Ee||(Ee=o("string_decoder/").StringDecoder);var s=new Ee(w);this._readableState.decoder=s,this._readableState.encoding=this._readableState.decoder.encoding;for(var l=this._readableState.buffer.head,f="";l!==null;)f+=s.write(l.data),l=l.next;return this._readableState.buffer.clear(),f!==""&&this._readableState.buffer.push(f),this._readableState.length=f.length,this},g.prototype.read=function(w){V("read",w),w=parseInt(w,10);var s=this._readableState,l=w;if(w!==0&&(s.emittedReadable=!1),w===0&&s.needReadable&&((s.highWaterMark===0?0<s.length:s.length>=s.highWaterMark)||s.ended))return V("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?q(this):_(this),null;if(w=M(w,s),w===0&&s.ended)return s.length===0&&q(this),null;var f=s.needReadable;V("need readable",f),(s.length===0||s.length-w<s.highWaterMark)&&(f=!0,V("length less than watermark",f)),s.ended||s.reading?(f=!1,V("reading or ended",f)):f&&(V("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0),this._read(s.highWaterMark),s.sync=!1,!s.reading&&(w=M(l,s)));var C;return C=0<w?W(w,s):null,C===null?(s.needReadable=s.length<=s.highWaterMark,w=0):(s.length-=w,s.awaitDrain=0),s.length===0&&(!s.ended&&(s.needReadable=!0),l!==w&&s.ended&&q(this)),C!==null&&this.emit("data",C),C},g.prototype._read=function(){P(this,new O("_read()"))},g.prototype.pipe=function(w,s){function l(Tt,Ot){V("onunpipe"),Tt===G&&Ot&&Ot.hasUnpiped===!1&&(Ot.hasUnpiped=!0,C())}function f(){V("onend"),w.end()}function C(){V("cleanup"),w.removeListener("close",B),w.removeListener("finish",Y),w.removeListener("drain",At),w.removeListener("error",L),w.removeListener("unpipe",l),G.removeListener("end",f),G.removeListener("end",ee),G.removeListener("data",R),Xt=!0,z.awaitDrain&&(!w._writableState||w._writableState.needDrain)&&At()}function R(Tt){V("ondata");var Ot=w.write(Tt);V("dest.write",Ot),Ot===!1&&((z.pipesCount===1&&z.pipes===w||1<z.pipesCount&&ie(z.pipes,w)!==-1)&&!Xt&&(V("false write response, pause",z.awaitDrain),z.awaitDrain++),G.pause())}function L(Tt){V("onerror",Tt),ee(),w.removeListener("error",L),Rt(w,"error")===0&&P(w,Tt)}function B(){w.removeListener("finish",Y),ee()}function Y(){V("onfinish"),w.removeListener("close",B),ee()}function ee(){V("unpipe"),G.unpipe(w)}var G=this,z=this._readableState;switch(z.pipesCount){case 0:z.pipes=w;break;case 1:z.pipes=[z.pipes,w];break;default:z.pipes.push(w)}z.pipesCount+=1,V("pipe count=%d opts=%j",z.pipesCount,s);var de=(!s||s.end!==!1)&&w!==c.stdout&&w!==c.stderr,ft=de?f:ee;z.endEmitted?c.nextTick(ft):G.once("end",ft),w.on("unpipe",l);var At=D(G);w.on("drain",At);var Xt=!1;return G.on("data",R),h(w,"error",L),w.once("close",B),w.once("finish",Y),w.emit("pipe",G),z.flowing||(V("pipe resume"),G.resume()),w},g.prototype.unpipe=function(w){var s=this._readableState,l={hasUnpiped:!1};if(s.pipesCount===0)return this;if(s.pipesCount===1)return w&&w!==s.pipes?this:(w||(w=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,w&&w.emit("unpipe",this,l),this);if(!w){var f=s.pipes,C=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var R=0;R<C;R++)f[R].emit("unpipe",this,{hasUnpiped:!1});return this}var L=ie(s.pipes,w);return L===-1?this:(s.pipes.splice(L,1),s.pipesCount-=1,s.pipesCount===1&&(s.pipes=s.pipes[0]),w.emit("unpipe",this,l),this)},g.prototype.on=function(w,s){var l=Ce.prototype.on.call(this,w,s),f=this._readableState;return w==="data"?(f.readableListening=0<this.listenerCount("readable"),f.flowing!==!1&&this.resume()):w=="readable"&&!f.endEmitted&&!f.readableListening&&(f.readableListening=f.needReadable=!0,f.flowing=!1,f.emittedReadable=!1,V("on readable",f.length,f.reading),f.length?_(this):!f.reading&&c.nextTick(k,this)),l},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(w,s){var l=Ce.prototype.removeListener.call(this,w,s);return w==="readable"&&c.nextTick(U,this),l},g.prototype.removeAllListeners=function(w){var s=Ce.prototype.removeAllListeners.apply(this,arguments);return(w==="readable"||w===void 0)&&c.nextTick(U,this),s},g.prototype.resume=function(){var w=this._readableState;return w.flowing||(V("resume"),w.flowing=!w.readableListening,T(this,w)),w.paused=!1,this},g.prototype.pause=function(){return V("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(V("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},g.prototype.wrap=function(w){var s=this,l=this._readableState,f=!1;for(var C in w.on("end",function(){if(V("wrapped end"),l.decoder&&!l.ended){var L=l.decoder.end();L&&L.length&&s.push(L)}s.push(null)}),w.on("data",function(L){if(V("wrapped data"),l.decoder&&(L=l.decoder.write(L)),!(l.objectMode&&L==null)&&(l.objectMode||L&&L.length)){var B=s.push(L);B||(f=!0,w.pause())}}),w)this[C]===void 0&&typeof w[C]=="function"&&(this[C]=function(L){return function(){return w[L].apply(w,arguments)}}(C));for(var R=0;R<$.length;R++)w.on($[R],this.emit.bind(this,$[R]));return this._read=function(L){V("wrapped _read",L),f&&(f=!1,w.resume())},this},typeof Symbol=="function"&&(g.prototype[Symbol.asyncIterator]=function(){return Qe===void 0&&(Qe=o("./internal/streams/async_iterator")),Qe(this)}),Object.defineProperty(g.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(g.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(g.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),g._fromList=W,Object.defineProperty(g.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(g.from=function(w,s){return et===void 0&&(et=o("./internal/streams/from")),et(g,w,s)})}).call(this)}).call(this,o("_process"),typeof xe>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:xe)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,a){function c(I,M){var m=this._transformState;m.transforming=!1;var _=m.writecb;if(_===null)return this.emit("error",new g);m.writechunk=null,m.writecb=null,M!=null&&this.push(M),_(I);var v=this._readableState;v.reading=!1,(v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}function u(I){return this instanceof u?(N.call(this,I),this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,I&&(typeof I.transform=="function"&&(this._transform=I.transform),typeof I.flush=="function"&&(this._flush=I.flush)),void this.on("prefinish",p)):new u(I)}function p(){var I=this;typeof this._flush!="function"||this._readableState.destroyed?b(this,null,null):this._flush(function(M,m){b(I,M,m)})}function b(I,M,m){if(M)return I.emit("error",M);if(m!=null&&I.push(m),I._writableState.length)throw new S;if(I._transformState.transforming)throw new y;return I.push(null)}a.exports=u;var h=o("../errors").codes,d=h.ERR_METHOD_NOT_IMPLEMENTED,g=h.ERR_MULTIPLE_CALLBACK,y=h.ERR_TRANSFORM_ALREADY_TRANSFORMING,S=h.ERR_TRANSFORM_WITH_LENGTH_0,N=o("./_stream_duplex");o("inherits")(u,N),u.prototype.push=function(I,M){return this._transformState.needTransform=!1,N.prototype.push.call(this,I,M)},u.prototype._transform=function(I,M,m){m(new d("_transform()"))},u.prototype._write=function(I,M,m){var _=this._transformState;if(_.writecb=m,_.writechunk=I,_.writeencoding=M,!_.transforming){var v=this._readableState;(_.needTransform||v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}},u.prototype._read=function(){var I=this._transformState;I.writechunk===null||I.transforming?I.needTransform=!0:(I.transforming=!0,this._transform(I.writechunk,I.writeencoding,I.afterTransform))},u.prototype._destroy=function(I,M){N.prototype._destroy.call(this,I,function(m){M(m)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,a){(function(c,u){(function(){function p(O){var x=this;this.next=null,this.entry=null,this.finish=function(){q(x,O)}}function b(O){return V.from(O)}function h(O){return V.isBuffer(O)||O instanceof Rt}function d(){}function g(O,x,P){X=X||o("./_stream_duplex"),O=O||{},typeof P!="boolean"&&(P=x instanceof X),this.objectMode=!!O.objectMode,P&&(this.objectMode=this.objectMode||!!O.writableObjectMode),this.highWaterMark=ne(this,O,"writableHighWaterMark",P),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var $=O.decodeStrings===!1;this.decodeStrings=!$,this.defaultEncoding=O.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(w){A(x,w)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=O.emitClose!==!1,this.autoDestroy=!!O.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new p(this)}function y(O){X=X||o("./_stream_duplex");var x=this instanceof X;return x||Re.call(y,this)?(this._writableState=new g(O,this,x),this.writable=!0,O&&(typeof O.write=="function"&&(this._write=O.write),typeof O.writev=="function"&&(this._writev=O.writev),typeof O.destroy=="function"&&(this._destroy=O.destroy),typeof O.final=="function"&&(this._final=O.final)),void pe.call(this)):new y(O)}function S(O,x){var P=new Kt;ke(O,P),c.nextTick(x,P)}function N(O,x,P,$){var w;return P===null?w=new ht:typeof P!="string"&&!x.objectMode&&(w=new Ee("chunk",["string","Buffer"],P)),!w||(ke(O,w),c.nextTick($,w),!1)}function I(O,x,P){return O.objectMode||O.decodeStrings===!1||typeof x!="string"||(x=V.from(x,P)),x}function M(O,x,P,$,w,s){if(!P){var l=I(x,$,w);$!==l&&(P=!0,w="buffer",$=l)}var f=x.objectMode?1:$.length;x.length+=f;var C=x.length<x.highWaterMark;if(C||(x.needDrain=!0),x.writing||x.corked){var R=x.lastBufferedRequest;x.lastBufferedRequest={chunk:$,encoding:w,isBuf:P,callback:s,next:null},R?R.next=x.lastBufferedRequest:x.bufferedRequest=x.lastBufferedRequest,x.bufferedRequestCount+=1}else m(O,x,!1,f,$,w,s);return C}function m(O,x,P,$,w,s,l){x.writelen=$,x.writecb=l,x.writing=!0,x.sync=!0,x.destroyed?x.onwrite(new ut("write")):P?O._writev(w,x.onwrite):O._write(w,s,x.onwrite),x.sync=!1}function _(O,x,P,$,w){--x.pendingcb,P?(c.nextTick(w,$),c.nextTick(j,O,x),O._writableState.errorEmitted=!0,ke(O,$)):(w($),O._writableState.errorEmitted=!0,ke(O,$),j(O,x))}function v(O){O.writing=!1,O.writecb=null,O.length-=O.writelen,O.writelen=0}function A(O,x){var P=O._writableState,$=P.sync,w=P.writecb;if(typeof w!="function")throw new et;if(v(P),x)_(O,P,$,x,w);else{var s=k(P)||O.destroyed;s||P.corked||P.bufferProcessing||!P.bufferedRequest||U(O,P),$?c.nextTick(E,O,P,s,w):E(O,P,s,w)}}function E(O,x,P,$){P||D(O,x),x.pendingcb--,$(),j(O,x)}function D(O,x){x.length===0&&x.needDrain&&(x.needDrain=!1,O.emit("drain"))}function U(O,x){x.bufferProcessing=!0;var P=x.bufferedRequest;if(O._writev&&P&&P.next){var $=x.bufferedRequestCount,w=Array($),s=x.corkedRequestsFree;s.entry=P;for(var l=0,f=!0;P;)w[l]=P,P.isBuf||(f=!1),P=P.next,l+=1;w.allBuffers=f,m(O,x,!0,x.length,w,"",s.finish),x.pendingcb++,x.lastBufferedRequest=null,s.next?(x.corkedRequestsFree=s.next,s.next=null):x.corkedRequestsFree=new p(x),x.bufferedRequestCount=0}else{for(;P;){var C=P.chunk,R=P.encoding,L=P.callback,B=x.objectMode?1:C.length;if(m(O,x,!1,B,C,R,L),P=P.next,x.bufferedRequestCount--,x.writing)break}P===null&&(x.lastBufferedRequest=null)}x.bufferedRequest=P,x.bufferProcessing=!1}function k(O){return O.ending&&O.length===0&&O.bufferedRequest===null&&!O.finished&&!O.writing}function T(O,x){O._final(function(P){x.pendingcb--,P&&ke(O,P),x.prefinished=!0,O.emit("prefinish"),j(O,x)})}function F(O,x){x.prefinished||x.finalCalled||(typeof O._final!="function"||x.destroyed?(x.prefinished=!0,O.emit("prefinish")):(x.pendingcb++,x.finalCalled=!0,c.nextTick(T,O,x)))}function j(O,x){var P=k(x);if(P&&(F(O,x),x.pendingcb===0&&(x.finished=!0,O.emit("finish"),x.autoDestroy))){var $=O._readableState;(!$||$.autoDestroy&&$.endEmitted)&&O.destroy()}return P}function W(O,x,P){x.ending=!0,j(O,x),P&&(x.finished?c.nextTick(P):O.once("finish",P)),x.ended=!0,O.writable=!1}function q(O,x,P){var $=O.entry;for(O.entry=null;$;){var w=$.callback;x.pendingcb--,w(P),$=$.next}x.corkedRequestsFree.next=O}a.exports=y;var X;y.WritableState=g;var ie={deprecate:o("util-deprecate")},pe=o("./internal/streams/stream"),V=o("buffer").Buffer,Rt=u.Uint8Array||function(){},Ce=o("./internal/streams/destroy"),Ze=o("./internal/streams/state"),ne=Ze.getHighWaterMark,Z=o("../errors").codes,Ee=Z.ERR_INVALID_ARG_TYPE,Qe=Z.ERR_METHOD_NOT_IMPLEMENTED,et=Z.ERR_MULTIPLE_CALLBACK,Jt=Z.ERR_STREAM_CANNOT_PIPE,ut=Z.ERR_STREAM_DESTROYED,ht=Z.ERR_STREAM_NULL_VALUES,Kt=Z.ERR_STREAM_WRITE_AFTER_END,tt=Z.ERR_UNKNOWN_ENCODING,ke=Ce.errorOrDestroy;o("inherits")(y,pe),g.prototype.getBuffer=function(){for(var O=this.bufferedRequest,x=[];O;)x.push(O),O=O.next;return x},function(){try{Object.defineProperty(g.prototype,"buffer",{get:ie.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Re;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Re=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(O){return!!Re.call(this,O)||this===y&&O&&O._writableState instanceof g}})):Re=function(O){return O instanceof this},y.prototype.pipe=function(){ke(this,new Jt)},y.prototype.write=function(O,x,P){var $=this._writableState,w=!1,s=!$.objectMode&&h(O);return s&&!V.isBuffer(O)&&(O=b(O)),typeof x=="function"&&(P=x,x=null),s?x="buffer":!x&&(x=$.defaultEncoding),typeof P!="function"&&(P=d),$.ending?S(this,P):(s||N(this,$,O,P))&&($.pendingcb++,w=M(this,$,s,O,x,P)),w},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var O=this._writableState;O.corked&&(O.corked--,!O.writing&&!O.corked&&!O.bufferProcessing&&O.bufferedRequest&&U(this,O))},y.prototype.setDefaultEncoding=function(O){if(typeof O=="string"&&(O=O.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((O+"").toLowerCase())))throw new tt(O);return this._writableState.defaultEncoding=O,this},Object.defineProperty(y.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(O,x,P){P(new Qe("_write()"))},y.prototype._writev=null,y.prototype.end=function(O,x,P){var $=this._writableState;return typeof O=="function"?(P=O,O=null,x=null):typeof x=="function"&&(P=x,x=null),O!=null&&this.write(O,x),$.corked&&($.corked=1,this.uncork()),$.ending||W(this,$,P),this},Object.defineProperty(y.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(y.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(O){this._writableState&&(this._writableState.destroyed=O)}}),y.prototype.destroy=Ce.destroy,y.prototype._undestroy=Ce.undestroy,y.prototype._destroy=function(O,x){x(O)}}).call(this)}).call(this,o("_process"),typeof xe>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:xe)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,a){(function(c){(function(){function u(D,U,k){return U in D?Object.defineProperty(D,U,{value:k,enumerable:!0,configurable:!0,writable:!0}):D[U]=k,D}function p(D,U){return{value:D,done:U}}function b(D){var U=D[S];if(U!==null){var k=D[v].read();k!==null&&(D[m]=null,D[S]=null,D[N]=null,U(p(k,!1)))}}function h(D){c.nextTick(b,D)}function d(D,U){return function(k,T){D.then(function(){return U[M]?void k(p(void 0,!0)):void U[_](k,T)},T)}}var g,y=o("./end-of-stream"),S=Symbol("lastResolve"),N=Symbol("lastReject"),I=Symbol("error"),M=Symbol("ended"),m=Symbol("lastPromise"),_=Symbol("handlePromise"),v=Symbol("stream"),A=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((g={get stream(){return this[v]},next:function(){var D=this,U=this[I];if(U!==null)return Promise.reject(U);if(this[M])return Promise.resolve(p(void 0,!0));if(this[v].destroyed)return new Promise(function(j,W){c.nextTick(function(){D[I]?W(D[I]):j(p(void 0,!0))})});var k,T=this[m];if(T)k=new Promise(d(T,this));else{var F=this[v].read();if(F!==null)return Promise.resolve(p(F,!1));k=new Promise(this[_])}return this[m]=k,k}},u(g,Symbol.asyncIterator,function(){return this}),u(g,"return",function(){var D=this;return new Promise(function(U,k){D[v].destroy(null,function(T){return T?void k(T):void U(p(void 0,!0))})})}),g),A);a.exports=function(D){var U,k=Object.create(E,(U={},u(U,v,{value:D,writable:!0}),u(U,S,{value:null,writable:!0}),u(U,N,{value:null,writable:!0}),u(U,I,{value:null,writable:!0}),u(U,M,{value:D._readableState.endEmitted,writable:!0}),u(U,_,{value:function(T,F){var j=k[v].read();j?(k[m]=null,k[S]=null,k[N]=null,T(p(j,!1))):(k[S]=T,k[N]=F)},writable:!0}),U));return k[m]=null,y(D,function(T){if(T&&T.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=k[N];return F!==null&&(k[m]=null,k[S]=null,k[N]=null,F(T)),void(k[I]=T)}var j=k[S];j!==null&&(k[m]=null,k[S]=null,k[N]=null,j(p(void 0,!0))),k[M]=!0}),D.on("readable",h.bind(null,k)),k}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,a){function c(m,_){var v=Object.keys(m);if(Object.getOwnPropertySymbols){var A=Object.getOwnPropertySymbols(m);_&&(A=A.filter(function(E){return Object.getOwnPropertyDescriptor(m,E).enumerable})),v.push.apply(v,A)}return v}function u(m){for(var _,v=1;v<arguments.length;v++)_=arguments[v]==null?{}:arguments[v],v%2?c(Object(_),!0).forEach(function(A){p(m,A,_[A])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):c(Object(_)).forEach(function(A){Object.defineProperty(m,A,Object.getOwnPropertyDescriptor(_,A))});return m}function p(m,_,v){return _ in m?Object.defineProperty(m,_,{value:v,enumerable:!0,configurable:!0,writable:!0}):m[_]=v,m}function b(m,_){if(!(m instanceof _))throw new TypeError("Cannot call a class as a function")}function h(m,_){for(var v,A=0;A<_.length;A++)v=_[A],v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(m,v.key,v)}function d(m,_,v){return _&&h(m.prototype,_),m}function g(m,_,v){S.prototype.copy.call(m,_,v)}var y=o("buffer"),S=y.Buffer,N=o("util"),I=N.inspect,M=I&&I.custom||"inspect";a.exports=function(){function m(){b(this,m),this.head=null,this.tail=null,this.length=0}return d(m,[{key:"push",value:function(_){var v={data:_,next:null};0<this.length?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(_){var v={data:_,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var v=this.head,A=""+v.data;v=v.next;)A+=_+v.data;return A}},{key:"concat",value:function(_){if(this.length===0)return S.alloc(0);for(var v=S.allocUnsafe(_>>>0),A=this.head,E=0;A;)g(A.data,v,E),E+=A.data.length,A=A.next;return v}},{key:"consume",value:function(_,v){var A;return _<this.head.data.length?(A=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?A=this.shift():A=v?this._getString(_):this._getBuffer(_),A}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var v=this.head,A=1,E=v.data;for(_-=E.length;v=v.next;){var D=v.data,U=_>D.length?D.length:_;if(E+=U===D.length?D:D.slice(0,_),_-=U,_===0){U===D.length?(++A,this.head=v.next?v.next:this.tail=null):(this.head=v,v.data=D.slice(U));break}++A}return this.length-=A,E}},{key:"_getBuffer",value:function(_){var v=S.allocUnsafe(_),A=this.head,E=1;for(A.data.copy(v),_-=A.data.length;A=A.next;){var D=A.data,U=_>D.length?D.length:_;if(D.copy(v,v.length-_,0,U),_-=U,_===0){U===D.length?(++E,this.head=A.next?A.next:this.tail=null):(this.head=A,A.data=D.slice(U));break}++E}return this.length-=E,v}},{key:M,value:function(_,v){return I(this,u({},v,{depth:0,customInspect:!1}))}}]),m}()},{buffer:3,util:2}],23:[function(o,a){(function(c){(function(){function u(h,d){b(h,d),p(h)}function p(h){h._writableState&&!h._writableState.emitClose||h._readableState&&!h._readableState.emitClose||h.emit("close")}function b(h,d){h.emit("error",d)}a.exports={destroy:function(h,d){var g=this,y=this._readableState&&this._readableState.destroyed,S=this._writableState&&this._writableState.destroyed;return y||S?(d?d(h):h&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,c.nextTick(b,this,h)):c.nextTick(b,this,h)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,function(N){!d&&N?g._writableState?g._writableState.errorEmitted?c.nextTick(p,g):(g._writableState.errorEmitted=!0,c.nextTick(u,g,N)):c.nextTick(u,g,N):d?(c.nextTick(p,g),d(N)):c.nextTick(p,g)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(h,d){var g=h._readableState,y=h._writableState;g&&g.autoDestroy||y&&y.autoDestroy?h.destroy(d):h.emit("error",d)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,a){function c(d){var g=!1;return function(){if(!g){g=!0;for(var y=arguments.length,S=Array(y),N=0;N<y;N++)S[N]=arguments[N];d.apply(this,S)}}}function u(){}function p(d){return d.setHeader&&typeof d.abort=="function"}function b(d,g,y){if(typeof g=="function")return b(d,null,g);g||(g={}),y=c(y||u);var S=g.readable||g.readable!==!1&&d.readable,N=g.writable||g.writable!==!1&&d.writable,I=function(){d.writable||m()},M=d._writableState&&d._writableState.finished,m=function(){N=!1,M=!0,S||y.call(d)},_=d._readableState&&d._readableState.endEmitted,v=function(){S=!1,_=!0,N||y.call(d)},A=function(U){y.call(d,U)},E=function(){var U;return S&&!_?(d._readableState&&d._readableState.ended||(U=new h),y.call(d,U)):N&&!M?(d._writableState&&d._writableState.ended||(U=new h),y.call(d,U)):void 0},D=function(){d.req.on("finish",m)};return p(d)?(d.on("complete",m),d.on("abort",E),d.req?D():d.on("request",D)):N&&!d._writableState&&(d.on("end",I),d.on("close",I)),d.on("end",v),d.on("finish",m),g.error!==!1&&d.on("error",A),d.on("close",E),function(){d.removeListener("complete",m),d.removeListener("abort",E),d.removeListener("request",D),d.req&&d.req.removeListener("finish",m),d.removeListener("end",I),d.removeListener("close",I),d.removeListener("finish",m),d.removeListener("end",v),d.removeListener("error",A),d.removeListener("close",E)}}var h=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;a.exports=b},{"../../../errors":15}],25:[function(o,a){a.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,a){function c(M){var m=!1;return function(){m||(m=!0,M.apply(void 0,arguments))}}function u(M){if(M)throw M}function p(M){return M.setHeader&&typeof M.abort=="function"}function b(M,m,_,v){v=c(v);var A=!1;M.on("close",function(){A=!0}),y===void 0&&(y=o("./end-of-stream")),y(M,{readable:m,writable:_},function(D){return D?v(D):(A=!0,void v())});var E=!1;return function(D){if(!A)return E?void 0:(E=!0,p(M)?M.abort():typeof M.destroy=="function"?M.destroy():void v(D||new I("pipe")))}}function h(M){M()}function d(M,m){return M.pipe(m)}function g(M){return M.length&&typeof M[M.length-1]=="function"?M.pop():u}var y,S=o("../../../errors").codes,N=S.ERR_MISSING_ARGS,I=S.ERR_STREAM_DESTROYED;a.exports=function(){for(var M=arguments.length,m=Array(M),_=0;_<M;_++)m[_]=arguments[_];var v=g(m);if(Array.isArray(m[0])&&(m=m[0]),2>m.length)throw new N("streams");var A,E=m.map(function(D,U){var k=U<m.length-1;return b(D,k,0<U,function(T){A||(A=T),T&&E.forEach(h),k||(E.forEach(h),v(A))})});return m.reduce(d)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,a){function c(p,b,h){return p.highWaterMark==null?b?p[h]:null:p.highWaterMark}var u=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;a.exports={getHighWaterMark:function(p,b,h,d){var g=c(b,d,h);if(g!=null){if(!(isFinite(g)&&n(g)===g)||0>g){var y=d?h:"highWaterMark";throw new u(y,g)}return n(g)}return p.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,a){a.exports=o("events").EventEmitter},{events:7}],29:[function(o,a,c){c=a.exports=o("./lib/_stream_readable.js"),c.Stream=c,c.Readable=c,c.Writable=o("./lib/_stream_writable.js"),c.Duplex=o("./lib/_stream_duplex.js"),c.Transform=o("./lib/_stream_transform.js"),c.PassThrough=o("./lib/_stream_passthrough.js"),c.finished=o("./lib/internal/streams/end-of-stream.js"),c.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,a,c){function u(d,g){for(var y in d)g[y]=d[y]}function p(d,g,y){return h(d,g,y)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var b=o("buffer"),h=b.Buffer;h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?a.exports=b:(u(b,c),c.Buffer=p),p.prototype=Object.create(h.prototype),u(h,p),p.from=function(d,g,y){if(typeof d=="number")throw new TypeError("Argument must not be a number");return h(d,g,y)},p.alloc=function(d,g,y){if(typeof d!="number")throw new TypeError("Argument must be a number");var S=h(d);return g===void 0?S.fill(0):typeof y=="string"?S.fill(g,y):S.fill(g),S},p.allocUnsafe=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return h(d)},p.allocUnsafeSlow=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return b.SlowBuffer(d)}},{buffer:3}],31:[function(o,a,c){function u(E){if(!E)return"utf8";for(var D;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(D)return;E=(""+E).toLowerCase(),D=!0}}function p(E){var D=u(E);if(typeof D!="string"&&(v.isEncoding===A||!A(E)))throw new Error("Unknown encoding: "+E);return D||E}function b(E){this.encoding=p(E);var D;switch(this.encoding){case"utf16le":this.text=S,this.end=N,D=4;break;case"utf8":this.fillLast=y,D=4;break;case"base64":this.text=I,this.end=M,D=3;break;default:return this.write=m,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(D)}function h(E){return 127>=E?0:E>>5==6?2:E>>4==14?3:E>>3==30?4:E>>6==2?-1:-2}function d(E,D,U){var k=D.length-1;if(k<U)return 0;var T=h(D[k]);return 0<=T?(0<T&&(E.lastNeed=T-1),T):--k<U||T===-2?0:(T=h(D[k]),0<=T?(0<T&&(E.lastNeed=T-2),T):--k<U||T===-2?0:(T=h(D[k]),0<=T?(0<T&&(T===2?T=0:E.lastNeed=T-3),T):0))}function g(E,D){if((192&D[0])!=128)return E.lastNeed=0,"";if(1<E.lastNeed&&1<D.length){if((192&D[1])!=128)return E.lastNeed=1,"";if(2<E.lastNeed&&2<D.length&&(192&D[2])!=128)return E.lastNeed=2,""}}function y(E){var D=this.lastTotal-this.lastNeed,U=g(this,E);return U===void 0?this.lastNeed<=E.length?(E.copy(this.lastChar,D,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,D,0,E.length),void(this.lastNeed-=E.length)):U}function S(E,D){if((E.length-D)%2==0){var U=E.toString("utf16le",D);if(U){var k=U.charCodeAt(U.length-1);if(55296<=k&&56319>=k)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],U.slice(0,-1)}return U}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",D,E.length-1)}function N(E){var D=E&&E.length?this.write(E):"";if(this.lastNeed){var U=this.lastTotal-this.lastNeed;return D+this.lastChar.toString("utf16le",0,U)}return D}function I(E,D){var U=(E.length-D)%3;return U==0?E.toString("base64",D):(this.lastNeed=3-U,this.lastTotal=3,U==1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",D,E.length-U))}function M(E){var D=E&&E.length?this.write(E):"";return this.lastNeed?D+this.lastChar.toString("base64",0,3-this.lastNeed):D}function m(E){return E.toString(this.encoding)}function _(E){return E&&E.length?this.write(E):""}var v=o("safe-buffer").Buffer,A=v.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};c.StringDecoder=b,b.prototype.write=function(E){if(E.length===0)return"";var D,U;if(this.lastNeed){if(D=this.fillLast(E),D===void 0)return"";U=this.lastNeed,this.lastNeed=0}else U=0;return U<E.length?D?D+this.text(E,U):this.text(E,U):D||""},b.prototype.end=function(E){var D=E&&E.length?this.write(E):"";return this.lastNeed?D+"":D},b.prototype.text=function(E,D){var U=d(this,E,D);if(!this.lastNeed)return E.toString("utf8",D);this.lastTotal=U;var k=E.length-(U-this.lastNeed);return E.copy(this.lastChar,0,k),E.toString("utf8",D,k)},b.prototype.fillLast=function(E){return this.lastNeed<=E.length?(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),void(this.lastNeed-=E.length))}},{"safe-buffer":30}],32:[function(o,a){(function(c){(function(){function u(p){try{if(!c.localStorage)return!1}catch{return!1}var b=c.localStorage[p];return b!=null&&(b+"").toLowerCase()==="true"}a.exports=function(p,b){function h(){if(!d){if(u("throwDeprecation"))throw new Error(b);u("traceDeprecation")?console.trace(b):console.warn(b),d=!0}return p.apply(this,arguments)}if(u("noDeprecation"))return p;var d=!1;return h}}).call(this)}).call(this,typeof xe>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:xe)},{}],"/":[function(o,a){function c(M){return M.replace(/a=ice-options:trickle\s\n/g,"")}function u(M){console.warn(M)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const p=o("debug")("simple-peer"),b=o("get-browser-rtc"),h=o("randombytes"),d=o("readable-stream"),g=o("queue-microtask"),y=o("err-code"),{Buffer:S}=o("buffer"),N=65536;class I extends d.Duplex{constructor(m){if(m=Object.assign({allowHalfOpen:!1},m),super(m),this._id=h(4).toString("hex").slice(0,7),this._debug("new peer %o",m),this.channelName=m.initiator?m.channelName||h(20).toString("hex"):null,this.initiator=m.initiator||!1,this.channelConfig=m.channelConfig||I.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},I.config,m.config),this.offerOptions=m.offerOptions||{},this.answerOptions=m.answerOptions||{},this.sdpTransform=m.sdpTransform||(_=>_),this.streams=m.streams||(m.stream?[m.stream]:[]),this.trickle=m.trickle===void 0||m.trickle,this.allowHalfTrickle=m.allowHalfTrickle!==void 0&&m.allowHalfTrickle,this.iceCompleteTimeout=m.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=m.wrtc&&typeof m.wrtc=="object"?m.wrtc:b(),!this._wrtc)throw y(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(y(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(y(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(m){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof m=="string")try{m=JSON.parse(m)}catch{m={}}this._debug("signal()"),m.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),m.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(m.transceiverRequest.kind,m.transceiverRequest.init)),m.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(m.candidate):this._pendingCandidates.push(m.candidate)),m.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(m)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(y(_,"ERR_SET_REMOTE_DESCRIPTION"))}),m.sdp||m.candidate||m.renegotiate||m.transceiverRequest||this.destroy(y(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(m){const _=new this._wrtc.RTCIceCandidate(m);this._pc.addIceCandidate(_).catch(v=>{!_.address||_.address.endsWith(".local")?u("Ignoring unsupported ICE candidate."):this.destroy(y(v,"ERR_ADD_ICE_CANDIDATE"))})}send(m){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(m)}}addTransceiver(m,_){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(m,_),this._needsNegotiation()}catch(v){this.destroy(y(v,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:m,init:_}})}}addStream(m){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),m.getTracks().forEach(_=>{this.addTrack(_,m)})}}addTrack(m,_){if(this.destroying)return;if(this.destroyed)throw y(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const v=this._senderMap.get(m)||new Map;let A=v.get(_);if(!A)A=this._pc.addTrack(m,_),v.set(_,A),this._senderMap.set(m,v),this._needsNegotiation();else throw A.removed?y(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):y(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(m,_,v){if(this.destroying)return;if(this.destroyed)throw y(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const A=this._senderMap.get(m),E=A?A.get(v):null;if(!E)throw y(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,A),E.replaceTrack==null?this.destroy(y(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):E.replaceTrack(_)}removeTrack(m,_){if(this.destroying)return;if(this.destroyed)throw y(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const v=this._senderMap.get(m),A=v?v.get(_):null;if(!A)throw y(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{A.removed=!0,this._pc.removeTrack(A)}catch(E){E.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(A):this.destroy(y(E,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(m){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),m.getTracks().forEach(_=>{this.removeTrack(_,m)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,g(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw y(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(m){this._destroy(m,()=>{})}_destroy(m,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",m&&(m.message||m)),g(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",m&&(m.message||m)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,m&&this.emit("error",m),this.emit("close"),_()}))}_setupData(m){if(!m.channel)return this.destroy(y(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=m.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=N),this.channelName=this._channel.label,this._channel.onmessage=v=>{this._onChannelMessage(v)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=v=>{const A=v.error instanceof Error?v.error:new Error(`Datachannel error: ${v.message} ${v.filename}:${v.lineno}:${v.colno}`);this.destroy(y(A,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(m,_,v){if(this.destroyed)return v(y(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(m)}catch(A){return this.destroy(y(A,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>N?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=v):v(null)}else this._debug("write before connect"),this._chunk=m,this._cb=v}_onFinish(){if(!this.destroyed){const m=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?m():this.once("connect",m)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=c(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp})}};this._pc.setLocalDescription(m).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(y(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(y(m,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(m=>{m.mid||!m.sender.track||m.requested||(m.requested=!0,this.addTransceiver(m.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=c(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(m).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(y(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(y(m,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(y(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const m=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",m,_),this.emit("iceStateChange",m,_),(m==="connected"||m==="completed")&&(this._pcReady=!0,this._maybeReady()),m==="failed"&&this.destroy(y(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),m==="closed"&&this.destroy(y(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(m){const _=v=>(Object.prototype.toString.call(v.values)==="[object Array]"&&v.values.forEach(A=>{Object.assign(v,A)}),v);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(v=>{const A=[];v.forEach(E=>{A.push(_(E))}),m(null,A)},v=>m(v)):0<this._pc.getStats.length?this._pc.getStats(v=>{if(this.destroyed)return;const A=[];v.result().forEach(E=>{const D={};E.names().forEach(U=>{D[U]=E.stat(U)}),D.id=E.id,D.type=E.type,D.timestamp=E.timestamp,A.push(_(D))}),m(null,A)},v=>m(v)):m(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const m=()=>{this.destroyed||this.getStats((_,v)=>{if(this.destroyed)return;_&&(v=[]);const A={},E={},D={};let U=!1;v.forEach(T=>{(T.type==="remotecandidate"||T.type==="remote-candidate")&&(A[T.id]=T),(T.type==="localcandidate"||T.type==="local-candidate")&&(E[T.id]=T),(T.type==="candidatepair"||T.type==="candidate-pair")&&(D[T.id]=T)});const k=T=>{U=!0;let F=E[T.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof T.googLocalAddress=="string"&&(F=T.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let j=A[T.remoteCandidateId];j&&(j.ip||j.address)?(this.remoteAddress=j.ip||j.address,this.remotePort=+j.port):j&&j.ipAddress?(this.remoteAddress=j.ipAddress,this.remotePort=+j.portNumber):typeof T.googRemoteAddress=="string"&&(j=T.googRemoteAddress.split(":"),this.remoteAddress=j[0],this.remotePort=+j[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(v.forEach(T=>{T.type==="transport"&&T.selectedCandidatePairId&&k(D[T.selectedCandidatePairId]),(T.type==="googCandidatePair"&&T.googActiveConnection==="true"||(T.type==="candidatepair"||T.type==="candidate-pair")&&T.selected)&&k(T)}),!U&&(!Object.keys(D).length||Object.keys(E).length))return void setTimeout(m,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(y(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const T=this._cb;this._cb=null,T(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};m()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>N)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(m=>{this._pc.removeTrack(m),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(m){this.destroyed||(m.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:m.candidate.candidate,sdpMLineIndex:m.candidate.sdpMLineIndex,sdpMid:m.candidate.sdpMid}}):!m.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),m.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(m){if(this.destroyed)return;let _=m.data;_ instanceof ArrayBuffer&&(_=S.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const m=this._cb;this._cb=null,m(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(m){this.destroyed||m.streams.forEach(_=>{this._debug("on track"),this.emit("track",m.track,_),this._remoteTracks.push({track:m.track,stream:_}),this._remoteStreams.some(v=>v.id===_.id)||(this._remoteStreams.push(_),g(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const m=[].slice.call(arguments);m[0]="["+this._id+"] "+m[0],p.apply(null,m)}}I.WEBRTC_SUPPORT=!!b(),I.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},I.channelConfig={},a.exports=I},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})}(_r)),_r.exports}var Jh=Gh();const Kh=ha(Jh),Rs=0,As=1,ta=2,na=(t,e)=>{te(t,Rs);const n=al(e);Ie(t,n)},ra=(t,e,n)=>{te(t,As),Ie(t,rl(e,n))},Xh=(t,e,n)=>ra(e,n,St(t)),sa=(t,e,n)=>{try{el(e,St(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Zh=(t,e)=>{te(t,ta),Ie(t,e)},Qh=sa,ef=(t,e,n,r)=>{const i=ze(t);switch(i){case Rs:Xh(t,e,n);break;case As:sa(t,n,r);break;case ta:Qh(t,n,r);break;default:throw new Error("Unknown message type")}return i},vr=3e4;class tf extends ms{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=Ge();this.getLocalState()!==null&&vr/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,o)=>{o!==this.clientID&&vr<=n-i.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&Yr(this,r,"timeout")},Bt(vr/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,o=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:i,lastUpdated:Ge()});const a=[],c=[],u=[],p=[];e===null?p.push(n):o==null?e!=null&&a.push(n):(c.push(n),rn(o,e)||u.push(n)),(a.length>0||u.length>0||p.length>0)&&this.emit("change",[{added:a,updated:u,removed:p},"local"]),this.emit("update",[{added:a,updated:c,removed:p},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const Yr=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const o=e[i];if(t.states.has(o)){if(t.states.delete(o),o===t.clientID){const a=t.meta.get(o);t.meta.set(o,{clock:a.clock+1,lastUpdated:Ge()})}r.push(o)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},zn=(t,e,n=t.states)=>{const r=e.length,i=ge();te(i,r);for(let o=0;o<r;o++){const a=e[o],c=n.get(a)||null,u=t.meta.get(a).clock;te(i,a),te(i,u),Wt(i,JSON.stringify(c))}return me(i)},nf=(t,e,n)=>{const r=ar(e),i=Ge(),o=[],a=[],c=[],u=[],p=ze(r);for(let b=0;b<p;b++){const h=ze(r);let d=ze(r);const g=JSON.parse(bn(r)),y=t.meta.get(h),S=t.states.get(h),N=y===void 0?0:y.clock;(N<d||N===d&&g===null&&t.states.has(h))&&(g===null?h===t.clientID&&t.getLocalState()!=null?d++:t.states.delete(h):t.states.set(h,g),t.meta.set(h,{clock:d,lastUpdated:i}),y===void 0&&g!==null?o.push(h):y!==void 0&&g===null?u.push(h):g!==null&&(rn(g,S)||c.push(h),a.push(h)))}(o.length>0||c.length>0||u.length>0)&&t.emit("change",[{added:o,updated:c,removed:u},n]),(o.length>0||a.length>0||u.length>0)&&t.emit("update",[{added:o,updated:a,removed:u},n])},rf=(t,e)=>{const n=Vr(t).buffer,r=Vr(e).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(i=>crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},ia=(t,e)=>{if(!e)return Es(t);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},e,t).then(r=>{const i=ge();return Wt(i,"AES-GCM"),Ie(i,n),Ie(i,new Uint8Array(r)),me(i)})},sf=(t,e)=>{const n=ge();return zr(n,t),ia(me(n),e)},oa=(t,e)=>{if(!e)return Es(t);const n=ar(t);bn(n)!=="AES-GCM"&&$h(or("Unknown encryption algorithm"));const i=St(n),o=St(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:i},e,o).then(a=>new Uint8Array(a))},of=(t,e)=>oa(t,e).then(n=>qr(ar(new Uint8Array(n)))),Te=Bh("y-webrtc"),Lt=0,aa=3,mn=1,Ts=4,Yn=new Map,bt=new Map,ca=t=>{let e=!0;t.webrtcConns.forEach(n=>{n.synced||(e=!1)}),(!e&&t.synced||e&&!t.synced)&&(t.synced=e,t.provider.emit("synced",[{synced:e}]),Te("synced ",Ae,t.name,qt," with all peers"))},la=(t,e,n)=>{const r=ar(e),i=ge(),o=ze(r);if(t===void 0)return null;const a=t.awareness,c=t.doc;let u=!1;switch(o){case Lt:{te(i,Lt);const p=ef(r,i,c,t);p===As&&!t.synced&&n(),p===Rs&&(u=!0);break}case aa:te(i,mn),Ie(i,zn(a,Array.from(a.getStates().keys()))),u=!0;break;case mn:nf(a,St(r),t);break;case Ts:{const p=Hn(r)===1,b=bn(r);if(b!==t.peerId&&(t.bcConns.has(b)&&!p||!t.bcConns.has(b)&&p)){const h=[],d=[];p?(t.bcConns.add(b),d.push(b)):(t.bcConns.delete(b),h.push(b)),t.provider.emit("peers",[{added:d,removed:h,webrtcPeers:Array.from(t.webrtcConns.keys()),bcPeers:Array.from(t.bcConns)}]),ua(t)}break}default:return console.error("Unable to compute message"),i}return u?i:null},af=(t,e)=>{const n=t.room;return Te("received message from ",Ae,t.remotePeerId,Cs," (",n.name,")",qt,cr),la(n,e,()=>{t.synced=!0,Te("synced ",Ae,n.name,qt," with ",Ae,t.remotePeerId),ca(n)})},Sr=(t,e)=>{Te("send message to ",Ae,t.remotePeerId,qt,Cs," (",t.room.name,")",cr);try{t.peer.send(me(e))}catch{}},cf=(t,e)=>{Te("broadcast message in ",Ae,t.name,qt),t.webrtcConns.forEach(n=>{try{n.peer.send(e)}catch{}})};class ki{constructor(e,n,r,i){Te("establishing connection to ",Ae,r),this.room=i,this.remotePeerId=r,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new Kh({initiator:n,...i.provider.peerOpts}),this.peer.on("signal",o=>{Os(e,i,{to:r,from:i.peerId,type:"signal",signal:o})}),this.peer.on("connect",()=>{Te("connected to ",Ae,r),this.connected=!0;const a=i.provider.doc,c=i.awareness,u=ge();te(u,Lt),na(u,a),Sr(this,u);const p=c.getStates();if(p.size>0){const b=ge();te(b,mn),Ie(b,zn(c,Array.from(p.keys()))),Sr(this,b)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,i.webrtcConns.has(this.remotePeerId)&&(i.webrtcConns.delete(this.remotePeerId),i.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}])),ca(i),this.peer.destroy(),Te("closed connection to ",Ae,r),Gr(i)}),this.peer.on("error",o=>{Te("Error in connection to ",Ae,r,": ",o),Gr(i)}),this.peer.on("data",o=>{const a=af(this,o);a!==null&&Sr(this,a)})}destroy(){this.peer.destroy()}}const nt=(t,e)=>ia(e,t.key).then(n=>t.mux(()=>zh(t.name,n))),Ri=(t,e)=>{t.bcconnected&&nt(t,e),cf(t,e)},Gr=t=>{Yn.forEach(e=>{e.connected&&(e.send({type:"subscribe",topics:[t.name]}),t.webrtcConns.size<t.provider.maxConns&&Os(e,t,{type:"announce",from:t.peerId}))})},ua=t=>{if(t.provider.filterBcConns){const e=ge();te(e,Ts),Jo(e,1),Wt(e,t.peerId),nt(t,me(e))}};class lf{constructor(e,n,r,i){this.peerId=Fu(),this.doc=e,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=r,this.key=i,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Yh(),this.bcconnected=!1,this._bcSubscriber=o=>oa(new Uint8Array(o),i).then(a=>this.mux(()=>{const c=la(this,a,()=>{});c&&nt(this,me(c))})),this._docUpdateHandler=(o,a)=>{const c=ge();te(c,Lt),Zh(c,o),Ri(this,me(c))},this._awarenessUpdateHandler=({added:o,updated:a,removed:c},u)=>{const p=o.concat(a).concat(c),b=ge();te(b,mn),Ie(b,zn(this.awareness,p)),Ri(this,me(b))},this._beforeUnloadHandler=()=>{Yr(this.awareness,[e.clientID],"window unload"),bt.forEach(o=>{o.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),Gr(this);const e=this.name;qh(e,this._bcSubscriber),this.bcconnected=!0,ua(this);const n=ge();te(n,Lt),na(n,this.doc),nt(this,me(n));const r=ge();te(r,Lt),ra(r,this.doc),nt(this,me(r));const i=ge();te(i,aa),nt(this,me(i));const o=ge();te(o,mn),Ie(o,zn(this.awareness,[this.doc.clientID])),nt(this,me(o))}disconnect(){Yn.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),Yr(this.awareness,[this.doc.clientID],"disconnect");const e=ge();te(e,Ts),Jo(e,0),Wt(e,this.peerId),nt(this,me(e)),Hh(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const uf=(t,e,n,r)=>{if(bt.has(n))throw or(`A Yjs Doc connected to room "${n}" already exists!`);const i=new lf(t,e,n,r);return bt.set(n,i),i},Os=(t,e,n)=>{e.key?sf(n,e.key).then(r=>{t.send({type:"publish",topic:e.name,data:Yo(r)})}):t.send({type:"publish",topic:e.name,data:n})};class hf extends Iu{constructor(e){super(e),this.providers=new Set,this.on("connect",()=>{Te(`connected (${e})`);const n=Array.from(bt.keys());this.send({type:"subscribe",topics:n}),bt.forEach(r=>Os(this,r,{type:"announce",from:r.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const r=n.topic,i=bt.get(r);if(i==null||typeof r!="string")return;const o=a=>{const c=i.webrtcConns,u=i.peerId;if(a==null||a.from===u||a.to!==void 0&&a.to!==u||i.bcConns.has(a.from))return;const p=c.has(a.from)?()=>{}:()=>i.provider.emit("peers",[{removed:[],added:[a.from],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}]);switch(a.type){case"announce":c.size<i.provider.maxConns&&(gn(c,a.from,()=>new ki(this,!0,a.from,i)),p());break;case"signal":a.to===u&&(gn(c,a.from,()=>new ki(this,!1,a.from,i)).peer.signal(a.signal),p());break}};i.key?typeof n.data=="string"&&of(Go(n.data),i.key).then(o):o(n.data)}}}),this.on("disconnect",()=>Te(`disconnect (${e})`))}}class Nf extends ms{constructor(e,n,{signaling:r=["wss://y-webrtc-eu.fly.dev"],password:i=null,awareness:o=new tf(n),maxConns:a=20+Bt(Nu()*15),filterBcConns:c=!0,peerOpts:u={}}={}){super(),this.roomName=e,this.doc=n,this.filterBcConns=c,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=r,this.signalingConns=[],this.maxConns=a,this.peerOpts=u,this.key=i?rf(i,e):Es(null),this.room=null,this.key.then(p=>{this.room=uf(n,this,e,p),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(e=>{const n=gn(Yn,e,()=>new hf(e));this.signalingConns.push(n),n.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(e=>{e.providers.delete(this),e.providers.size===0&&(e.destroy(),Yn.delete(e.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),bt.delete(this.roomName)}),super.destroy()}}const Mf=Ns({name:Le({title:"Name"}),age:lr({title:"Age"}),gender:Le({title:"Gender"}),nickName:Le({title:"Nickname"}),description:Le({title:"Description"}),phoneNumber:Le({title:"Phone Number"}),address:Ns({street:Le({title:"Street Name"}),apt:Le({title:"Apartment Number"}),city:Le({title:"City"}),state:Le({title:"State"}),zip:lr({title:"Zip Code"})}),secretField:Le({title:"Secret Field",defaultVisibleRoles:["gm"]}),canMail:_a({title:"Can we mail you?"}),favoriteNumber:lr({title:"Armor class"}),additionalProperties:wa(),customProperties:ma("$.additionalProperties",{title:"Custom Properties"})}),Uf={nickName:'typeof <base> === "string" ? <base> : {$.name}',canMail:"{$.address.street} && {$.address.city} && {$.address.state} && {$.address.zip}",favoriteNumber:"TO_NUMBER({$.age}) + TO_NUMBER(<base>)"},Ff=[["name","nickName","age","gender"],"secretField","description","phoneNumber",{kind:"section",title:"Address",uiLayout:[["address.street","address.apt"],["address.city","address.state","address.zip"]]},"canMail",{kind:"section",title:"Personal details",uiLayout:["favoriteNumber"]},"customProperties"],In="gm",ff="player",Ai=({value:t,onChange:e,label:n,aggregatedValue:r,updateFieldSettings:i,fieldSettings:o,aggregation:a,aggregationSupport:c,currentUserRole:u})=>{const[p,b]=oe.useState(!1),h=oe.useCallback(()=>b(!1),[]),d=oe.useCallback(()=>b(!0),[]);return se.jsx(Ds,{aggregationSupport:c,updateFieldSettings:i,currentUserRole:u,fieldSettings:o,children:se.jsx(va,{value:!p&&a?r??"":t??"",onChange:e,onFocus:d,onBlur:h,label:n})})},df=({value:t,onChange:e,label:n,aggregatedValue:r,aggregation:i,aggregationSupport:o,updateFieldSettings:a,currentUserRole:c,fieldSettings:u})=>{const[p,b]=oe.useState(!1),h=oe.useCallback(()=>b(!1),[]),d=oe.useCallback(()=>b(!0),[]);return se.jsx(Ds,{aggregationSupport:o,updateFieldSettings:a,currentUserRole:c,fieldSettings:u,children:se.jsx(Ca,{value:!p&&i?r??0:t??0,onChange:e,label:n,onFocus:d,onBlur:h})})},pf=({value:t,onChange:e,label:n,aggregatedValue:r,aggregation:i,aggregationSupport:o,updateFieldSettings:a,currentUserRole:c,fieldSettings:u})=>{const[p,b]=oe.useState(!1),h=oe.useCallback(()=>b(!1),[]),d=oe.useCallback(()=>b(!0),[]);return se.jsx(Ds,{aggregationSupport:o,updateFieldSettings:a,currentUserRole:c,fieldSettings:u,children:se.jsx(Sa,{value:!p&&i?r??!1:t??!1,onChange:e,label:n,onFocus:d,onBlur:h})})},gf=()=>se.jsx("p",{children:"Derp"}),Pf={string:Ai,number:df,boolean:pf,array:gf,randoType:Ai},Ds=({aggregationSupport:t,fieldSettings:e,currentUserRole:n,updateFieldSettings:r,children:i})=>{var a,c;const o=[];if(n===In&&t&&r&&o.push({displayText:"Compute this field?",icon:(e==null?void 0:e.aggregationSettings)===!1?"blank":"tick",onClick:()=>{r({...e??{},aggregationSettings:!((e==null?void 0:e.aggregationSettings)??!0)})},shouldCloseMenuOnClick:!1}),n===In&&r){const u=p=>{r({...e??{},visibleRoles:p})};o.push({displayText:"Visibility settings",icon:"eye-open",subItems:[{displayText:"Use default settings",icon:e!=null&&e.visibleRoles?"blank":"tick",onClick:()=>u(),shouldCloseMenuOnClick:!1},{displayText:"Game master only",icon:((a=e==null?void 0:e.visibleRoles)==null?void 0:a.length)===1?"tick":"blank",onClick:()=>u([In]),shouldCloseMenuOnClick:!1},{displayText:"Everyone",icon:((c=e==null?void 0:e.visibleRoles)==null?void 0:c.length)===2?"tick":"blank",onClick:()=>u([In,ff]),shouldCloseMenuOnClick:!1}]})}return o.length?se.jsx(Ea,{menuItems:o,children:i}):se.jsx(se.Fragment,{children:i})},yf=Jr.div`
	display: flex;
`,bf=Jr.div`
	width: 100%;
`,mf=Jr.div`
	width: 100%;
`,wf=({title:t,children:e})=>Ti.Children.count(e)===0?null:se.jsxs(bf,{children:[se.jsx(yf,{children:se.jsx("h2",{children:t})}),se.jsx(mf,{children:e})]});wf.__docgenInfo={description:"",methods:[],displayName:"ExampleUiSection",props:{title:{required:!0,tsType:{name:"string"},description:""}}};export{Et as D,wf as E,Cu as S,Nf as W,Ff as a,Pf as b,Mf as c,Uf as e,wu as s,xo as u};
