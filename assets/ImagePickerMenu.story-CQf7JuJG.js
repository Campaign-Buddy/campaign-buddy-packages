import{j as n}from"./jsx-runtime-PJfywvQB.js";import{r as e}from"./index-tnPESBdE.js";import"./parchmentTheme-CF6Ki9yW.js";import{P as B,F as T,B as I,d as H,I as V,M as $}from"./useShowToast-xIu4UuDl.js";import"./index-C4WGByT4.js";import{u as Q}from"./fuse.esm-DpGxg_dX.js";import{d as b,u as L,e as Y,I as G,M as D}from"./ImageGrid-Cf5Kw9KK.js";import{w as J,Q as W}from"./index.esm-CPT3nVmo.js";import{H as K}from"./styled-components.browser.esm-CuL3HyEV.js";import{Q as X}from"./queryClient-C86Hojab.js";import"./index-DwWHXmyK.js";import"./useCombinedRefs-G3-tKQwR.js";import"./index-CNLxx85X.js";import"./index-BJt650PE.js";import"./index-aBkx2qY1.js";import"./inheritsLoose-XbxvykFZ.js";import"./jsonSchemaTypes-BjqZX6rF.js";function Z(u,s=[b.Image]){if(!document||!window)return;const o=document.getElementById("campaign-buddy-open-file-picker");o&&document.body.removeChild(o);const i=document.createElement("input");i.setAttribute("type","file"),i.id="campaign-buddy-open-file-picker",i.style.display="none";const a=[];for(const t of s)t===b.Image?a.push("image/*"):t===b.Pdf?a.push("application/pdf"):t===b.Video&&a.push("video/*");a.length>0&&(i.accept=a.join(", ")),document.body.appendChild(i);const r=()=>{if(!i)return;i.removeEventListener("change",r);const t=i.files;if(!(t!=null&&t[0]))return;const m=t[0];u(m)};i.addEventListener("change",r),i.click()}const ee=K.div`
	width: 300px;
	max-width: 100%;
`,z=K.div`
	margin: 8px 0;
	max-height: 300px;
	overflow-y: auto;
`,E=10,F=({onClose:u,onConfirm:s,isOpen:o,children:i,mediaApi:a})=>{const r=L(),[t,m]=e.useState(0),[d,f]=e.useState(!1),y=J(),{isLoading:C,data:l,refetch:c}=Y(["package-campaign-buddy-existing-media-popover",t],async()=>(await a.listUploadedMedia({limit:E+1,offset:t*E,type:b.Image})).media),p=l&&l.length>0,v=e.useCallback(async()=>{f(!0),await c(),r.current&&f(!1)},[r,c]),x=!C&&!d&&(l==null?void 0:l.length)===E+1,h=e.useCallback(()=>m(k=>k+1),[]),j=e.useCallback(()=>m(k=>k-1),[]),P=n.jsx(H,{size:"fullPage",fullHeight:!0}),S=e.useCallback((k,w)=>{l&&s(l[w])},[s,l]);return n.jsx(B,{isOpen:o,onClose:u,placement:"bottom-start",noMargin:!0,content:n.jsxs(ee,{children:[n.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[n.jsx("p",{children:"Your media"}),n.jsx(I,{onClick:v,icon:"refresh",variant:"minimal",size:"small",disabled:d})]}),C||d?n.jsx(z,{children:P}):p&&l?n.jsx(z,{children:n.jsx(G,{rowHeight:100,queryClient:y,images:l,fallback:P,onImageClicked:S})}):n.jsx("p",{children:"You have no uploaded media!"}),n.jsxs(T,{justifyContent:"flex-end",gap:4,children:[n.jsx(I,{onClick:j,size:"small",variant:"minimal",icon:"caret-left",disabled:t===0}),n.jsx(I,{onClick:h,size:"small",variant:"minimal",icon:"caret-right",disabled:!x})]})]}),children:i})};F.__docgenInfo={description:"",methods:[],displayName:"ExistingImagePicker"};const N=({onConfirm:u,onClose:s,isOpen:o,children:i})=>{const[a,r]=e.useState("");e.useEffect(()=>{o&&r("")},[o]);const t=e.useMemo(()=>/(https?:\/\/)?([a-z][0-9a-z-]{0,254}\.)*([a-z0-9-]{2,255})\.[a-z0-9-]{2,64}/i.test(a),[a]),m=e.useCallback(()=>{t&&u(a)},[u,a,t]);return n.jsx(B,{isOpen:o,onClose:s,placement:"bottom-start",noMargin:!0,content:n.jsx(V,{label:"External url",value:a,onChange:r,onSubmit:m,rightElement:n.jsx(I,{variant:"minimal",size:"small",icon:"small-tick",onClick:m,disabled:!t})}),children:i})};N.__docgenInfo={description:"",methods:[],displayName:"ExternalUrlPicker",props:{onConfirm:{required:!0,tsType:{name:"signature",type:"function",raw:"(url: string) => void",signature:{arguments:[{type:{name:"string"},name:"url"}],return:{name:"void"}}},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""}}};const ne=["existing-media","file-upload","url"],q=({isOpen:u,onConfirm:s,onClose:o,mediaApi:i,queryClient:a,supportedOptions:r=ne,children:t,onStateTransition:m})=>{const d=e.useRef(m);e.useEffect(()=>{d.current=m},[m]);const[f,y]=e.useState("none"),[C,l,c]=Q(u),p=e.useMemo(()=>C?"main-menu":f,[C,f]),v=e.useRef(p),x=e.useRef(p);e.useEffect(()=>(v.current=p,()=>{x.current=p}),[p]);const h=e.useCallback(()=>{y("none")},[]),j=e.useCallback(()=>{y("existing-media"),c()},[c]),P=e.useCallback(()=>{y("url"),c()},[c]),S=e.useCallback(()=>{y("file-upload"),c(),Z(async g=>{const{media:O}=await i.uploadMedia({file:g});s(O.url,O)})},[c,i,s]),k=e.useMemo(()=>[r.includes("file-upload")&&{displayText:"Upload image",icon:"upload",onClick:S,shouldCloseMenuOnClick:!1},r.includes("existing-media")&&{displayText:"Use existing image",icon:"cloud-download",onClick:j,shouldCloseMenuOnClick:!1},r.includes("url")&&{displayText:"Use external url",icon:"link",onClick:P,shouldCloseMenuOnClick:!1}].filter(g=>!!g),[j,P,r,S]),w=e.useCallback(g=>{s(g.url,g)},[s]),R=e.useCallback(g=>{s(g)},[s]);return e.useEffect(()=>{u?v.current==="none"&&(l(),h()):v.current!=="none"&&(c(),h())},[u,c,h,l]),e.useEffect(()=>{f==="file-upload"&&y("none")},[f]),e.useEffect(()=>{const g=p==="none"&&x.current!=="none";d!=null&&d.current&&p!==x.current&&(d==null||d.current(x==null?void 0:x.current,p)),g&&o()},[o,p]),k.length===0?n.jsx(n.Fragment,{children:t}):n.jsx(W,{client:a,children:n.jsx($,{items:k,isOpen:C,onClose:c,children:n.jsx(F,{isOpen:!C&&f==="existing-media",mediaApi:i,onConfirm:w,onClose:h,children:n.jsx(N,{isOpen:!C&&f==="url",onConfirm:R,onClose:h,children:t})})})})};q.__docgenInfo={description:"",methods:[],displayName:"ImagePickerMenu",props:{isOpen:{required:!0,tsType:{name:"boolean"},description:""},onConfirm:{required:!0,tsType:{name:"signature",type:"function",raw:"(url: string, media?: Media) => void",signature:{arguments:[{type:{name:"string"},name:"url"},{type:{name:"Media"},name:"media"}],return:{name:"void"}}},description:""},onClose:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},mediaApi:{required:!0,tsType:{name:"MediaApi"},description:""},queryClient:{required:!0,tsType:{name:"QueryClient"},description:""},supportedOptions:{required:!1,tsType:{name:"Array",elements:[{name:"union",raw:"'existing-media' | 'file-upload' | 'url'",elements:[{name:"literal",value:"'existing-media'"},{name:"literal",value:"'file-upload'"},{name:"literal",value:"'url'"}]}],raw:"ImagePickerKind[]"},description:"",defaultValue:{value:`[
	'existing-media',
	'file-upload',
	'url',
]`,computed:!1}},onStateTransition:{required:!1,tsType:{name:"signature",type:"function",raw:`(
	previousState: OpenPopoverState,
	currentState: OpenPopoverState
) => void`,signature:{arguments:[{type:{name:"union",raw:"'main-menu' | ImagePickerKind | 'none'",elements:[{name:"literal",value:"'main-menu'"},{name:"union",raw:"'existing-media' | 'file-upload' | 'url'",elements:[{name:"literal",value:"'existing-media'"},{name:"literal",value:"'file-upload'"},{name:"literal",value:"'url'"}]},{name:"literal",value:"'none'"}]},name:"previousState"},{type:{name:"union",raw:"'main-menu' | ImagePickerKind | 'none'",elements:[{name:"literal",value:"'main-menu'"},{name:"union",raw:"'existing-media' | 'file-upload' | 'url'",elements:[{name:"literal",value:"'existing-media'"},{name:"literal",value:"'file-upload'"},{name:"literal",value:"'url'"}]},{name:"literal",value:"'none'"}]},name:"currentState"}],return:{name:"void"}}},description:""}}};const ve={title:"image-picker-menu/ImagePickerMenu",component:q},te=new X,ie=new D,M=()=>{const[u,s,o]=Q(),i=e.useCallback((r,t)=>{o(),console.log(r,t)},[o]),a=e.useCallback((r,t)=>{console.log(`State change: ${r} -> ${t}`)},[]);return n.jsx(q,{isOpen:u,onClose:o,onConfirm:i,mediaApi:ie,queryClient:te,onStateTransition:a,children:n.jsx(I,{onClick:s,children:"Pick Image"})})};M.__docgenInfo={description:"",methods:[],displayName:"Primary"};var U,_,A;M.parameters={...M.parameters,docs:{...(U=M.parameters)==null?void 0:U.docs,source:{originalSource:`() => {
  const [isOpen, open, close] = useBooleanState();
  const onConfirm = useCallback((url: string, media?: Media) => {
    close();
    console.log(url, media);
  }, [close]);
  const observeStateChange = useCallback((oldState: any, currentState: any) => {
    console.log(\`State change: \${oldState} -> \${currentState}\`);
  }, []);
  return <ImagePickerMenu isOpen={isOpen} onClose={close} onConfirm={onConfirm} mediaApi={mediaApi} queryClient={queryClient} onStateTransition={observeStateChange}>
            <Button onClick={open}>Pick Image</Button>
        </ImagePickerMenu>;
}`,...(A=(_=M.parameters)==null?void 0:_.docs)==null?void 0:A.source}}};export{M as Primary,ve as default};
